{"version":3,"file":"angular-three-core-meshes.mjs","sources":["../../../../packages/core/meshes/src/mesh/mesh.directive.ts","../../../../packages/core/meshes/src/instanced-mesh/instanced-mesh.directive.ts","../../../../packages/core/meshes/src/skinned-mesh/skinned-mesh.directive.ts","../../../../packages/core/meshes/src/angular-three-core-meshes.ts"],"sourcesContent":["import {\n  NGT_MATERIAL_GEOMETRY_CONTROLLER_PROVIDER,\n  NGT_OBJECT_TYPE,\n  NgtCommonMesh,\n  NgtMaterialGeometryControllerModule,\n} from '@angular-three/core';\nimport { Directive, NgModule } from '@angular/core';\nimport * as THREE from 'three';\n\n@Directive({\n  selector: 'ngt-mesh',\n  exportAs: 'ngtMesh',\n  providers: [\n    { provide: NgtCommonMesh, useExisting: NgtMesh },\n    NGT_MATERIAL_GEOMETRY_CONTROLLER_PROVIDER,\n    { provide: NGT_OBJECT_TYPE, useValue: THREE.Mesh },\n  ],\n})\nexport class NgtMesh extends NgtCommonMesh {}\n\n@NgModule({\n  declarations: [NgtMesh],\n  exports: [NgtMesh, NgtMaterialGeometryControllerModule],\n})\nexport class NgtMeshModule {}\n","import {\n  NGT_MATERIAL_GEOMETRY_CONTROLLER_PROVIDER,\n  NGT_MATERIAL_GEOMETRY_WATCHED_CONTROLLER,\n  NGT_OBJECT_POST_INIT,\n  NGT_OBJECT_TYPE,\n  NgtCommonMesh,\n  NgtMaterialGeometryController,\n  NgtMaterialGeometryControllerModule,\n} from '@angular-three/core';\nimport {\n  Directive,\n  Inject,\n  Input,\n  NgModule,\n  NgZone,\n  Optional,\n} from '@angular/core';\nimport * as THREE from 'three';\n\n@Directive({\n  selector: 'ngt-instanced-mesh',\n  exportAs: 'ngtInstancedMesh',\n  providers: [\n    { provide: NgtCommonMesh, useExisting: NgtInstancedMesh },\n    NGT_MATERIAL_GEOMETRY_CONTROLLER_PROVIDER,\n    { provide: NGT_OBJECT_TYPE, useValue: THREE.InstancedMesh },\n    {\n      provide: NGT_OBJECT_POST_INIT,\n      useValue: (object: THREE.InstancedMesh) => {\n        object.instanceMatrix.setUsage(THREE.DynamicDrawUsage);\n      },\n    },\n  ],\n})\nexport class NgtInstancedMesh extends NgtCommonMesh<THREE.InstancedMesh> {\n  @Input() set args(value: [number]) {\n    if (this.materialGeometryController) {\n      this.materialGeometryController.meshArgs = value;\n    }\n  }\n\n  constructor(\n    @Optional()\n    @Inject(NGT_MATERIAL_GEOMETRY_WATCHED_CONTROLLER)\n    materialGeometryController: NgtMaterialGeometryController,\n    ngZone: NgZone\n  ) {\n    super(materialGeometryController, ngZone);\n  }\n}\n\n@NgModule({\n  declarations: [NgtInstancedMesh],\n  exports: [NgtInstancedMesh, NgtMaterialGeometryControllerModule],\n})\nexport class NgtInstancedMeshModule {}\n","import {\n  NGT_MATERIAL_GEOMETRY_CONTROLLER_PROVIDER,\n  NGT_OBJECT_CONTROLLER_PROVIDER,\n  NGT_OBJECT_INPUTS_WATCHED_CONTROLLER,\n  NGT_OBJECT_TYPE,\n  NGT_OBJECT_WATCHED_CONTROLLER,\n  NgtCommonMesh,\n  NgtMaterialGeometryControllerModule,\n  NgtMatrix4,\n  NgtObject3dController,\n  NgtObject3dInputsController,\n} from '@angular-three/core';\nimport {\n  Directive,\n  EventEmitter,\n  Inject,\n  Input,\n  NgModule,\n  NgZone,\n  OnInit,\n  Optional,\n  Output,\n} from '@angular/core';\nimport { requestAnimationFrame } from '@rx-angular/cdk/zone-less';\nimport * as THREE from 'three';\n\n@Directive({\n  selector: 'ngt-skinned-mesh',\n  exportAs: 'ngtSkinnedMesh',\n  providers: [\n    { provide: NgtCommonMesh, useExisting: NgtSkinnedMesh },\n    NGT_MATERIAL_GEOMETRY_CONTROLLER_PROVIDER,\n    { provide: NGT_OBJECT_TYPE, useValue: THREE.SkinnedMesh },\n  ],\n})\nexport class NgtSkinnedMesh extends NgtCommonMesh<THREE.SkinnedMesh> {\n  @Input() set args(v: [boolean]) {\n    if (this.materialGeometryController) {\n      this.materialGeometryController.meshArgs = v;\n    }\n  }\n\n  @Input() bindMatrix?: NgtMatrix4;\n  @Input() bindMode?: string;\n}\n\n@Directive({\n  selector: 'ngt-skeleton',\n  exportAs: 'ngtSkeleton',\n})\nexport class NgtSkeleton implements OnInit {\n  @Input() boneInverses?: NgtMatrix4[];\n  @Output() ready = new EventEmitter<THREE.Skeleton>();\n\n  #skeleton?: THREE.Skeleton;\n  get skeleton() {\n    return this.#skeleton;\n  }\n\n  constructor(\n    private ngZone: NgZone,\n    @Optional() private skinnedMesh: NgtSkinnedMesh\n  ) {\n    if (!skinnedMesh) {\n      throw new Error('ngt-skeleton must be used within a ngt-skinned-mesh');\n    }\n  }\n\n  ngOnInit() {\n    this.ngZone.runOutsideAngular(() => {\n      const boneInverses: THREE.Matrix4[] | undefined = this.boneInverses\n        ? this.boneInverses.map((threeMaxtrix) => {\n            if (threeMaxtrix instanceof THREE.Matrix4) return threeMaxtrix;\n            return new THREE.Matrix4().set(...threeMaxtrix);\n          })\n        : undefined;\n      this.#skeleton = new THREE.Skeleton([], boneInverses);\n      this.ready.emit(this.skeleton);\n\n      if (this.skinnedMesh) {\n        const bindMatrix: THREE.Matrix4 | undefined = this.skinnedMesh\n          .bindMatrix\n          ? this.skinnedMesh.bindMatrix instanceof THREE.Matrix4\n            ? this.skinnedMesh.bindMatrix\n            : new THREE.Matrix4().set(...this.skinnedMesh.bindMatrix)\n          : undefined;\n        this.skinnedMesh.mesh.bind(this.skeleton!, bindMatrix);\n      }\n    });\n  }\n}\n\n@Directive({\n  selector: 'ngt-bone',\n  exportAs: 'ngtBone',\n  providers: [NGT_OBJECT_CONTROLLER_PROVIDER],\n})\nexport class NgtBone implements OnInit {\n  @Output() ready = new EventEmitter<THREE.Bone>();\n\n  #bone?: THREE.Bone;\n  get bone() {\n    return this.#bone;\n  }\n\n  constructor(\n    @Inject(NGT_OBJECT_WATCHED_CONTROLLER)\n    private objectController: NgtObject3dController,\n    @Inject(NGT_OBJECT_INPUTS_WATCHED_CONTROLLER)\n    private objectInputsController: NgtObject3dInputsController,\n    private ngZone: NgZone,\n    @Optional()\n    private parentSkinnedMesh: NgtSkinnedMesh,\n    @Optional()\n    private parentSkeleton: NgtSkeleton\n  ) {\n    if (!parentSkinnedMesh) {\n      throw new Error('ngt-bone must be used within a ngt-skinned-mesh');\n    }\n    objectInputsController.appendTo = parentSkinnedMesh.mesh;\n    objectController.initFn = () => {\n      this.#bone = new THREE.Bone();\n      return this.#bone;\n    };\n    objectController.readyFn = () => {\n      this.ready.emit(this.bone);\n    };\n  }\n\n  ngOnInit() {\n    this.ngZone.runOutsideAngular(() => {\n      this.objectController.init();\n      requestAnimationFrame(() => {\n        if (this.parentSkeleton && this.parentSkeleton.skeleton) {\n          this.parentSkeleton.skeleton.bones.push(this.bone!);\n        }\n      });\n    });\n  }\n}\n\n@NgModule({\n  declarations: [NgtSkinnedMesh, NgtBone, NgtSkeleton],\n  exports: [\n    NgtSkinnedMesh,\n    NgtBone,\n    NgtSkeleton,\n    NgtMaterialGeometryControllerModule,\n  ],\n})\nexport class NgtSkinnedMeshModule {}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n"],"names":[],"mappings":"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"}