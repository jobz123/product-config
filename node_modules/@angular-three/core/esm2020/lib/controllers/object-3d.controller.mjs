var _NgtObject3dController_instances, _NgtObject3dController_object3d, _NgtObject3dController_inputChangesSubscription, _NgtObject3dController_initFn, _NgtObject3dController_change$, _NgtObject3dController_objectReady, _NgtObject3dController_appendToParent, _NgtObject3dController_addToScene, _NgtObject3dController_addToParent, _NgtObject3dController_remove, _NgtObject3dController_eventNameToHandler, _NgtObject3dController_applyCustomProps;
import { __classPrivateFieldGet, __classPrivateFieldSet } from "tslib";
// GENERATED
import { Directive, Inject, NgModule, NgZone, Optional, SkipSelf, } from '@angular/core';
import { requestAnimationFrame } from '@rx-angular/cdk/zone-less';
import { defer, map, merge, take } from 'rxjs';
import { NgtEventsStore } from '../stores/events.store';
import { NgtStore } from '../stores/store';
import { applyProps } from '../utils/apply-props';
import { NGT_ANIMATION_SUBSCRIBER_CONTROLLER_PROVIDER, NGT_ANIMATION_SUBSCRIBER_WATCHED_CONTROLLER, NgtAnimationSubscriberController, NgtAnimationSubscriberControllerModule, } from './animation-subscriber.controller';
import { Controller, createControllerProviderFactory } from './controller';
import { NGT_OBJECT_INPUTS_CONTROLLER_PROVIDER, NGT_OBJECT_INPUTS_WATCHED_CONTROLLER, NgtObject3dInputsController, NgtObject3dInputsControllerModule, } from './object-3d-inputs.controller';
import * as i0 from "@angular/core";
import * as i1 from "../stores/store";
import * as i2 from "../stores/events.store";
import * as i3 from "./object-3d-inputs.controller";
import * as i4 from "./animation-subscriber.controller";
const supportedEvents = [
    'click',
    'contextmenu',
    'dblclick',
    'pointerup',
    'pointerdown',
    'pointerover',
    'pointerout',
    'pointerenter',
    'pointerleave',
    'pointermove',
    'pointermissed',
    'pointercancel',
    'wheel',
];
export class NgtObject3dController extends Controller {
    constructor(ngZone, store, eventsStore, objectInputsController, animationSubscriberController, parentObject3d) {
        super(ngZone);
        this.store = store;
        this.eventsStore = eventsStore;
        this.objectInputsController = objectInputsController;
        this.animationSubscriberController = animationSubscriberController;
        this.parentObject3d = parentObject3d;
        _NgtObject3dController_instances.add(this);
        _NgtObject3dController_object3d.set(this, void 0);
        _NgtObject3dController_inputChangesSubscription.set(this, void 0);
        _NgtObject3dController_initFn.set(this, void 0);
        _NgtObject3dController_change$.set(this, defer(() => {
            if (this.objectInputsController.object3dInputsController) {
                return merge(this.objectInputsController.change$.pipe(map((changes) => ({
                    changes,
                    controller: this.objectInputsController,
                }))), this.objectInputsController.object3dInputsController.change$.pipe(map((changes) => ({
                    changes,
                    controller: this.objectInputsController.object3dInputsController,
                }))));
            }
            return this.objectInputsController.change$.pipe(map((changes) => ({
                changes,
                controller: this.objectInputsController,
            })));
        }).pipe(map(({ changes, controller }) => {
            return Object.keys(changes).reduce((trueChanges, key) => {
                trueChanges[key] = controller[key];
                return trueChanges;
            }, {});
        })));
    }
    set initFn(v) {
        __classPrivateFieldSet(this, _NgtObject3dController_initFn, v, "f");
    }
    get initFn() {
        if (!__classPrivateFieldGet(this, _NgtObject3dController_initFn, "f")) {
            this.initFn = () => this.object3d;
        }
        return __classPrivateFieldGet(this, _NgtObject3dController_initFn, "f");
    }
    ngOnInit() {
        super.ngOnInit();
        __classPrivateFieldSet(this, _NgtObject3dController_inputChangesSubscription, __classPrivateFieldGet(this, _NgtObject3dController_change$, "f").subscribe((changes) => {
            if (this.object3d) {
                __classPrivateFieldGet(this, _NgtObject3dController_instances, "m", _NgtObject3dController_applyCustomProps).call(this, changes);
            }
        }), "f");
    }
    init() {
        this.ngZone.runOutsideAngular(() => {
            __classPrivateFieldSet(this, _NgtObject3dController_object3d, this.initFn(), "f");
            if (this.object3d) {
                __classPrivateFieldGet(this, _NgtObject3dController_instances, "m", _NgtObject3dController_applyCustomProps).call(this);
                if (!this.disabled) {
                    const observedEvents = supportedEvents.reduce((result, event) => {
                        const controllerEvent = this.objectInputsController[event]
                            .observed
                            ? this.objectInputsController[event]
                            : this.objectInputsController.object3dInputsController?.[event]
                                .observed
                                ? this.objectInputsController.object3dInputsController[event]
                                : null;
                        if (controllerEvent) {
                            result.handlers[event] = __classPrivateFieldGet(this, _NgtObject3dController_instances, "m", _NgtObject3dController_eventNameToHandler).call(this, controllerEvent);
                            result.eventCount += 1;
                        }
                        return result;
                    }, { handlers: {}, eventCount: 0 });
                    // setup __ngt instance
                    applyProps(this.object3d, {
                        __ngt: {
                            stateGetter: () => this.store.get(),
                            eventsStateGetter: () => this.eventsStore.get(),
                            handlers: observedEvents.handlers,
                            eventCount: observedEvents.eventCount,
                            linear: this.store.get('linear'),
                        },
                    });
                    // add as an interaction if there are events observed
                    if (observedEvents.eventCount > 0) {
                        this.eventsStore.addInteraction(this.object3d);
                    }
                    this.store.set((state) => ({
                        ...state,
                        objects: { ...state.objects, [this.object3d.uuid]: this.object3d },
                    }));
                    if (this.objectInputsController.appendMode !== 'none') {
                        __classPrivateFieldGet(this, _NgtObject3dController_instances, "m", _NgtObject3dController_appendToParent).call(this);
                    }
                }
                __classPrivateFieldGet(this, _NgtObject3dController_instances, "m", _NgtObject3dController_objectReady).call(this);
            }
        });
    }
    ngOnDestroy() {
        if (__classPrivateFieldGet(this, _NgtObject3dController_inputChangesSubscription, "f")) {
            __classPrivateFieldGet(this, _NgtObject3dController_inputChangesSubscription, "f").unsubscribe();
        }
        if (this.object3d) {
            __classPrivateFieldGet(this, _NgtObject3dController_instances, "m", _NgtObject3dController_remove).call(this);
            this.store.set((state) => {
                const { [this.object3d.uuid]: _, ...objects } = state.objects;
                return { ...state, objects };
            });
            this.eventsStore.removeInteraction(this.object3d.uuid);
        }
    }
    get object3d() {
        return __classPrivateFieldGet(this, _NgtObject3dController_object3d, "f");
    }
    get controller() {
        return undefined;
    }
    get props() {
        return [];
    }
}
_NgtObject3dController_object3d = new WeakMap(), _NgtObject3dController_inputChangesSubscription = new WeakMap(), _NgtObject3dController_initFn = new WeakMap(), _NgtObject3dController_change$ = new WeakMap(), _NgtObject3dController_instances = new WeakSet(), _NgtObject3dController_objectReady = function _NgtObject3dController_objectReady() {
    if (this.readyFn) {
        this.readyFn();
    }
    if (this.animationSubscriberController) {
        this.animationSubscriberController.prepare(this.object3d);
    }
}, _NgtObject3dController_appendToParent = function _NgtObject3dController_appendToParent() {
    // Schedule this in the next loop to allow for all appendTo's to settle
    // TODO: find better way
    requestAnimationFrame(() => {
        if (this.objectInputsController.appendTo) {
            this.objectInputsController.appendTo.add(this.object3d);
            return;
        }
        if (this.objectInputsController.appendMode === 'root') {
            __classPrivateFieldGet(this, _NgtObject3dController_instances, "m", _NgtObject3dController_addToScene).call(this);
            return;
        }
        if (this.objectInputsController.appendMode === 'immediate') {
            __classPrivateFieldGet(this, _NgtObject3dController_instances, "m", _NgtObject3dController_addToParent).call(this);
        }
    });
}, _NgtObject3dController_addToScene = function _NgtObject3dController_addToScene() {
    const scene = this.store.get('scene');
    if (scene) {
        scene.add(this.object3d);
    }
}, _NgtObject3dController_addToParent = function _NgtObject3dController_addToParent() {
    if (this.parentObject3d) {
        this.parentObject3d.object3d.add(this.object3d);
    }
    else {
        __classPrivateFieldGet(this, _NgtObject3dController_instances, "m", _NgtObject3dController_addToScene).call(this);
    }
}, _NgtObject3dController_remove = function _NgtObject3dController_remove() {
    if (this.objectInputsController.appendTo) {
        this.objectInputsController.appendTo.remove(this.object3d);
    }
    else if (this.parentObject3d &&
        this.objectInputsController.appendMode === 'immediate') {
        this.parentObject3d.object3d.remove(this.object3d);
    }
    else {
        const scene = this.store.get('scene');
        if (scene) {
            scene.remove(this.object3d);
        }
    }
    if (this.object3d.clear) {
        this.object3d.clear();
    }
}, _NgtObject3dController_eventNameToHandler = function _NgtObject3dController_eventNameToHandler(controllerEvent) {
    return (event) => {
        this.ngZone.run(() => {
            controllerEvent.emit(event);
        });
    };
}, _NgtObject3dController_applyCustomProps = function _NgtObject3dController_applyCustomProps(changes) {
    this.ngZone.runOutsideAngular(() => {
        const customProps = {
            castShadow: this.objectInputsController.castShadow,
            receiveShadow: this.objectInputsController.receiveShadow,
            visible: this.objectInputsController.visible,
            matrixAutoUpdate: this.objectInputsController.matrixAutoUpdate,
        };
        if (this.objectInputsController.name) {
            customProps['name'] = this.objectInputsController.name;
        }
        if (this.objectInputsController.position) {
            customProps['position'] = this.objectInputsController.position;
        }
        if (this.objectInputsController.rotation) {
            customProps['rotation'] = this.objectInputsController.rotation;
        }
        else if (this.objectInputsController.quaternion) {
            customProps['quaternion'] = this.objectInputsController.quaternion;
        }
        if (this.objectInputsController.scale) {
            customProps['scale'] = this.objectInputsController.scale;
        }
        if (this.objectInputsController.userData) {
            customProps['userData'] = this.objectInputsController.userData;
        }
        if (this.objectInputsController.color) {
            customProps['color'] = this.objectInputsController.color;
            if (!this.store.get('linear')) {
                customProps['color'].convertSRGBToLinear();
            }
        }
        if (this.objectInputsController.dispose) {
            customProps['dispose'] = this.objectInputsController.dispose;
        }
        if (this.objectInputsController.raycast) {
            customProps['raycast'] = this.objectInputsController.raycast;
        }
        if (changes) {
            Object.assign(customProps, changes);
        }
        __classPrivateFieldGet(this, _NgtObject3dController_change$, "f").pipe(take(1)).subscribe((changes) => {
            if (changes) {
                for (const [inputName, inputChange] of Object.entries(changes)) {
                    if ([
                        'name',
                        'position',
                        'rotation',
                        'quaternion',
                        'scale',
                        'userData',
                        'color',
                        'dispose',
                        'raycast',
                        'castShadow',
                        'receiveShadow',
                        'visible',
                        'matrixAutoUpdate',
                        'object3dController',
                    ].includes(inputName) // skip 14 common inputs
                    ) {
                        continue;
                    }
                    customProps[inputName] = inputChange;
                }
            }
        });
        applyProps(this.object3d, customProps);
        this.object3d.updateMatrix?.();
    });
};
NgtObject3dController.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.1.1", ngImport: i0, type: NgtObject3dController, deps: [{ token: i0.NgZone }, { token: i1.NgtStore }, { token: i2.NgtEventsStore }, { token: NGT_OBJECT_INPUTS_WATCHED_CONTROLLER }, { token: NGT_ANIMATION_SUBSCRIBER_WATCHED_CONTROLLER }, { token: NgtObject3dController, optional: true, skipSelf: true }], target: i0.ɵɵFactoryTarget.Directive });
NgtObject3dController.ɵdir = i0.ɵɵngDeclareDirective({ minVersion: "12.0.0", version: "13.1.1", type: NgtObject3dController, selector: "\n    ngt-primitive,\n    ngt-bone,\n    ngt-group,\n    ngt-lod,\n    ngt-points,\n    ngt-mesh,\n    ngt-instanced-mesh,\n    ngt-skinned-mesh,\n    ngt-audio,\n    ngt-positional-audio,\n    ngt-line,\n    ngt-line-loop,\n    ngt-line-segments,\n    ngt-light-probe,\n    ngt-ambient-light,\n    ngt-ambient-light-probe,\n    ngt-hemisphere-light,\n    ngt-hemisphere-light-probe,\n    ngt-directional-light,\n    ngt-point-light,\n    ngt-spot-light,\n    ngt-rect-area-light,\n    ngt-arrow-helper,\n    ngt-axes-helper,\n    ngt-box3-helper,\n    ngt-grid-helper,\n    ngt-plane-helper,\n    ngt-polar-grid-helper,\n    ngt-sprite,\n    ngt-camera,\n    ngt-perspective-camera,\n    ngt-orthographic-camera,\n    ngt-array-camera,\n    ngt-stereo-camera,\n    ngt-cube-camera\n  ", providers: [
        NGT_OBJECT_INPUTS_CONTROLLER_PROVIDER,
        NGT_ANIMATION_SUBSCRIBER_CONTROLLER_PROVIDER,
    ], exportAs: ["ngtObject3dController"], usesInheritance: true, ngImport: i0 });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.1.1", ngImport: i0, type: NgtObject3dController, decorators: [{
            type: Directive,
            args: [{
                    selector: `
    ngt-primitive,
    ngt-bone,
    ngt-group,
    ngt-lod,
    ngt-points,
    ngt-mesh,
    ngt-instanced-mesh,
    ngt-skinned-mesh,
    ngt-audio,
    ngt-positional-audio,
    ngt-line,
    ngt-line-loop,
    ngt-line-segments,
    ngt-light-probe,
    ngt-ambient-light,
    ngt-ambient-light-probe,
    ngt-hemisphere-light,
    ngt-hemisphere-light-probe,
    ngt-directional-light,
    ngt-point-light,
    ngt-spot-light,
    ngt-rect-area-light,
    ngt-arrow-helper,
    ngt-axes-helper,
    ngt-box3-helper,
    ngt-grid-helper,
    ngt-plane-helper,
    ngt-polar-grid-helper,
    ngt-sprite,
    ngt-camera,
    ngt-perspective-camera,
    ngt-orthographic-camera,
    ngt-array-camera,
    ngt-stereo-camera,
    ngt-cube-camera
  `,
                    exportAs: 'ngtObject3dController',
                    providers: [
                        NGT_OBJECT_INPUTS_CONTROLLER_PROVIDER,
                        NGT_ANIMATION_SUBSCRIBER_CONTROLLER_PROVIDER,
                    ],
                }]
        }], ctorParameters: function () { return [{ type: i0.NgZone }, { type: i1.NgtStore }, { type: i2.NgtEventsStore }, { type: i3.NgtObject3dInputsController, decorators: [{
                    type: Inject,
                    args: [NGT_OBJECT_INPUTS_WATCHED_CONTROLLER]
                }] }, { type: i4.NgtAnimationSubscriberController, decorators: [{
                    type: Inject,
                    args: [NGT_ANIMATION_SUBSCRIBER_WATCHED_CONTROLLER]
                }] }, { type: NgtObject3dController, decorators: [{
                    type: Optional
                }, {
                    type: SkipSelf
                }] }]; } });
export class NgtObject3dControllerModule {
}
NgtObject3dControllerModule.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.1.1", ngImport: i0, type: NgtObject3dControllerModule, deps: [], target: i0.ɵɵFactoryTarget.NgModule });
NgtObject3dControllerModule.ɵmod = i0.ɵɵngDeclareNgModule({ minVersion: "12.0.0", version: "13.1.1", ngImport: i0, type: NgtObject3dControllerModule, declarations: [NgtObject3dController], exports: [NgtObject3dController, NgtObject3dInputsControllerModule,
        NgtAnimationSubscriberControllerModule] });
NgtObject3dControllerModule.ɵinj = i0.ɵɵngDeclareInjector({ minVersion: "12.0.0", version: "13.1.1", ngImport: i0, type: NgtObject3dControllerModule, imports: [NgtObject3dInputsControllerModule,
        NgtAnimationSubscriberControllerModule] });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.1.1", ngImport: i0, type: NgtObject3dControllerModule, decorators: [{
            type: NgModule,
            args: [{
                    declarations: [NgtObject3dController],
                    exports: [
                        NgtObject3dController,
                        NgtObject3dInputsControllerModule,
                        NgtAnimationSubscriberControllerModule,
                    ],
                }]
        }] });
export const [NGT_OBJECT_WATCHED_CONTROLLER, NGT_OBJECT_CONTROLLER_PROVIDER] = createControllerProviderFactory({
    watchedControllerTokenName: 'Watched Object3dController',
    controller: NgtObject3dController,
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib2JqZWN0LTNkLmNvbnRyb2xsZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9wYWNrYWdlcy9jb3JlL3NyYy9saWIvY29udHJvbGxlcnMvb2JqZWN0LTNkLmNvbnRyb2xsZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxZQUFZO0FBQ1osT0FBTyxFQUNMLFNBQVMsRUFFVCxNQUFNLEVBQ04sUUFBUSxFQUNSLE1BQU0sRUFFTixRQUFRLEVBQ1IsUUFBUSxHQUNULE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBQ2xFLE9BQU8sRUFBRSxLQUFLLEVBQUUsR0FBRyxFQUFFLEtBQUssRUFBZ0IsSUFBSSxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBRTdELE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUN4RCxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFPM0MsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQ2xELE9BQU8sRUFDTCw0Q0FBNEMsRUFDNUMsMkNBQTJDLEVBQzNDLGdDQUFnQyxFQUNoQyxzQ0FBc0MsR0FDdkMsTUFBTSxtQ0FBbUMsQ0FBQztBQUMzQyxPQUFPLEVBQUUsVUFBVSxFQUFFLCtCQUErQixFQUFFLE1BQU0sY0FBYyxDQUFDO0FBQzNFLE9BQU8sRUFDTCxxQ0FBcUMsRUFDckMsb0NBQW9DLEVBQ3BDLDJCQUEyQixFQUMzQixpQ0FBaUMsR0FDbEMsTUFBTSwrQkFBK0IsQ0FBQzs7Ozs7O0FBRXZDLE1BQU0sZUFBZSxHQUFHO0lBQ3RCLE9BQU87SUFDUCxhQUFhO0lBQ2IsVUFBVTtJQUNWLFdBQVc7SUFDWCxhQUFhO0lBQ2IsYUFBYTtJQUNiLFlBQVk7SUFDWixjQUFjO0lBQ2QsY0FBYztJQUNkLGFBQWE7SUFDYixlQUFlO0lBQ2YsZUFBZTtJQUNmLE9B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b0M7OzBCQUUzQyxNQUFNOzJCQUFDLDJDQUEyQzs4QkFFSCxxQkFBcUI7MEJBQXBFLFFBQVE7OzBCQUFJLFFBQVE7O0FBa1J6QixNQUFNLE9BQU8sMkJBQTJCOzt3SEFBM0IsMkJBQTJCO3lIQUEzQiwyQkFBMkIsaUJBM1UzQixxQkFBcUIsYUFBckIscUJBQXFCLEVBdVU5QixpQ0FBaUM7UUFDakMsc0NBQXNDO3lIQUc3QiwyQkFBMkIsWUFKcEMsaUNBQWlDO1FBQ2pDLHNDQUFzQzsyRkFHN0IsMkJBQTJCO2tCQVJ2QyxRQUFRO21CQUFDO29CQUNSLFlBQVksRUFBRSxDQUFDLHFCQUFxQixDQUFDO29CQUNyQyxPQUFPLEVBQUU7d0JBQ1AscUJBQXFCO3dCQUNyQixpQ0FBaUM7d0JBQ2pDLHNDQUFzQztxQkFDdkM7aUJBQ0Y7O0FBR0QsTUFBTSxDQUFDLE1BQU0sQ0FBQyw2QkFBNkIsRUFBRSw4QkFBOEIsQ0FBQyxHQUMxRSwrQkFBK0IsQ0FBQztJQUM5QiwwQkFBMEIsRUFBRSw0QkFBNEI7SUFDeEQsVUFBVSxFQUFFLHFCQUFxQjtDQUNsQyxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBHRU5FUkFURURcbmltcG9ydCB7XG4gIERpcmVjdGl2ZSxcbiAgRXZlbnRFbWl0dGVyLFxuICBJbmplY3QsXG4gIE5nTW9kdWxlLFxuICBOZ1pvbmUsXG4gIE9uRGVzdHJveSxcbiAgT3B0aW9uYWwsXG4gIFNraXBTZWxmLFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IHJlcXVlc3RBbmltYXRpb25GcmFtZSB9IGZyb20gJ0ByeC1hbmd1bGFyL2Nkay96b25lLWxlc3MnO1xuaW1wb3J0IHsgZGVmZXIsIG1hcCwgbWVyZ2UsIFN1YnNjcmlwdGlvbiwgdGFrZSB9IGZyb20gJ3J4anMnO1xuaW1wb3J0ICogYXMgVEhSRUUgZnJvbSAndGhyZWUnO1xuaW1wb3J0IHsgTmd0RXZlbnRzU3RvcmUgfSBmcm9tICcuLi9zdG9yZXMvZXZlbnRzLnN0b3JlJztcbmltcG9ydCB7IE5ndFN0b3JlIH0gZnJvbSAnLi4vc3RvcmVzL3N0b3JlJztcbmltcG9ydCB7XG4gIE5ndEV2ZW50LFxuICBOZ3RFdmVudEhhbmRsZXJzLFxuICBOZ3RJbnN0YW5jZUludGVybmFsLFxuICBVbmtub3duUmVjb3JkLFxufSBmcm9tICcuLi90eXBlcyc7XG5pbXBvcnQgeyBhcHBseVByb3BzIH0gZnJvbSAnLi4vdXRpbHMvYXBwbHktcHJvcHMnO1xuaW1wb3J0IHtcbiAgTkdUX0FOSU1BVElPTl9TVUJTQ1JJQkVSX0NPTlRST0xMRVJfUFJPVklERVIsXG4gIE5HVF9BTklNQVRJT05fU1VCU0NSSUJFUl9XQVRDSEVEX0NPTlRST0xMRVIsXG4gIE5ndEFuaW1hdGlvblN1YnNjcmliZXJDb250cm9sbGVyLFxuICBOZ3RBbmltYXRpb25TdWJzY3JpYmVyQ29udHJvbGxlck1vZHVsZSxcbn0gZnJvbSAnLi9hbmltYXRpb24tc3Vic2NyaWJlci5jb250cm9sbGVyJztcbmltcG9ydCB7IENvbnRyb2xsZXIsIGNyZWF0ZUNvbnRyb2xsZXJQcm92aWRlckZhY3RvcnkgfSBmcm9tICcuL2NvbnRyb2xsZXInO1xuaW1wb3J0IHtcbiAgTkdUX09CSkVDVF9JTlBVVFNfQ09OVFJPTExFUl9QUk9WSURFUixcbiAgTkdUX09CSkVDVF9JTlBVVFNfV0FUQ0hFRF9DT05UUk9MTEVSLFxuICBOZ3RPYmplY3QzZElucHV0c0NvbnRyb2xsZXIsXG4gIE5ndE9iamVjdDNkSW5wdXRzQ29udHJvbGxlck1vZHVsZSxcbn0gZnJvbSAnLi9vYmplY3QtM2QtaW5wdXRzLmNvbnRyb2xsZXInO1xuXG5jb25zdCBzdXBwb3J0ZWRFdmVudHMgPSBbXG4gICdjbGljaycsXG4gICdjb250ZXh0bWVudScsXG4gICdkYmxjbGljaycsXG4gICdwb2ludGVydXAnLFxuICAncG9pbnRlcmRvd24nLFxuICAncG9pbnRlcm92ZXInLFxuICAncG9pbnRlcm91dCcsXG4gICdwb2ludGVyZW50ZXInLFxuICAncG9pbnRlcmxlYXZlJyxcbiAgJ3BvaW50ZXJtb3ZlJyxcbiAgJ3BvaW50ZXJtaXNzZWQnLFxuICAncG9pbnRlcmNhbmNlbCcsXG4gICd3aGVlbCcsXG5dIGFzIGNvbnN0O1xuXG5ARGlyZWN0aXZlKHtcbiAgc2VsZWN0b3I6IGBcbiAgICBuZ3QtcHJpbWl0aXZlLFxuICAgIG5ndC1ib25lLFxuICAgIG5ndC1ncm91cCxcbiAgICBuZ3QtbG9kLFxuICAgIG5ndC1wb2ludHMsXG4gICAgbmd0LW1lc2gsXG4gICAgbmd0LWluc3RhbmNlZC1tZXNoLFxuICAgIG5ndC1za2lubmVkLW1lc2gsXG4gICAgbmd0LWF1ZGlvLFxuICAgIG5ndC1wb3NpdGlvbmFsLWF1ZGlvLFxuICAgIG5ndC1saW5lLFxuICAgIG5ndC1saW5lLWxvb3AsXG4gICAgbmd0LWxpbmUtc2VnbWVudHMsXG4gICAgbmd0LWxpZ2h0LXByb2JlLFxuICAgIG5ndC1hbWJpZW50LWxpZ2h0LFxuICAgIG5ndC1hbWJpZW50LWxpZ2h0LXByb2JlLFxuICAgIG5ndC1oZW1pc3BoZXJlLWxpZ2h0LFxuICAgIG5ndC1oZW1pc3BoZXJlLWxpZ2h0LXByb2JlLFxuICAgIG5ndC1kaXJlY3Rpb25hbC1saWdodCxcbiAgICBuZ3QtcG9pbnQtbGlnaHQsXG4gICAgbmd0LXNwb3QtbGlnaHQsXG4gICAgbmd0LXJlY3QtYXJlYS1saWdodCxcbiAgICBuZ3QtYXJyb3ctaGVscGVyLFxuICAgIG5ndC1heGVzLWhlbHBlcixcbiAgICBuZ3QtYm94My1oZWxwZXIsXG4gICAgbmd0LWdyaWQtaGVscGVyLFxuICAgIG5ndC1wbGFuZS1oZWxwZXIsXG4gICAgbmd0LXBvbGFyLWdyaWQtaGVscGVyLFxuICAgIG5ndC1zcHJpdGUsXG4gICAgbmd0LWNhbWVyYSxcbiAgICBuZ3QtcGVyc3BlY3RpdmUtY2FtZXJhLFxuICAgIG5ndC1vcnRob2dyYXBoaWMtY2FtZXJhLFxuICAgIG5ndC1hcnJheS1jYW1lcmEsXG4gICAgbmd0LXN0ZXJlby1jYW1lcmEsXG4gICAgbmd0LWN1YmUtY2FtZXJhXG4gIGAsXG4gIGV4cG9ydEFzOiAnbmd0T2JqZWN0M2RDb250cm9sbGVyJyxcbiAgcHJvdmlkZXJzOiBbXG4gICAgTkdUX09CSkVDVF9JTlBVVFNfQ09OVFJPTExFUl9QUk9WSURFUixcbiAgICBOR1RfQU5JTUFUSU9OX1NVQlNDUklCRVJfQ09OVFJPTExFUl9QUk9WSURFUixcbiAgXSxcbn0pXG5leHBvcnQgY2xhc3MgTmd0T2JqZWN0M2RDb250cm9sbGVyIGV4dGVuZHMgQ29udHJvbGxlciBpbXBsZW1lbnRzIE9uRGVzdHJveSB7XG4gICNvYmplY3QzZD86IFRIUkVFLk9iamVjdDNEO1xuICAjaW5wdXRDaGFuZ2VzU3Vic2NyaXB0aW9uPzogU3Vic2NyaXB0aW9uO1xuXG4gICNpbml0Rm4/OiAoKSA9PiBUSFJFRS5PYmplY3QzRDtcblxuICBzZXQgaW5pdEZuKHY6ICgpID0+IFRIUkVFLk9iamVjdDNEKSB7XG4gICAgdGhpcy4jaW5pdEZuID0gdjtcbiAgfVxuXG4gIGdldCBpbml0Rm4oKSB7XG4gICAgaWYgKCF0aGlzLiNpbml0Rm4pIHtcbiAgICAgIHRoaXMuaW5pdEZuID0gKCkgPT4gdGhpcy5vYmplY3QzZDtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuI2luaXRGbiBhcyAoKSA9PiBUSFJFRS5PYmplY3QzRDtcbiAgfVxuXG4gICNjaGFuZ2UkID0gZGVmZXIoKCkgPT4ge1xuICAgIGlmICh0aGlzLm9iamVjdElucHV0c0NvbnRyb2xsZXIub2JqZWN0M2RJbnB1dHNDb250cm9sbGVyKSB7XG4gICAgICByZXR1cm4gbWVyZ2UoXG4gICAgICAgIHRoaXMub2JqZWN0SW5wdXRzQ29udHJvbGxlci5jaGFuZ2UkLnBpcGUoXG4gICAgICAgICAgbWFwKChjaGFuZ2VzKSA9PiAoe1xuICAgICAgICAgICAgY2hhbmdlcyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6IHRoaXMub2JqZWN0SW5wdXRzQ29udHJvbGxlcixcbiAgICAgICAgICB9KSlcbiAgICAgICAgKSxcbiAgICAgICAgdGhpcy5vYmplY3RJbnB1dHNDb250cm9sbGVyLm9iamVjdDNkSW5wdXRzQ29udHJvbGxlci5jaGFuZ2UkLnBpcGUoXG4gICAgICAgICAgbWFwKChjaGFuZ2VzKSA9PiAoe1xuICAgICAgICAgICAgY2hhbmdlcyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6IHRoaXMub2JqZWN0SW5wdXRzQ29udHJvbGxlci5vYmplY3QzZElucHV0c0NvbnRyb2xsZXIhLFxuICAgICAgICAgIH0pKVxuICAgICAgICApXG4gICAgICApO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5vYmplY3RJbnB1dHNDb250cm9sbGVyLmNoYW5nZSQucGlwZShcbiAgICAgIG1hcCgoY2hhbmdlcykgPT4gKHtcbiAgICAgICAgY2hhbmdlcyxcbiAgICAgICAgY29udHJvbGxlcjogdGhpcy5vYmplY3RJbnB1dHNDb250cm9sbGVyLFxuICAgICAgfSkpXG4gICAgKTtcbiAgfSkucGlwZShcbiAgICBtYXAoKHsgY2hhbmdlcywgY29udHJvbGxlciB9KSA9PiB7XG4gICAgICByZXR1cm4gT2JqZWN0LmtleXMoY2hhbmdlcykucmVkdWNlKCh0cnVlQ2hhbmdlcywga2V5KSA9PiB7XG4gICAgICAgIHRydWVDaGFuZ2VzW2tleV0gPSBjb250cm9sbGVyW2tleSBhcyBrZXlvZiBOZ3RPYmplY3QzZElucHV0c0NvbnRyb2xsZXJdO1xuICAgICAgICByZXR1cm4gdHJ1ZUNoYW5nZXM7XG4gICAgICB9LCB7fSBhcyBVbmtub3duUmVjb3JkKTtcbiAgICB9KVxuICApO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIG5nWm9uZTogTmdab25lLFxuICAgIHByaXZhdGUgc3RvcmU6IE5ndFN0b3JlLFxuICAgIHByaXZhdGUgZXZlbnRzU3RvcmU6IE5ndEV2ZW50c1N0b3JlLFxuICAgIEBJbmplY3QoTkdUX09CSkVDVF9JTlBVVFNfV0FUQ0hFRF9DT05UUk9MTEVSKVxuICAgIHByaXZhdGUgb2JqZWN0SW5wdXRzQ29udHJvbGxlcjogTmd0T2JqZWN0M2RJbnB1dHNDb250cm9sbGVyLFxuICAgIEBJbmplY3QoTkdUX0FOSU1BVElPTl9TVUJTQ1JJQkVSX1dBVENIRURfQ09OVFJPTExFUilcbiAgICBwcml2YXRlIGFuaW1hdGlvblN1YnNjcmliZXJDb250cm9sbGVyOiBOZ3RBbmltYXRpb25TdWJzY3JpYmVyQ29udHJvbGxlcixcbiAgICBAT3B0aW9uYWwoKSBAU2tpcFNlbGYoKSBwcml2YXRlIHBhcmVudE9iamVjdDNkOiBOZ3RPYmplY3QzZENvbnRyb2xsZXJcbiAgKSB7XG4gICAgc3VwZXIobmdab25lKTtcbiAgfVxuXG4gIG5nT25Jbml0KCkge1xuICAgIHN1cGVyLm5nT25Jbml0KCk7XG4gICAgdGhpcy4jaW5wdXRDaGFuZ2VzU3Vic2NyaXB0aW9uID0gdGhpcy4jY2hhbmdlJC5zdWJzY3JpYmUoKGNoYW5nZXMpID0+IHtcbiAgICAgIGlmICh0aGlzLm9iamVjdDNkKSB7XG4gICAgICAgIHRoaXMuI2FwcGx5Q3VzdG9tUHJvcHMoY2hhbmdlcyk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBpbml0KCkge1xuICAgIHRoaXMubmdab25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IHtcbiAgICAgIHRoaXMuI29iamVjdDNkID0gdGhpcy5pbml0Rm4oKTtcbiAgICAgIGlmICh0aGlzLm9iamVjdDNkKSB7XG4gICAgICAgIHRoaXMuI2FwcGx5Q3VzdG9tUHJvcHMoKTtcblxuICAgICAgICBpZiAoIXRoaXMuZGlzYWJsZWQpIHtcbiAgICAgICAgICBjb25zdCBvYnNlcnZlZEV2ZW50cyA9IHN1cHBvcnRlZEV2ZW50cy5yZWR1Y2UoXG4gICAgICAgICAgICAocmVzdWx0LCBldmVudCkgPT4ge1xuICAgICAgICAgICAgICBjb25zdCBjb250cm9sbGVyRXZlbnQgPSB0aGlzLm9iamVjdElucHV0c0NvbnRyb2xsZXJbZXZlbnRdXG4gICAgICAgICAgICAgICAgLm9ic2VydmVkXG4gICAgICAgICAgICAgICAgPyB0aGlzLm9iamVjdElucHV0c0NvbnRyb2xsZXJbZXZlbnRdXG4gICAgICAgICAgICAgICAgOiB0aGlzLm9iamVjdElucHV0c0NvbnRyb2xsZXIub2JqZWN0M2RJbnB1dHNDb250cm9sbGVyPy5bZXZlbnRdXG4gICAgICAgICAgICAgICAgICAgIC5vYnNlcnZlZFxuICAgICAgICAgICAgICAgID8gdGhpcy5vYmplY3RJbnB1dHNDb250cm9sbGVyLm9iamVjdDNkSW5wdXRzQ29udHJvbGxlcltldmVudF1cbiAgICAgICAgICAgICAgICA6IG51bGw7XG4gICAgICAgICAgICAgIGlmIChjb250cm9sbGVyRXZlbnQpIHtcbiAgICAgICAgICAgICAgICByZXN1bHQuaGFuZGxlcnNbZXZlbnRdID0gdGhpcy4jZXZlbnROYW1lVG9IYW5kbGVyKFxuICAgICAgICAgICAgICAgICAgY29udHJvbGxlckV2ZW50IGFzIEV2ZW50RW1pdHRlcjxOZ3RFdmVudDxhbnk+PlxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgcmVzdWx0LmV2ZW50Q291bnQgKz0gMTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHsgaGFuZGxlcnM6IHt9LCBldmVudENvdW50OiAwIH0gYXMge1xuICAgICAgICAgICAgICBoYW5kbGVyczogTmd0RXZlbnRIYW5kbGVycztcbiAgICAgICAgICAgICAgZXZlbnRDb3VudDogbnVtYmVyO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICk7XG5cbiAgICAgICAgICAvLyBzZXR1cCBfX25ndCBpbnN0YW5jZVxuICAgICAgICAgIGFwcGx5UHJvcHModGhpcy5vYmplY3QzZCwge1xuICAgICAgICAgICAgX19uZ3Q6IHtcbiAgICAgICAgICAgICAgc3RhdGVHZXR0ZXI6ICgpID0+IHRoaXMuc3RvcmUuZ2V0KCksXG4gICAgICAgICAgICAgIGV2ZW50c1N0YXRlR2V0dGVyOiAoKSA9PiB0aGlzLmV2ZW50c1N0b3JlLmdldCgpLFxuICAgICAgICAgICAgICBoYW5kbGVyczogb2JzZXJ2ZWRFdmVudHMuaGFuZGxlcnMsXG4gICAgICAgICAgICAgIGV2ZW50Q291bnQ6IG9ic2VydmVkRXZlbnRzLmV2ZW50Q291bnQsXG4gICAgICAgICAgICAgIGxpbmVhcjogdGhpcy5zdG9yZS5nZXQoJ2xpbmVhcicpLFxuICAgICAgICAgICAgfSBhcyBOZ3RJbnN0YW5jZUludGVybmFsLFxuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgLy8gYWRkIGFzIGFuIGludGVyYWN0aW9uIGlmIHRoZXJlIGFyZSBldmVudHMgb2JzZXJ2ZWRcbiAgICAgICAgICBpZiAob2JzZXJ2ZWRFdmVudHMuZXZlbnRDb3VudCA+IDApIHtcbiAgICAgICAgICAgIHRoaXMuZXZlbnRzU3RvcmUuYWRkSW50ZXJhY3Rpb24odGhpcy5vYmplY3QzZCk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgdGhpcy5zdG9yZS5zZXQoKHN0YXRlKSA9PiAoe1xuICAgICAgICAgICAgLi4uc3RhdGUsXG4gICAgICAgICAgICBvYmplY3RzOiB7IC4uLnN0YXRlLm9iamVjdHMsIFt0aGlzLm9iamVjdDNkLnV1aWRdOiB0aGlzLm9iamVjdDNkIH0sXG4gICAgICAgICAgfSkpO1xuXG4gICAgICAgICAgaWYgKHRoaXMub2JqZWN0SW5wdXRzQ29udHJvbGxlci5hcHBlbmRNb2RlICE9PSAnbm9uZScpIHtcbiAgICAgICAgICAgIHRoaXMuI2FwcGVuZFRvUGFyZW50KCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy4jb2JqZWN0UmVhZHkoKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gICNvYmplY3RSZWFkeSgpIHtcbiAgICBpZiAodGhpcy5yZWFkeUZuKSB7XG4gICAgICB0aGlzLnJlYWR5Rm4oKTtcbiAgICB9XG4gICAgaWYgKHRoaXMuYW5pbWF0aW9uU3Vic2NyaWJlckNvbnRyb2xsZXIpIHtcbiAgICAgIHRoaXMuYW5pbWF0aW9uU3Vic2NyaWJlckNvbnRyb2xsZXIucHJlcGFyZSh0aGlzLm9iamVjdDNkKTtcbiAgICB9XG4gIH1cblxuICAjYXBwZW5kVG9QYXJlbnQoKTogdm9pZCB7XG4gICAgLy8gU2NoZWR1bGUgdGhpcyBpbiB0aGUgbmV4dCBsb29wIHRvIGFsbG93IGZvciBhbGwgYXBwZW5kVG8ncyB0byBzZXR0bGVcbiAgICAvLyBUT0RPOiBmaW5kIGJldHRlciB3YXlcbiAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKCkgPT4ge1xuICAgICAgaWYgKHRoaXMub2JqZWN0SW5wdXRzQ29udHJvbGxlci5hcHBlbmRUbykge1xuICAgICAgICB0aGlzLm9iamVjdElucHV0c0NvbnRyb2xsZXIuYXBwZW5kVG8uYWRkKHRoaXMub2JqZWN0M2QpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGlmICh0aGlzLm9iamVjdElucHV0c0NvbnRyb2xsZXIuYXBwZW5kTW9kZSA9PT0gJ3Jvb3QnKSB7XG4gICAgICAgIHRoaXMuI2FkZFRvU2NlbmUoKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBpZiAodGhpcy5vYmplY3RJbnB1dHNDb250cm9sbGVyLmFwcGVuZE1vZGUgPT09ICdpbW1lZGlhdGUnKSB7XG4gICAgICAgIHRoaXMuI2FkZFRvUGFyZW50KCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICAjYWRkVG9TY2VuZSgpIHtcbiAgICBjb25zdCBzY2VuZSA9IHRoaXMuc3RvcmUuZ2V0KCdzY2VuZScpO1xuICAgIGlmIChzY2VuZSkge1xuICAgICAgc2NlbmUuYWRkKHRoaXMub2JqZWN0M2QpO1xuICAgIH1cbiAgfVxuXG4gICNhZGRUb1BhcmVudCgpIHtcbiAgICBpZiAodGhpcy5wYXJlbnRPYmplY3QzZCkge1xuICAgICAgdGhpcy5wYXJlbnRPYmplY3QzZC5vYmplY3QzZC5hZGQodGhpcy5vYmplY3QzZCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuI2FkZFRvU2NlbmUoKTtcbiAgICB9XG4gIH1cblxuICAjcmVtb3ZlKCkge1xuICAgIGlmICh0aGlzLm9iamVjdElucHV0c0NvbnRyb2xsZXIuYXBwZW5kVG8pIHtcbiAgICAgIHRoaXMub2JqZWN0SW5wdXRzQ29udHJvbGxlci5hcHBlbmRUby5yZW1vdmUodGhpcy5vYmplY3QzZCk7XG4gICAgfSBlbHNlIGlmIChcbiAgICAgIHRoaXMucGFyZW50T2JqZWN0M2QgJiZcbiAgICAgIHRoaXMub2JqZWN0SW5wdXRzQ29udHJvbGxlci5hcHBlbmRNb2RlID09PSAnaW1tZWRpYXRlJ1xuICAgICkge1xuICAgICAgdGhpcy5wYXJlbnRPYmplY3QzZC5vYmplY3QzZC5yZW1vdmUodGhpcy5vYmplY3QzZCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IHNjZW5lID0gdGhpcy5zdG9yZS5nZXQoJ3NjZW5lJyk7XG4gICAgICBpZiAoc2NlbmUpIHtcbiAgICAgICAgc2NlbmUucmVtb3ZlKHRoaXMub2JqZWN0M2QpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmICh0aGlzLm9iamVjdDNkLmNsZWFyKSB7XG4gICAgICB0aGlzLm9iamVjdDNkLmNsZWFyKCk7XG4gICAgfVxuICB9XG5cbiAgI2V2ZW50TmFtZVRvSGFuZGxlcihcbiAgICBjb250cm9sbGVyRXZlbnQ6XG4gICAgICB8IEV2ZW50RW1pdHRlcjxOZ3RFdmVudDxQb2ludGVyRXZlbnQ+PlxuICAgICAgfCBFdmVudEVtaXR0ZXI8Tmd0RXZlbnQ8V2hlZWxFdmVudD4+XG4gICkge1xuICAgIHJldHVybiAoXG4gICAgICBldmVudDogUGFyYW1ldGVyczxcbiAgICAgICAgRXhjbHVkZTxOZ3RFdmVudEhhbmRsZXJzW3R5cGVvZiBzdXBwb3J0ZWRFdmVudHNbbnVtYmVyXV0sIHVuZGVmaW5lZD5cbiAgICAgID5bMF1cbiAgICApID0+IHtcbiAgICAgIHRoaXMubmdab25lLnJ1bigoKSA9PiB7XG4gICAgICAgIGNvbnRyb2xsZXJFdmVudC5lbWl0KGV2ZW50IGFzIE5ndEV2ZW50PGFueT4pO1xuICAgICAgfSk7XG4gICAgfTtcbiAgfVxuXG4gICNhcHBseUN1c3RvbVByb3BzKGNoYW5nZXM/OiBVbmtub3duUmVjb3JkKSB7XG4gICAgdGhpcy5uZ1pvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4ge1xuICAgICAgY29uc3QgY3VzdG9tUHJvcHMgPSB7XG4gICAgICAgIGNhc3RTaGFkb3c6IHRoaXMub2JqZWN0SW5wdXRzQ29udHJvbGxlci5jYXN0U2hhZG93LFxuICAgICAgICByZWNlaXZlU2hhZG93OiB0aGlzLm9iamVjdElucHV0c0NvbnRyb2xsZXIucmVjZWl2ZVNoYWRvdyxcbiAgICAgICAgdmlzaWJsZTogdGhpcy5vYmplY3RJbnB1dHNDb250cm9sbGVyLnZpc2libGUsXG4gICAgICAgIG1hdHJpeEF1dG9VcGRhdGU6IHRoaXMub2JqZWN0SW5wdXRzQ29udHJvbGxlci5tYXRyaXhBdXRvVXBkYXRlLFxuICAgICAgfSBhcyBVbmtub3duUmVjb3JkO1xuXG4gICAgICBpZiAodGhpcy5vYmplY3RJbnB1dHNDb250cm9sbGVyLm5hbWUpIHtcbiAgICAgICAgY3VzdG9tUHJvcHNbJ25hbWUnXSA9IHRoaXMub2JqZWN0SW5wdXRzQ29udHJvbGxlci5uYW1lO1xuICAgICAgfVxuXG4gICAgICBpZiAodGhpcy5vYmplY3RJbnB1dHNDb250cm9sbGVyLnBvc2l0aW9uKSB7XG4gICAgICAgIGN1c3RvbVByb3BzWydwb3NpdGlvbiddID0gdGhpcy5vYmplY3RJbnB1dHNDb250cm9sbGVyLnBvc2l0aW9uO1xuICAgICAgfVxuXG4gICAgICBpZiAodGhpcy5vYmplY3RJbnB1dHNDb250cm9sbGVyLnJvdGF0aW9uKSB7XG4gICAgICAgIGN1c3RvbVByb3BzWydyb3RhdGlvbiddID0gdGhpcy5vYmplY3RJbnB1dHNDb250cm9sbGVyLnJvdGF0aW9uO1xuICAgICAgfSBlbHNlIGlmICh0aGlzLm9iamVjdElucHV0c0NvbnRyb2xsZXIucXVhdGVybmlvbikge1xuICAgICAgICBjdXN0b21Qcm9wc1sncXVhdGVybmlvbiddID0gdGhpcy5vYmplY3RJbnB1dHNDb250cm9sbGVyLnF1YXRlcm5pb247XG4gICAgICB9XG5cbiAgICAgIGlmICh0aGlzLm9iamVjdElucHV0c0NvbnRyb2xsZXIuc2NhbGUpIHtcbiAgICAgICAgY3VzdG9tUHJvcHNbJ3NjYWxlJ10gPSB0aGlzLm9iamVjdElucHV0c0NvbnRyb2xsZXIuc2NhbGU7XG4gICAgICB9XG5cbiAgICAgIGlmICh0aGlzLm9iamVjdElucHV0c0NvbnRyb2xsZXIudXNlckRhdGEpIHtcbiAgICAgICAgY3VzdG9tUHJvcHNbJ3VzZXJEYXRhJ10gPSB0aGlzLm9iamVjdElucHV0c0NvbnRyb2xsZXIudXNlckRhdGE7XG4gICAgICB9XG5cbiAgICAgIGlmICh0aGlzLm9iamVjdElucHV0c0NvbnRyb2xsZXIuY29sb3IpIHtcbiAgICAgICAgY3VzdG9tUHJvcHNbJ2NvbG9yJ10gPSB0aGlzLm9iamVjdElucHV0c0NvbnRyb2xsZXIuY29sb3I7XG4gICAgICAgIGlmICghdGhpcy5zdG9yZS5nZXQoJ2xpbmVhcicpKSB7XG4gICAgICAgICAgKGN1c3RvbVByb3BzWydjb2xvciddIGFzIFRIUkVFLkNvbG9yKS5jb252ZXJ0U1JHQlRvTGluZWFyKCk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgaWYgKHRoaXMub2JqZWN0SW5wdXRzQ29udHJvbGxlci5kaXNwb3NlKSB7XG4gICAgICAgIGN1c3RvbVByb3BzWydkaXNwb3NlJ10gPSB0aGlzLm9iamVjdElucHV0c0NvbnRyb2xsZXIuZGlzcG9zZTtcbiAgICAgIH1cblxuICAgICAgaWYgKHRoaXMub2JqZWN0SW5wdXRzQ29udHJvbGxlci5yYXljYXN0KSB7XG4gICAgICAgIGN1c3RvbVByb3BzWydyYXljYXN0J10gPSB0aGlzLm9iamVjdElucHV0c0NvbnRyb2xsZXIucmF5Y2FzdDtcbiAgICAgIH1cblxuICAgICAgaWYgKGNoYW5nZXMpIHtcbiAgICAgICAgT2JqZWN0LmFzc2lnbihjdXN0b21Qcm9wcywgY2hhbmdlcyk7XG4gICAgICB9XG5cbiAgICAgIHRoaXMuI2NoYW5nZSQucGlwZSh0YWtlKDEpKS5zdWJzY3JpYmUoKGNoYW5nZXMpID0+IHtcbiAgICAgICAgaWYgKGNoYW5nZXMpIHtcbiAgICAgICAgICBmb3IgKGNvbnN0IFtpbnB1dE5hbWUsIGlucHV0Q2hhbmdlXSBvZiBPYmplY3QuZW50cmllcyhjaGFuZ2VzKSkge1xuICAgICAgICAgICAgaWYgKFxuICAgICAgICAgICAgICBbXG4gICAgICAgICAgICAgICAgJ25hbWUnLFxuICAgICAgICAgICAgICAgICdwb3NpdGlvbicsXG4gICAgICAgICAgICAgICAgJ3JvdGF0aW9uJyxcbiAgICAgICAgICAgICAgICAncXVhdGVybmlvbicsXG4gICAgICAgICAgICAgICAgJ3NjYWxlJyxcbiAgICAgICAgICAgICAgICAndXNlckRhdGEnLFxuICAgICAgICAgICAgICAgICdjb2xvcicsXG4gICAgICAgICAgICAgICAgJ2Rpc3Bvc2UnLFxuICAgICAgICAgICAgICAgICdyYXljYXN0JyxcbiAgICAgICAgICAgICAgICAnY2FzdFNoYWRvdycsXG4gICAgICAgICAgICAgICAgJ3JlY2VpdmVTaGFkb3cnLFxuICAgICAgICAgICAgICAgICd2aXNpYmxlJyxcbiAgICAgICAgICAgICAgICAnbWF0cml4QXV0b1VwZGF0ZScsXG4gICAgICAgICAgICAgICAgJ29iamVjdDNkQ29udHJvbGxlcicsXG4gICAgICAgICAgICAgIF0uaW5jbHVkZXMoaW5wdXROYW1lKSAvLyBza2lwIDE0IGNvbW1vbiBpbnB1dHNcbiAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGN1c3RvbVByb3BzW2lucHV0TmFtZV0gPSBpbnB1dENoYW5nZTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICBhcHBseVByb3BzKHRoaXMub2JqZWN0M2QsIGN1c3RvbVByb3BzKTtcbiAgICAgIHRoaXMub2JqZWN0M2QudXBkYXRlTWF0cml4Py4oKTtcbiAgICB9KTtcbiAgfVxuXG4gIG5nT25EZXN0cm95KCkge1xuICAgIGlmICh0aGlzLiNpbnB1dENoYW5nZXNTdWJzY3JpcHRpb24pIHtcbiAgICAgIHRoaXMuI2lucHV0Q2hhbmdlc1N1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuICAgIH1cblxuICAgIGlmICh0aGlzLm9iamVjdDNkKSB7XG4gICAgICB0aGlzLiNyZW1vdmUoKTtcbiAgICAgIHRoaXMuc3RvcmUuc2V0KChzdGF0ZSkgPT4ge1xuICAgICAgICBjb25zdCB7IFt0aGlzLm9iamVjdDNkLnV1aWRdOiBfLCAuLi5vYmplY3RzIH0gPSBzdGF0ZS5vYmplY3RzO1xuICAgICAgICByZXR1cm4geyAuLi5zdGF0ZSwgb2JqZWN0cyB9O1xuICAgICAgfSk7XG4gICAgICB0aGlzLmV2ZW50c1N0b3JlLnJlbW92ZUludGVyYWN0aW9uKHRoaXMub2JqZWN0M2QudXVpZCk7XG4gICAgfVxuICB9XG5cbiAgZ2V0IG9iamVjdDNkKCk6IFRIUkVFLk9iamVjdDNEIHtcbiAgICByZXR1cm4gdGhpcy4jb2JqZWN0M2QgYXMgVEhSRUUuT2JqZWN0M0Q7XG4gIH1cblxuICBnZXQgY29udHJvbGxlcigpOiBDb250cm9sbGVyIHwgdW5kZWZpbmVkIHtcbiAgICByZXR1cm4gdW5kZWZpbmVkO1xuICB9XG5cbiAgZ2V0IHByb3BzKCk6IHN0cmluZ1tdIHtcbiAgICByZXR1cm4gW107XG4gIH1cbn1cblxuQE5nTW9kdWxlKHtcbiAgZGVjbGFyYXRpb25zOiBbTmd0T2JqZWN0M2RDb250cm9sbGVyXSxcbiAgZXhwb3J0czogW1xuICAgIE5ndE9iamVjdDNkQ29udHJvbGxlcixcbiAgICBOZ3RPYmplY3QzZElucHV0c0NvbnRyb2xsZXJNb2R1bGUsXG4gICAgTmd0QW5pbWF0aW9uU3Vic2NyaWJlckNvbnRyb2xsZXJNb2R1bGUsXG4gIF0sXG59KVxuZXhwb3J0IGNsYXNzIE5ndE9iamVjdDNkQ29udHJvbGxlck1vZHVsZSB7fVxuXG5leHBvcnQgY29uc3QgW05HVF9PQkpFQ1RfV0FUQ0hFRF9DT05UUk9MTEVSLCBOR1RfT0JKRUNUX0NPTlRST0xMRVJfUFJPVklERVJdID1cbiAgY3JlYXRlQ29udHJvbGxlclByb3ZpZGVyRmFjdG9yeSh7XG4gICAgd2F0Y2hlZENvbnRyb2xsZXJUb2tlbk5hbWU6ICdXYXRjaGVkIE9iamVjdDNkQ29udHJvbGxlcicsXG4gICAgY29udHJvbGxlcjogTmd0T2JqZWN0M2RDb250cm9sbGVyLFxuICB9KTtcbiJdfQ==