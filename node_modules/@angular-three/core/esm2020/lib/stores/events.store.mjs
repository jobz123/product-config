var _NgtEventsStore_instances, _NgtEventsStore_connect;
import { __classPrivateFieldGet } from "tslib";
import { Injectable, NgZone } from '@angular/core';
import { noop } from 'rxjs';
import { createEvents } from '../utils/events';
import { EnhancedRxState } from './enhanced-rx-state';
import { NgtStore } from './store';
import * as i0 from "@angular/core";
import * as i1 from "./store";
const names = {
    click: false,
    contextmenu: false,
    dblclick: false,
    wheel: false,
    pointerdown: true,
    pointerup: true,
    pointerleave: true,
    pointermove: true,
    pointercancel: true,
    lostpointercapture: true,
};
export class NgtEventsStore extends EnhancedRxState {
    constructor(store, ngZone) {
        super();
        this.store = store;
        this.ngZone = ngZone;
        _NgtEventsStore_instances.add(this);
        this.actions = this.create();
        this.set({
            pointerMissed: noop,
            connected: false,
            handlers: {},
            internal: {
                interaction: [],
                hovered: new Map(),
                capturedMap: new Map(),
                initialClick: [0, 0],
                initialHits: [],
            },
        });
        ngZone.runOutsideAngular(() => {
            const { handlePointer } = createEvents(this.store.get.bind(this.store), this.get.bind(this));
            this.set({
                handlers: Object.keys(names).reduce((handlers, supportedEventName) => {
                    handlers[supportedEventName] = handlePointer(supportedEventName);
                    return handlers;
                }, {}),
            });
            this.holdEffect(this.actions.element$, __classPrivateFieldGet(this, _NgtEventsStore_instances, "m", _NgtEventsStore_connect).bind(this));
        });
    }
    addInteraction(interaction) {
        this.set((state) => ({
            ...state,
            internal: {
                ...state.internal,
                interaction: [...state.internal.interaction, interaction],
            },
        }));
    }
    removeInteraction(uuid) {
        this.set((state) => ({
            ...state,
            internal: {
                ...state.internal,
                interaction: state.internal.interaction.filter((interaction) => interaction.uuid !== uuid),
            },
        }));
    }
}
_NgtEventsStore_instances = new WeakSet(), _NgtEventsStore_connect = function _NgtEventsStore_connect(element) {
    return this.ngZone.runOutsideAngular(() => {
        this.set({ connected: element });
        const handlers = this.get('handlers');
        Object.entries(handlers ?? {}).forEach(([eventName, handler]) => {
            const passive = names[eventName];
            element.addEventListener(eventName, handler, { passive });
        });
        return () => {
            const { handlers, connected } = this.get();
            if (connected) {
                Object.entries(handlers ?? {}).forEach(([eventName, handler]) => {
                    if (connected instanceof HTMLElement) {
                        connected.removeEventListener(eventName, handler);
                    }
                });
            }
        };
    });
};
NgtEventsStore.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.1.1", ngImport: i0, type: NgtEventsStore, deps: [{ token: i1.NgtStore }, { token: i0.NgZone }], target: i0.ɵɵFactoryTarget.Injectable });
NgtEventsStore.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "13.1.1", ngImport: i0, type: NgtEventsStore });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.1.1", ngImport: i0, type: NgtEventsStore, decorators: [{
            type: Injectable
        }], ctorParameters: function () { return [{ type: i1.NgtStore }, { type: i0.NgZone }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXZlbnRzLnN0b3JlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vcGFja2FnZXMvY29yZS9zcmMvbGliL3N0b3Jlcy9ldmVudHMuc3RvcmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUNuRCxPQUFPLEVBQUUsSUFBSSxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBUzVCLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUMvQyxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDdEQsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLFNBQVMsQ0FBQzs7O0FBRW5DLE1BQU0sS0FBSyxHQUFHO0lBQ1osS0FBSyxFQUFFLEtBQUs7SUFDWixXQUFXLEVBQUUsS0FBSztJQUNsQixRQUFRLEVBQUUsS0FBSztJQUNmLEtBQUssRUFBRSxLQUFLO0lBQ1osV0FBVyxFQUFFLElBQUk7SUFDakIsU0FBUyxFQUFFLElBQUk7SUFDZixZQUFZLEVBQUUsSUFBSTtJQUNsQixXQUFXLEVBQUUsSUFBSTtJQUNqQixhQUFhLEVBQUUsSUFBSTtJQUNuQixrQkFBa0IsRUFBRSxJQUFJO0NBQ2hCLENBQUM7QUFHWCxNQUFNLE9BQU8sY0FBZSxTQUFRLGVBR25DO0lBR0MsWUFBb0IsS0FBZSxFQUFVLE1BQWM7UUFDekQsS0FBSyxFQUFFLENBQUM7UUFEVSxVQUFLLEdBQUwsS0FBSyxDQUFVO1FBQVUsV0FBTSxHQUFOLE1BQU0sQ0FBUTs7UUFGM0QsWUFBTyxHQUFHLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQztRQUl0QixJQUFJLENBQUMsR0FBRyxDQUFDO1lBQ1AsYUFBYSxFQUFFLElBQUk7WUFDbkIsU0FBUyxFQUFFLEtBQUs7WUFDaEIsUUFBUSxFQUFFLEVBQXFDO1lBQy9DLFFBQVEsRUFBRTtnQkFDUixXQUFX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QUFNLENBQUMsT0FBTyxDQUFDLFFBQVEsSUFBSSxFQUFFLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLFNBQVMsRUFBRSxPQUFPLENBQUMsRUFBRSxFQUFFO29CQUM5RCxJQUFJLFNBQVMsWUFBWSxXQUFXLEVBQUU7d0JBQ3BDLFNBQVMsQ0FBQyxtQkFBbUIsQ0FBQyxTQUFTLEVBQUUsT0FBTyxDQUFDLENBQUM7cUJBQ25EO2dCQUNILENBQUMsQ0FBQyxDQUFDO2FBQ0o7UUFDSCxDQUFDLENBQUM7SUFDSixDQUFDLENBQUMsQ0FBQztBQUNMLENBQUM7MkdBdEZVLGNBQWM7K0dBQWQsY0FBYzsyRkFBZCxjQUFjO2tCQUQxQixVQUFVIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSwgTmdab25lIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBub29wIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgKiBhcyBUSFJFRSBmcm9tICd0aHJlZSc7XG5pbXBvcnQge1xuICBOZ3REb21FdmVudCxcbiAgTmd0RXZlbnQsXG4gIE5ndEV2ZW50c1N0b3JlU3RhdGUsXG4gIE5ndFBvaW50ZXJDYXB0dXJlVGFyZ2V0LFxuICBVbmtub3duUmVjb3JkLFxufSBmcm9tICcuLi90eXBlcyc7XG5pbXBvcnQgeyBjcmVhdGVFdmVudHMgfSBmcm9tICcuLi91dGlscy9ldmVudHMnO1xuaW1wb3J0IHsgRW5oYW5jZWRSeFN0YXRlIH0gZnJvbSAnLi9lbmhhbmNlZC1yeC1zdGF0ZSc7XG5pbXBvcnQgeyBOZ3RTdG9yZSB9IGZyb20gJy4vc3RvcmUnO1xuXG5jb25zdCBuYW1lcyA9IHtcbiAgY2xpY2s6IGZhbHNlLFxuICBjb250ZXh0bWVudTogZmFsc2UsXG4gIGRibGNsaWNrOiBmYWxzZSxcbiAgd2hlZWw6IGZhbHNlLCAvLyBwYXNzaXZlIHdoZWVsIGVycm9ycyB3aXRoIE9yYml0Q29udHJvbHNcbiAgcG9pbnRlcmRvd246IHRydWUsXG4gIHBvaW50ZXJ1cDogdHJ1ZSxcbiAgcG9pbnRlcmxlYXZlOiB0cnVlLFxuICBwb2ludGVybW92ZTogdHJ1ZSxcbiAgcG9pbnRlcmNhbmNlbDogdHJ1ZSxcbiAgbG9zdHBvaW50ZXJjYXB0dXJlOiB0cnVlLFxufSBhcyBjb25zdDtcblxuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIE5ndEV2ZW50c1N0b3JlIGV4dGVuZHMgRW5oYW5jZWRSeFN0YXRlPFxuICBOZ3RFdmVudHNTdG9yZVN0YXRlLFxuICB7IGVsZW1lbnQ6IEhUTUxFbGVtZW50IH1cbj4ge1xuICBhY3Rpb25zID0gdGhpcy5jcmVhdGUoKTtcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHN0b3JlOiBOZ3RTdG9yZSwgcHJpdmF0ZSBuZ1pvbmU6IE5nWm9uZSkge1xuICAgIHN1cGVyKCk7XG4gICAgdGhpcy5zZXQoe1xuICAgICAgcG9pbnRlck1pc3NlZDogbm9vcCxcbiAgICAgIGNvbm5lY3RlZDogZmFsc2UsXG4gICAgICBoYW5kbGVyczoge30gYXMgTmd0RXZlbnRzU3RvcmVTdGF0ZVsnaGFuZGxlcnMnXSxcbiAgICAgIGludGVybmFsOiB7XG4gICAgICAgIGludGVyYWN0aW9uOiBbXSxcbiAgICAgICAgaG92ZXJlZDogbmV3IE1hcDxzdHJpbmcsIE5ndEV2ZW50PE5ndERvbUV2ZW50Pj4oKSxcbiAgICAgICAgY2FwdHVyZWRNYXA6IG5ldyBNYXA8XG4gICAgICAgICAgbnVtYmVyLFxuICAgICAgICAgIE1hcDxUSFJFRS5PYmplY3QzRCwgTmd0UG9pbnRlckNhcHR1cmVUYXJnZXQ+XG4gICAgICAgID4oKSxcbiAgICAgICAgaW5pdGlhbENsaWNrOiBbMCwgMF0sXG4gICAgICAgIGluaXRpYWxIaXRzOiBbXSxcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICBuZ1pvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4ge1xuICAgICAgY29uc3QgeyBoYW5kbGVQb2ludGVyIH0gPSBjcmVhdGVFdmVudHMoXG4gICAgICAgIHRoaXMuc3RvcmUuZ2V0LmJpbmQodGhpcy5zdG9yZSksXG4gICAgICAgIHRoaXMuZ2V0LmJpbmQodGhpcylcbiAgICAgICk7XG5cbiAgICAgIHRoaXMuc2V0KHtcbiAgICAgICAgaGFuZGxlcnM6IE9iamVjdC5rZXlzKG5hbWVzKS5yZWR1Y2UoXG4gICAgICAgICAgKGhhbmRsZXJzOiBVbmtub3duUmVjb3JkLCBzdXBwb3J0ZWRFdmVudE5hbWUpID0+IHtcbiAgICAgICAgICAgIGhhbmRsZXJzW3N1cHBvcnRlZEV2ZW50TmFtZV0gPSBoYW5kbGVQb2ludGVyKHN1cHBvcnRlZEV2ZW50TmFtZSk7XG4gICAgICAgICAgICByZXR1cm4gaGFuZGxlcnM7XG4gICAgICAgICAgfSxcbiAgICAgICAgICB7fVxuICAgICAgICApIGFzIE5ndEV2ZW50c1N0b3JlU3RhdGVbJ2hhbmRsZXJzJ10sXG4gICAgICB9KTtcblxuICAgICAgdGhpcy5ob2xkRWZmZWN0KHRoaXMuYWN0aW9ucy5lbGVtZW50JCwgdGhpcy4jY29ubmVjdC5iaW5kKHRoaXMpKTtcbiAgICB9KTtcbiAgfVxuXG4gIGFkZEludGVyYWN0aW9uKGludGVyYWN0aW9uOiBUSFJFRS5PYmplY3QzRCkge1xuICAgIHRoaXMuc2V0KChzdGF0ZSkgPT4gKHtcbiAgICAgIC4uLnN0YXRlLFxuICAgICAgaW50ZXJuYWw6IHtcbiAgICAgICAgLi4uc3RhdGUuaW50ZXJuYWwsXG4gICAgICAgIGludGVyYWN0aW9uOiBbLi4uc3RhdGUuaW50ZXJuYWwuaW50ZXJhY3Rpb24sIGludGVyYWN0aW9uXSxcbiAgICAgIH0sXG4gICAgfSkpO1xuICB9XG5cbiAgcmVtb3ZlSW50ZXJhY3Rpb24odXVpZDogc3RyaW5nKSB7XG4gICAgdGhpcy5zZXQoKHN0YXRlKSA9PiAoe1xuICAgICAgLi4uc3RhdGUsXG4gICAgICBpbnRlcm5hbDoge1xuICAgICAgICAuLi5zdGF0ZS5pbnRlcm5hbCxcbiAgICAgICAgaW50ZXJhY3Rpb246IHN0YXRlLmludGVybmFsLmludGVyYWN0aW9uLmZpbHRlcihcbiAgICAgICAgICAoaW50ZXJhY3Rpb24pID0+IGludGVyYWN0aW9uLnV1aWQgIT09IHV1aWRcbiAgICAgICAgKSxcbiAgICAgIH0sXG4gICAgfSkpO1xuICB9XG5cbiAgI2Nvbm5lY3QoZWxlbWVudDogSFRNTEVsZW1lbnQpIHtcbiAgICByZXR1cm4gdGhpcy5uZ1pvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4ge1xuICAgICAgdGhpcy5zZXQoeyBjb25uZWN0ZWQ6IGVsZW1lbnQgfSk7XG4gICAgICBjb25zdCBoYW5kbGVycyA9IHRoaXMuZ2V0KCdoYW5kbGVycycpO1xuICAgICAgT2JqZWN0LmVudHJpZXMoaGFuZGxlcnMgPz8ge30pLmZvckVhY2goKFtldmVudE5hbWUsIGhhbmRsZXJdKSA9PiB7XG4gICAgICAgIGNvbnN0IHBhc3NpdmUgPSBuYW1lc1tldmVudE5hbWUgYXMga2V5b2YgdHlwZW9mIG5hbWVzXTtcbiAgICAgICAgZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKGV2ZW50TmFtZSwgaGFuZGxlciwgeyBwYXNzaXZlIH0pO1xuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHsgaGFuZGxlcnMsIGNvbm5lY3RlZCB9ID0gdGhpcy5nZXQoKTtcbiAgICAgICAgaWYgKGNvbm5lY3RlZCkge1xuICAgICAgICAgIE9iamVjdC5lbnRyaWVzKGhhbmRsZXJzID8/IHt9KS5mb3JFYWNoKChbZXZlbnROYW1lLCBoYW5kbGVyXSkgPT4ge1xuICAgICAgICAgICAgaWYgKGNvbm5lY3RlZCBpbnN0YW5jZW9mIEhUTUxFbGVtZW50KSB7XG4gICAgICAgICAgICAgIGNvbm5lY3RlZC5yZW1vdmVFdmVudExpc3RlbmVyKGV2ZW50TmFtZSwgaGFuZGxlcik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgfSk7XG4gIH1cbn1cbiJdfQ==