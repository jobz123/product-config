var _NgtSobaLoader_initShown$, _NgtSobaLoader_progress$, _NgtSobaLoader_progress;
import { __classPrivateFieldGet, __classPrivateFieldSet } from "tslib";
import { EnhancedRxState } from '@angular-three/core';
import { CommonModule } from '@angular/common';
import { ChangeDetectionStrategy, Component, ElementRef, NgModule, ViewChild, } from '@angular/core';
import { cancelAnimationFrame, requestAnimationFrame, } from '@rx-angular/cdk/zone-less';
import { selectSlice } from '@rx-angular/state';
import { combineLatest, map, timer } from 'rxjs';
import { NgtSobaProgress } from '../progress/progress.service';
import * as i0 from "@angular/core";
import * as i1 from "../progress/progress.service";
import * as i2 from "@angular/common";
export class NgtSobaLoader extends EnhancedRxState {
    constructor(sobaProgress) {
        super();
        this.sobaProgress = sobaProgress;
        this.vm$ = combineLatest([
            this.select(),
            this.sobaProgress.select(selectSlice(['active', 'progress'])),
        ]).pipe(map(([state, { progress, active }]) => ({
            shown: state.shown,
            containerClass: state.loaderConfig.containerClass,
            innerContainerClass: state.loaderConfig.innerContainerClass,
            barClass: state.loaderConfig.barClass,
            dataClass: state.loaderConfig.dataClass,
            progress,
            active,
        })));
        _NgtSobaLoader_initShown$.set(this, combineLatest([
            this.select('shown'),
            this.sobaProgress.select('active'),
        ]).pipe(map(([shown, active]) => ({ shown, active }))));
        _NgtSobaLoader_progress$.set(this, combineLatest([
            this.select('loaderConfig', 'dataInterpolation'),
            this.sobaProgress.select('progress'),
        ]).pipe(map(([dataInterpolation, progress]) => ({ dataInterpolation, progress }))));
        _NgtSobaLoader_progress.set(this, 0);
        this.set({
            shown: sobaProgress.get('active'),
            loaderConfig: {
                dataInterpolation: (value) => `Loading ${value.toFixed(2)}%`,
            },
        });
        this.holdEffect(__classPrivateFieldGet(this, _NgtSobaLoader_initShown$, "f"), ({ shown, active }) => {
            if (shown !== active) {
                const timer$ = timer(300).subscribe(() => this.set({ shown: active }));
                return timer$.unsubscribe.bind(timer$);
            }
            return undefined;
        });
    }
    ngAfterViewInit() {
        this.holdEffect(__classPrivateFieldGet(this, _NgtSobaLoader_progress$, "f"), ({ progress, dataInterpolation }) => {
            let raf;
            const updateProgress = () => {
                if (this.progressSpan) {
                    __classPrivateFieldSet(this, _NgtSobaLoader_progress, __classPrivateFieldGet(this, _NgtSobaLoader_progress, "f") + (progress - __classPrivateFieldGet(this, _NgtSobaLoader_progress, "f")) / 2, "f");
                    if (__classPrivateFieldGet(this, _NgtSobaLoader_progress, "f") > 0.95 * progress || progress === 100)
                        __classPrivateFieldSet(this, _NgtSobaLoader_progress, progress, "f");
                    this.progressSpan.nativeElement.innerText =
                        dataInterpolation?.(__classPrivateFieldGet(this, _NgtSobaLoader_progress, "f")) || '';
                    if (__classPrivateFieldGet(this, _NgtSobaLoader_progress, "f") < progress)
                        raf = requestAnimationFrame(updateProgress);
                }
            };
            updateProgress();
            return () => {
                if (raf) {
                    cancelAnimationFrame(raf);
                }
            };
        });
    }
}
_NgtSobaLoader_initShown$ = new WeakMap(), _NgtSobaLoader_progress$ = new WeakMap(), _NgtSobaLoader_progress = new WeakMap();
NgtSobaLoader.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.1.1", ngImport: i0, type: NgtSobaLoader, deps: [{ token: i1.NgtSobaProgress }], target: i0.ɵɵFactoryTarget.Component });
NgtSobaLoader.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "13.1.1", type: NgtSobaLoader, selector: "ngt-soba-loader", providers: [NgtSobaProgress], viewQueries: [{ propertyName: "progressSpan", first: true, predicate: ["progressSpan"], descendants: true }], usesInheritance: true, ngImport: i0, template: `
    <ng-container *ngIf="vm$ | async as vm">
      <div
        *ngIf="vm.shown"
        class="container"
        [style.opacity]="vm.active ? 1 : 0"
        [class]="vm.containerClass"
      >
        <div>
          <div class="inner" [class]="vm.innerContainerClass">
            <div
              class="bar"
              [class]="vm.barClass"
              [style.transform]="'scaleX(' + vm.progress / 100 + ')'"
            ></div>
            <span #progressSpan class="data" [class]="vm.dataClass"></span>
          </div>
        </div>
      </div>
    </ng-container>
  `, isInline: true, styles: [".container{position:absolute;top:0;left:0;width:100%;height:100%;background:#171717;display:flex;align-items:center;justify-content:center;transition:opacity .3s ease;z-index:1000}.inner{width:100px;height:3px;background:#272727;text-align:center}.bar{height:3px;width:100%;background:white;transition:transform .2s;transform-origin:left center}.data{display:inline-block;position:relative;font-feature-settings:\"tnum\";font-variant-numeric:tabular-nums;margin-top:.8em;color:#f0f0f0;font-size:.6em;font-family:-apple-system,BlinkMacSystemFont,Inter,Segoe UI,Helvetica Neue,Helvetica,Arial,Roboto,Ubuntu,sans-serif,\"Apple Color Emoji\",\"Segoe UI Emoji\",Segoe UI Symbol;white-space:nowrap}\n"], directives: [{ type: i2.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }], pipes: { "async": i2.AsyncPipe }, changeDetection: i0.ChangeDetectionStrategy.OnPush });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.1.1", ngImport: i0, type: NgtSobaLoader, decorators: [{
            type: Component,
            args: [{
                    selector: 'ngt-soba-loader',
                    template: `
    <ng-container *ngIf="vm$ | async as vm">
      <div
        *ngIf="vm.shown"
        class="container"
        [style.opacity]="vm.active ? 1 : 0"
        [class]="vm.containerClass"
      >
        <div>
          <div class="inner" [class]="vm.innerContainerClass">
            <div
              class="bar"
              [class]="vm.barClass"
              [style.transform]="'scaleX(' + vm.progress / 100 + ')'"
            ></div>
            <span #progressSpan class="data" [class]="vm.dataClass"></span>
          </div>
        </div>
      </div>
    </ng-container>
  `,
                    styles: [
                        // language=SCSS
                        `
      .container {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: #171717;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: opacity 300ms ease;
        z-index: 1000;
      }

      .inner {
        width: 100px;
        height: 3px;
        background: #272727;
        text-align: center;
      }

      .bar {
        height: 3px;
        width: 100%;
        background: white;
        transition: transform 200ms;
        transform-origin: left center;
      }

      .data {
        display: inline-block;
        position: relative;
        font-variant-numeric: tabular-nums;
        margin-top: 0.8em;
        color: #f0f0f0;
        font-size: 0.6em;
        font-family: -apple-system, BlinkMacSystemFont, 'Inter', 'Segoe UI',
          'Helvetica Neue', Helvetica, Arial, Roboto, Ubuntu, sans-serif,
          'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';
        white-space: nowrap;
      }
    `,
                    ],
                    changeDetection: ChangeDetectionStrategy.OnPush,
                    providers: [NgtSobaProgress],
                }]
        }], ctorParameters: function () { return [{ type: i1.NgtSobaProgress }]; }, propDecorators: { progressSpan: [{
                type: ViewChild,
                args: ['progressSpan']
            }] } });
export class NgtSobaLoaderModule {
}
NgtSobaLoaderModule.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.1.1", ngImport: i0, type: NgtSobaLoaderModule, deps: [], target: i0.ɵɵFactoryTarget.NgModule });
NgtSobaLoaderModule.ɵmod = i0.ɵɵngDeclareNgModule({ minVersion: "12.0.0", version: "13.1.1", ngImport: i0, type: NgtSobaLoaderModule, declarations: [NgtSobaLoader], imports: [CommonModule], exports: [NgtSobaLoader] });
NgtSobaLoaderModule.ɵinj = i0.ɵɵngDeclareInjector({ minVersion: "12.0.0", version: "13.1.1", ngImport: i0, type: NgtSobaLoaderModule, imports: [[CommonModule]] });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.1.1", ngImport: i0, type: NgtSobaLoaderModule, decorators: [{
            type: NgModule,
            args: [{
                    declarations: [NgtSobaLoader],
                    exports: [NgtSobaLoader],
                    imports: [CommonModule],
                }]
        }] });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibG9hZGVyLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uL3BhY2thZ2VzL3NvYmEvbG9hZGVycy9zcmMvbGliL2xvYWRlci9sb2FkZXIuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ3RELE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUMvQyxPQUFPLEVBRUwsdUJBQXVCLEVBQ3ZCLFNBQVMsRUFDVCxVQUFVLEVBQ1YsUUFBUSxFQUNSLFNBQVMsR0FDVixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQ0wsb0JBQW9CLEVBQ3BCLHFCQUFxQixHQUN0QixNQUFNLDJCQUEyQixDQUFDO0FBQ25DLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUNoRCxPQUFPLEVBQUUsYUFBYSxFQUFFLEdBQUcsRUFBRSxLQUFLLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDakQsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLDhCQUE4QixDQUFDOzs7O0FBcUYvRCxNQUFNLE9BQU8sYUFDWCxTQUFRLGVBQW1DO0lBa0MzQyxZQUFvQixZQUE2QjtRQUMvQyxLQUFLLEVBQUUsQ0FBQztRQURVLGlCQUFZLEdBQVosWUFBWSxDQUFpQjtRQS9CeEMsUUFBRyxHQUFHLGFBQWEsQ0FBQztZQUMzQixJQUFJLENBQUMsTUFBTSxFQUFFO1lBQ2IsSUFBSSxDQUFDLFlBQVksQ0FBQyxNQUFNLENBQUMsV0FBVyxDQUFDLENBQUMsUUFBUSxFQUFFLFVBQVUsQ0FBQyxDQUFDLENBQUM7U0FDOUQsQ0FBQyxDQUFDLElBQUksQ0FDTCxHQUFHLENBQUMsQ0FBQyxDQUFDLEtBQUssRUFBRSxFQUFFLFFBQVEsRUFBRSxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1lBQ3RDLEtB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bmd1bGFyLXRocmVlL2NvcmUnO1xuaW1wb3J0IHsgQ29tbW9uTW9kdWxlIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcbmltcG9ydCB7XG4gIEFmdGVyVmlld0luaXQsXG4gIENoYW5nZURldGVjdGlvblN0cmF0ZWd5LFxuICBDb21wb25lbnQsXG4gIEVsZW1lbnRSZWYsXG4gIE5nTW9kdWxlLFxuICBWaWV3Q2hpbGQsXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHtcbiAgY2FuY2VsQW5pbWF0aW9uRnJhbWUsXG4gIHJlcXVlc3RBbmltYXRpb25GcmFtZSxcbn0gZnJvbSAnQHJ4LWFuZ3VsYXIvY2RrL3pvbmUtbGVzcyc7XG5pbXBvcnQgeyBzZWxlY3RTbGljZSB9IGZyb20gJ0ByeC1hbmd1bGFyL3N0YXRlJztcbmltcG9ydCB7IGNvbWJpbmVMYXRlc3QsIG1hcCwgdGltZXIgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IE5ndFNvYmFQcm9ncmVzcyB9IGZyb20gJy4uL3Byb2dyZXNzL3Byb2dyZXNzLnNlcnZpY2UnO1xuXG5pbnRlcmZhY2UgTmd0U29iYUxvYWRlclN0YXRlIHtcbiAgc2hvd246IGJvb2xlYW47XG4gIGxvYWRlckNvbmZpZzoge1xuICAgIGNvbnRhaW5lckNsYXNzPzogc3RyaW5nO1xuICAgIGlubmVyQ29udGFpbmVyQ2xhc3M/OiBzdHJpbmc7XG4gICAgYmFyQ2xhc3M/OiBzdHJpbmc7XG4gICAgZGF0YUNsYXNzPzogc3RyaW5nO1xuICAgIGRhdGFJbnRlcnBvbGF0aW9uPzogKHZhbHVlOiBudW1iZXIpID0+IHN0cmluZztcbiAgfTtcbn1cblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnbmd0LXNvYmEtbG9hZGVyJyxcbiAgdGVtcGxhdGU6IGBcbiAgICA8bmctY29udGFpbmVyICpuZ0lmPVwidm0kIHwgYXN5bmMgYXMgdm1cIj5cbiAgICAgIDxkaXZcbiAgICAgICAgKm5nSWY9XCJ2bS5zaG93blwiXG4gICAgICAgIGNsYXNzPVwiY29udGFpbmVyXCJcbiAgICAgICAgW3N0eWxlLm9wYWNpdHldPVwidm0uYWN0aXZlID8gMSA6IDBcIlxuICAgICAgICBbY2xhc3NdPVwidm0uY29udGFpbmVyQ2xhc3NcIlxuICAgICAgPlxuICAgICAgICA8ZGl2PlxuICAgICAgICAgIDxkaXYgY2xhc3M9XCJpbm5lclwiIFtjbGFzc109XCJ2bS5pbm5lckNvbnRhaW5lckNsYXNzXCI+XG4gICAgICAgICAgICA8ZGl2XG4gICAgICAgICAgICAgIGNsYXNzPVwiYmFyXCJcbiAgICAgICAgICAgICAgW2NsYXNzXT1cInZtLmJhckNsYXNzXCJcbiAgICAgICAgICAgICAgW3N0eWxlLnRyYW5zZm9ybV09XCInc2NhbGVYKCcgKyB2bS5wcm9ncmVzcyAvIDEwMCArICcpJ1wiXG4gICAgICAgICAgICA+PC9kaXY+XG4gICAgICAgICAgICA8c3BhbiAjcHJvZ3Jlc3NTcGFuIGNsYXNzPVwiZGF0YVwiIFtjbGFzc109XCJ2bS5kYXRhQ2xhc3NcIj48L3NwYW4+XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwvZGl2PlxuICAgICAgPC9kaXY+XG4gICAgPC9uZy1jb250YWluZXI+XG4gIGAsXG4gIHN0eWxlczogW1xuICAgIC8vIGxhbmd1YWdlPVNDU1NcbiAgICBgXG4gICAgICAuY29udGFpbmVyIHtcbiAgICAgICAgcG9zaXRpb246IGFic29sdXRlO1xuICAgICAgICB0b3A6IDA7XG4gICAgICAgIGxlZnQ6IDA7XG4gICAgICAgIHdpZHRoOiAxMDAlO1xuICAgICAgICBoZWlnaHQ6IDEwMCU7XG4gICAgICAgIGJhY2tncm91bmQ6ICMxNzE3MTc7XG4gICAgICAgIGRpc3BsYXk6IGZsZXg7XG4gICAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7XG4gICAgICAgIGp1c3RpZnktY29udGVudDogY2VudGVyO1xuICAgICAgICB0cmFuc2l0aW9uOiBvcGFjaXR5IDMwMG1zIGVhc2U7XG4gICAgICAgIHotaW5kZXg6IDEwMDA7XG4gICAgICB9XG5cbiAgICAgIC5pbm5lciB7XG4gICAgICAgIHdpZHRoOiAxMDBweDtcbiAgICAgICAgaGVpZ2h0OiAzcHg7XG4gICAgICAgIGJhY2tncm91bmQ6ICMyNzI3Mjc7XG4gICAgICAgIHRleHQtYWxpZ246IGNlbnRlcjtcbiAgICAgIH1cblxuICAgICAgLmJhciB7XG4gICAgICAgIGhlaWdodDogM3B4O1xuICAgICAgICB3aWR0aDogMTAwJTtcbiAgICAgICAgYmFja2dyb3VuZDogd2hpdGU7XG4gICAgICAgIHRyYW5zaXRpb246IHRyYW5zZm9ybSAyMDBtcztcbiAgICAgICAgdHJhbnNmb3JtLW9yaWdpbjogbGVmdCBjZW50ZXI7XG4gICAgICB9XG5cbiAgICAgIC5kYXRhIHtcbiAgICAgICAgZGlzcGxheTogaW5saW5lLWJsb2NrO1xuICAgICAgICBwb3NpdGlvbjogcmVsYXRpdmU7XG4gICAgICAgIGZvbnQtdmFyaWFudC1udW1lcmljOiB0YWJ1bGFyLW51bXM7XG4gICAgICAgIG1hcmdpbi10b3A6IDAuOGVtO1xuICAgICAgICBjb2xvcjogI2YwZjBmMDtcbiAgICAgICAgZm9udC1zaXplOiAwLjZlbTtcbiAgICAgICAgZm9udC1mYW1pbHk6IC1hcHBsZS1zeXN0ZW0sIEJsaW5rTWFjU3lzdGVtRm9udCwgJ0ludGVyJywgJ1NlZ29lIFVJJyxcbiAgICAgICAgICAnSGVsdmV0aWNhIE5ldWUnLCBIZWx2ZXRpY2EsIEFyaWFsLCBSb2JvdG8sIFVidW50dSwgc2Fucy1zZXJpZixcbiAgICAgICAgICAnQXBwbGUgQ29sb3IgRW1vamknLCAnU2Vnb2UgVUkgRW1vamknLCAnU2Vnb2UgVUkgU3ltYm9sJztcbiAgICAgICAgd2hpdGUtc3BhY2U6IG5vd3JhcDtcbiAgICAgIH1cbiAgICBgLFxuICBdLFxuICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaCxcbiAgcHJvdmlkZXJzOiBbTmd0U29iYVByb2dyZXNzXSxcbn0pXG5leHBvcnQgY2xhc3MgTmd0U29iYUxvYWRlclxuICBleHRlbmRzIEVuaGFuY2VkUnhTdGF0ZTxOZ3RTb2JhTG9hZGVyU3RhdGU+XG4gIGltcGxlbWVudHMgQWZ0ZXJWaWV3SW5pdFxue1xuICByZWFkb25seSB2bSQgPSBjb21iaW5lTGF0ZXN0KFtcbiAgICB0aGlzLnNlbGVjdCgpLFxuICAgIHRoaXMuc29iYVByb2dyZXNzLnNlbGVjdChzZWxlY3RTbGljZShbJ2FjdGl2ZScsICdwcm9ncmVzcyddKSksXG4gIF0pLnBpcGUoXG4gICAgbWFwKChbc3RhdGUsIHsgcHJvZ3Jlc3MsIGFjdGl2ZSB9XSkgPT4gKHtcbiAgICAgIHNob3duOiBzdGF0ZS5zaG93bixcbiAgICAgIGNvbnRhaW5lckNsYXNzOiBzdGF0ZS5sb2FkZXJDb25maWcuY29udGFpbmVyQ2xhc3MsXG4gICAgICBpbm5lckNvbnRhaW5lckNsYXNzOiBzdGF0ZS5sb2FkZXJDb25maWcuaW5uZXJDb250YWluZXJDbGFzcyxcbiAgICAgIGJhckNsYXNzOiBzdGF0ZS5sb2FkZXJDb25maWcuYmFyQ2xhc3MsXG4gICAgICBkYXRhQ2xhc3M6IHN0YXRlLmxvYWRlckNvbmZpZy5kYXRhQ2xhc3MsXG4gICAgICBwcm9ncmVzcyxcbiAgICAgIGFjdGl2ZSxcbiAgICB9KSlcbiAgKTtcblxuICAjaW5pdFNob3duJCA9IGNvbWJpbmVMYXRlc3QoW1xuICAgIHRoaXMuc2VsZWN0KCdzaG93bicpLFxuICAgIHRoaXMuc29iYVByb2dyZXNzLnNlbGVjdCgnYWN0aXZlJyksXG4gIF0pLnBpcGUobWFwKChbc2hvd24sIGFjdGl2ZV0pID0+ICh7IHNob3duLCBhY3RpdmUgfSkpKTtcblxuICAjcHJvZ3Jlc3MkID0gY29tYmluZUxhdGVzdChbXG4gICAgdGhpcy5zZWxlY3QoJ2xvYWRlckNvbmZpZycsICdkYXRhSW50ZXJwb2xhdGlvbicpLFxuICAgIHRoaXMuc29iYVByb2dyZXNzLnNlbGVjdCgncHJvZ3Jlc3MnKSxcbiAgXSkucGlwZShcbiAgICBtYXAoKFtkYXRhSW50ZXJwb2xhdGlvbiwgcHJvZ3Jlc3NdKSA9PiAoeyBkYXRhSW50ZXJwb2xhdGlvbiwgcHJvZ3Jlc3MgfSkpXG4gICk7XG5cbiAgQFZpZXdDaGlsZCgncHJvZ3Jlc3NTcGFuJykgcHJvZ3Jlc3NTcGFuPzogRWxlbWVudFJlZjxIVE1MU3BhbkVsZW1lbnQ+O1xuXG4gICNwcm9ncmVzcyA9IDA7XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBzb2JhUHJvZ3Jlc3M6IE5ndFNvYmFQcm9ncmVzcykge1xuICAgIHN1cGVyKCk7XG4gICAgdGhpcy5zZXQoe1xuICAgICAgc2hvd246IHNvYmFQcm9ncmVzcy5nZXQoJ2FjdGl2ZScpLFxuICAgICAgbG9hZGVyQ29uZmlnOiB7XG4gICAgICAgIGRhdGFJbnRlcnBvbGF0aW9uOiAodmFsdWU6IG51bWJlcikgPT4gYExvYWRpbmcgJHt2YWx1ZS50b0ZpeGVkKDIpfSVgLFxuICAgICAgfSxcbiAgICB9KTtcblxuICAgIHRoaXMuaG9sZEVmZmVjdCh0aGlzLiNpbml0U2hvd24kLCAoeyBzaG93biwgYWN0aXZlIH0pID0+IHtcbiAgICAgIGlmIChzaG93biAhPT0gYWN0aXZlKSB7XG4gICAgICAgIGNvbnN0IHRpbWVyJCA9IHRpbWVyKDMwMCkuc3Vic2NyaWJlKCgpID0+IHRoaXMuc2V0KHsgc2hvd246IGFjdGl2ZSB9KSk7XG4gICAgICAgIHJldHVybiB0aW1lciQudW5zdWJzY3JpYmUuYmluZCh0aW1lciQpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICB9KTtcbiAgfVxuXG4gIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcbiAgICB0aGlzLmhvbGRFZmZlY3QodGhpcy4jcHJvZ3Jlc3MkLCAoeyBwcm9ncmVzcywgZGF0YUludGVycG9sYXRpb24gfSkgPT4ge1xuICAgICAgbGV0IHJhZjogUmV0dXJuVHlwZTx0eXBlb2YgcmVxdWVzdEFuaW1hdGlvbkZyYW1lPjtcblxuICAgICAgY29uc3QgdXBkYXRlUHJvZ3Jlc3MgPSAoKSA9PiB7XG4gICAgICAgIGlmICh0aGlzLnByb2dyZXNzU3Bhbikge1xuICAgICAgICAgIHRoaXMuI3Byb2dyZXNzICs9IChwcm9ncmVzcyAtIHRoaXMuI3Byb2dyZXNzKSAvIDI7XG4gICAgICAgICAgaWYgKHRoaXMuI3Byb2dyZXNzID4gMC45NSAqIHByb2dyZXNzIHx8IHByb2dyZXNzID09PSAxMDApXG4gICAgICAgICAgICB0aGlzLiNwcm9ncmVzcyA9IHByb2dyZXNzO1xuICAgICAgICAgIHRoaXMucHJvZ3Jlc3NTcGFuLm5hdGl2ZUVsZW1lbnQuaW5uZXJUZXh0ID1cbiAgICAgICAgICAgIGRhdGFJbnRlcnBvbGF0aW9uPy4odGhpcy4jcHJvZ3Jlc3MpIHx8ICcnO1xuXG4gICAgICAgICAgaWYgKHRoaXMuI3Byb2dyZXNzIDwgcHJvZ3Jlc3MpXG4gICAgICAgICAgICByYWYgPSByZXF1ZXN0QW5pbWF0aW9uRnJhbWUodXBkYXRlUHJvZ3Jlc3MpO1xuICAgICAgICB9XG4gICAgICB9O1xuXG4gICAgICB1cGRhdGVQcm9ncmVzcygpO1xuXG4gICAgICByZXR1cm4gKCkgPT4ge1xuICAgICAgICBpZiAocmFmKSB7XG4gICAgICAgICAgY2FuY2VsQW5pbWF0aW9uRnJhbWUocmFmKTtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICB9KTtcbiAgfVxufVxuXG5ATmdNb2R1bGUoe1xuICBkZWNsYXJhdGlvbnM6IFtOZ3RTb2JhTG9hZGVyXSxcbiAgZXhwb3J0czogW05ndFNvYmFMb2FkZXJdLFxuICBpbXBvcnRzOiBbQ29tbW9uTW9kdWxlXSxcbn0pXG5leHBvcnQgY2xhc3MgTmd0U29iYUxvYWRlck1vZHVsZSB7fVxuIl19