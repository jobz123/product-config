var _NgtSobaDetailedStore_updateLodChildrenParams$;
import { __classPrivateFieldGet } from "tslib";
import { EnhancedRxState, NGT_OBJECT_INPUTS_CONTROLLER_PROVIDER, NGT_OBJECT_INPUTS_WATCHED_CONTROLLER, NgtObject3dController, NgtObject3dInputsController, NgtObject3dInputsControllerModule, NgtSobaExtender, } from '@angular-three/core';
import { NgtLodModule } from '@angular-three/core/lod';
import { ChangeDetectionStrategy, Component, ContentChildren, Inject, Injectable, Input, NgModule, QueryList, } from '@angular/core';
import { asapScheduler } from '@rx-angular/cdk/zone-less';
import { selectSlice } from '@rx-angular/state';
import { combineLatest, map, observeOn, startWith } from 'rxjs';
import * as i0 from "@angular/core";
import * as i1 from "@angular-three/core/lod";
import * as i2 from "@angular-three/core";
export class NgtSobaDetailedStore extends EnhancedRxState {
    constructor() {
        super();
        _NgtSobaDetailedStore_updateLodChildrenParams$.set(this, this.select(selectSlice(['lod', 'children'])));
        this.set({ distances: [], children: [] });
        this.hold(__classPrivateFieldGet(this, _NgtSobaDetailedStore_updateLodChildrenParams$, "f"), ({ lod, children }) => {
            const distances = this.get('distances');
            if (!children.length)
                lod.levels.length = 0;
            children.forEach((object, index) => {
                lod.addLevel(object, distances[index]);
            });
        });
    }
}
_NgtSobaDetailedStore_updateLodChildrenParams$ = new WeakMap();
NgtSobaDetailedStore.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.1.1", ngImport: i0, type: NgtSobaDetailedStore, deps: [], target: i0.ɵɵFactoryTarget.Injectable });
NgtSobaDetailedStore.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "13.1.1", ngImport: i0, type: NgtSobaDetailedStore });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.1.1", ngImport: i0, type: NgtSobaDetailedStore, decorators: [{
            type: Injectable
        }], ctorParameters: function () { return []; } });
export class NgtSobaDetailed extends NgtSobaExtender {
    constructor(objectInputsController, detailedStore) {
        super();
        this.objectInputsController = objectInputsController;
        this.detailedStore = detailedStore;
    }
    set distances(v) {
        this.detailedStore.set({ distances: v });
    }
    ngAfterContentInit() {
        const children$ = combineLatest([
            this.extenders.changes.pipe(startWith(this.extenders), observeOn(asapScheduler)),
            this.children.changes.pipe(startWith(this.children), observeOn(asapScheduler)),
        ]).pipe(map(([extendersList, childrenList]) => [
            ...childrenList.map((child) => child.object3d),
            ...extendersList.map((extender) => extender.object),
        ]));
        this.detailedStore.connect('children', children$);
    }
    onLodAnimateReady({ camera }, lod) {
        lod.update(camera);
    }
    onLodReady(lod) {
        this.object = lod;
        this.detailedStore.set({ lod });
    }
}
NgtSobaDetailed.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.1.1", ngImport: i0, type: NgtSobaDetailed, deps: [{ token: NGT_OBJECT_INPUTS_WATCHED_CONTROLLER }, { token: NgtSobaDetailedStore }], target: i0.ɵɵFactoryTarget.Component });
NgtSobaDetailed.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "13.1.1", type: NgtSobaDetailed, selector: "ngt-soba-detailed", inputs: { distances: "distances" }, providers: [
        NGT_OBJECT_INPUTS_CONTROLLER_PROVIDER,
        NgtSobaDetailedStore,
        {
            provide: NgtSobaExtender,
            useExisting: NgtSobaDetailed,
        },
    ], queries: [{ propertyName: "children", predicate: NgtObject3dController, descendants: true }, { propertyName: "extenders", predicate: NgtSobaExtender, descendants: true }], usesInheritance: true, ngImport: i0, template: `
    <ngt-lod
      #lod="ngtLod"
      (ready)="onLodReady($event)"
      (animateReady)="onLodAnimateReady($event, lod.lod)"
      [object3dInputsController]="objectInputsController"
    ></ngt-lod>
    <ng-content></ng-content>
  `, isInline: true, directives: [{ type: i1.NgtLod, selector: "ngt-lod", outputs: ["ready"], exportAs: ["ngtLod"] }, { type: i2.NgtObject3dController, selector: "    ngt-primitive,    ngt-bone,    ngt-group,    ngt-lod,    ngt-points,    ngt-mesh,    ngt-instanced-mesh,    ngt-skinned-mesh,    ngt-audio,    ngt-positional-audio,    ngt-line,    ngt-line-loop,    ngt-line-segments,    ngt-light-probe,    ngt-ambient-light,    ngt-ambient-light-probe,    ngt-hemisphere-light,    ngt-hemisphere-light-probe,    ngt-directional-light,    ngt-point-light,    ngt-spot-light,    ngt-rect-area-light,    ngt-arrow-helper,    ngt-axes-helper,    ngt-box3-helper,    ngt-grid-helper,    ngt-plane-helper,    ngt-polar-grid-helper,    ngt-sprite,    ngt-camera,    ngt-perspective-camera,    ngt-orthographic-camera,    ngt-array-camera,    ngt-stereo-camera,    ngt-cube-camera  ", exportAs: ["ngtObject3dController"] }, { type: i2.NgtObject3dInputsController, selector: "    ngt-primitive,    ngt-bone,    ngt-group,    ngt-lod,    ngt-points,    ngt-mesh,    ngt-instanced-mesh,    ngt-skinned-mesh,    ngt-audio,    ngt-positional-audio,    ngt-line,    ngt-line-loop,    ngt-line-segments,    ngt-light-probe,    ngt-ambient-light,    ngt-ambient-light-probe,    ngt-hemisphere-light,    ngt-hemisphere-light-probe,    ngt-directional-light,    ngt-point-light,    ngt-spot-light,    ngt-rect-area-light,    ngt-arrow-helper,    ngt-axes-helper,    ngt-box3-helper,    ngt-grid-helper,    ngt-plane-helper,    ngt-polar-grid-helper,    ngt-sprite,    ngt-camera,    ngt-perspective-camera,    ngt-orthographic-camera,    ngt-array-camera,    ngt-stereo-camera,    ngt-cube-camera,    ngt-soba-plane,    ngt-soba-box,    ngt-soba-cylinder,    ngt-soba-cone,    ngt-soba-circle,    ngt-soba-sphere,    ngt-soba-tube,    ngt-soba-torus,    ngt-soba-tetrahedron,    ngt-soba-ring,    ngt-soba-polyhedron,    ngt-soba-octahedron,    ngt-soba-dodecahedron,    ngt-soba-icosahedron,    ngt-soba-extrude,    ngt-soba-lathe,    ngt-soba-torus-knot,    ngt-soba-billboard,    ngt-soba-detailed,    ngt-soba-line,    ngt-soba-quadratic-bezier-line,    ngt-soba-cubic-bezier-line,    ngt-soba-orthographic-camera,    ngt-soba-gizmo-helper,    ngt-soba-gizmo-viewport,    ngt-soba-gizmo-axis-head,    ngt-soba-text  ", inputs: ["name", "position", "rotation", "quaternion", "scale", "color", "userData", "castShadow", "receiveShadow", "visible", "matrixAutoUpdate", "dispose", "raycast", "appendMode", "appendTo", "object3dInputsController"], outputs: ["click", "contextmenu", "dblclick", "pointerup", "pointerdown", "pointerover", "pointerout", "pointerenter", "pointerleave", "pointermove", "pointermissed", "pointercancel", "wheel"], exportAs: ["ngtObject3dInputsController"] }, { type: i2.NgtAnimationSubscriberController, selector: "[animateReady]", inputs: ["priority"], outputs: ["animateReady"], exportAs: ["ngtAnimationSubscriberController"] }], changeDetection: i0.ChangeDetectionStrategy.OnPush });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.1.1", ngImport: i0, type: NgtSobaDetailed, decorators: [{
            type: Component,
            args: [{
                    selector: 'ngt-soba-detailed',
                    template: `
    <ngt-lod
      #lod="ngtLod"
      (ready)="onLodReady($event)"
      (animateReady)="onLodAnimateReady($event, lod.lod)"
      [object3dInputsController]="objectInputsController"
    ></ngt-lod>
    <ng-content></ng-content>
  `,
                    changeDetection: ChangeDetectionStrategy.OnPush,
                    providers: [
                        NGT_OBJECT_INPUTS_CONTROLLER_PROVIDER,
                        NgtSobaDetailedStore,
                        {
                            provide: NgtSobaExtender,
                            useExisting: NgtSobaDetailed,
                        },
                    ],
                }]
        }], ctorParameters: function () { return [{ type: i2.NgtObject3dInputsController, decorators: [{
                    type: Inject,
                    args: [NGT_OBJECT_INPUTS_WATCHED_CONTROLLER]
                }] }, { type: NgtSobaDetailedStore }]; }, propDecorators: { distances: [{
                type: Input
            }], children: [{
                type: ContentChildren,
                args: [NgtObject3dController, { descendants: true }]
            }], extenders: [{
                type: ContentChildren,
                args: [NgtSobaExtender, { descendants: true }]
            }] } });
export class NgtSobaDetailedModule {
}
NgtSobaDetailedModule.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.1.1", ngImport: i0, type: NgtSobaDetailedModule, deps: [], target: i0.ɵɵFactoryTarget.NgModule });
NgtSobaDetailedModule.ɵmod = i0.ɵɵngDeclareNgModule({ minVersion: "12.0.0", version: "13.1.1", ngImport: i0, type: NgtSobaDetailedModule, declarations: [NgtSobaDetailed], imports: [NgtLodModule], exports: [NgtSobaDetailed, NgtObject3dInputsControllerModule] });
NgtSobaDetailedModule.ɵinj = i0.ɵɵngDeclareInjector({ minVersion: "12.0.0", version: "13.1.1", ngImport: i0, type: NgtSobaDetailedModule, imports: [[NgtLodModule], NgtObject3dInputsControllerModule] });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.1.1", ngImport: i0, type: NgtSobaDetailedModule, decorators: [{
            type: NgModule,
            args: [{
                    declarations: [NgtSobaDetailed],
                    exports: [NgtSobaDetailed, NgtObject3dInputsControllerModule],
                    imports: [NgtLodModule],
                }]
        }] });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGV0YWlsZWQuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vcGFja2FnZXMvc29iYS9wZXJmb3JtYW5jZXMvc3JjL2RldGFpbGVkL2RldGFpbGVkLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLE9BQU8sRUFDTCxlQUFlLEVBQ2YscUNBQXFDLEVBQ3JDLG9DQUFvQyxFQUNwQyxxQkFBcUIsRUFDckIsMkJBQTJCLEVBQzNCLGlDQUFpQyxFQUVqQyxlQUFlLEdBQ2hCLE1BQU0scUJBQXFCLENBQUM7QUFDN0IsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLHlCQUF5QixDQUFDO0FBQ3ZELE9BQU8sRUFFTCx1QkFBdUIsRUFDdkIsU0FBUyxFQUNULGVBQWUsRUFDZixNQUFNLEVBQ04sVUFBVSxFQUNWLEtBQUssRUFDTCxRQUFRLEVBQ1IsU0FBUyxHQUNWLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUMxRCxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDaEQsT0FBTyxFQUFFLGFBQWEsRUFBRSxHQUFHLEVBQUUsU0FBUyxFQUFFLFNBQVMsRUFBRSxNQUFNLE1BQU0sQ0FBQzs7OztBQVVoRSxNQUFNLE9BQU8sb0JBQXFCLFNBQVEsZUFBMEM7SUFHbEY7UUFDRSxLQUFLLEVBQUUsQ0FBQztRQUhWLHlEQUE0QixJQUFJLENBQUMsTUFBTSxDQUFDLFdBQVcsQ0FBQyxDQUFDLEtBQUssRUFBRSxVQUFVLENBQUMsQ0FBQyxDQUFDLEVBQUM7UUFJeEUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLFNBQVMsRUFBRSxFQUFFLEVBQUUsUUFBUSxFQUFFLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFDMUMsSUFBSSxDQUFDLElBQUksQ0FBQyx1QkFBQSxJQUFJLHNEQUEwQixFQUFFLENBQUMsRUFBRSxHQUFH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QW9CO3dCQUNwQjs0QkFDRSxPQUFPLEVBQUUsZUFBZTs0QkFDeEIsV0FBVyxpQkFBaUI7eUJBQzdCO3FCQUNGO2lCQUNGOzswQkFnQkksTUFBTTsyQkFBQyxvQ0FBb0M7OEJBRXJCLG9CQUFvQiwwQkFiaEMsU0FBUztzQkFBckIsS0FBSztnQkFLTixRQUFRO3NCQURQLGVBQWU7dUJBQUMscUJBQXFCLEVBQUUsRUFBRSxXQUFXLEVBQUUsSUFBSSxFQUFFO2dCQUk3RCxTQUFTO3NCQURSLGVBQWU7dUJBQUMsZUFBZSxFQUFFLEVBQUUsV0FBVyxFQUFFLElBQUksRUFBRTs7QUFrRHpELE1BQU0sT0FBTyxxQkFBcUI7O2tIQUFyQixxQkFBcUI7bUhBQXJCLHFCQUFxQixpQkE3RHJCLGVBQWUsYUEyRGhCLFlBQVksYUEzRFgsZUFBZSxFQTBEQyxpQ0FBaUM7bUhBR2pELHFCQUFxQixZQUZ2QixDQUFDLFlBQVksQ0FBQyxFQURJLGlDQUFpQzsyRkFHakQscUJBQXFCO2tCQUxqQyxRQUFRO21CQUFDO29CQUNSLFlBQVksRUFBRSxDQUFDLGVBQWUsQ0FBQztvQkFDL0IsT0FBTyxFQUFFLENBQUMsZUFBZSxFQUFFLGlDQUFpQyxDQUFDO29CQUM3RCxPQUFPLEVBQUUsQ0FBQyxZQUFZLENBQUM7aUJBQ3hCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgRW5oYW5jZWRSeFN0YXRlLFxuICBOR1RfT0JKRUNUX0lOUFVUU19DT05UUk9MTEVSX1BST1ZJREVSLFxuICBOR1RfT0JKRUNUX0lOUFVUU19XQVRDSEVEX0NPTlRST0xMRVIsXG4gIE5ndE9iamVjdDNkQ29udHJvbGxlcixcbiAgTmd0T2JqZWN0M2RJbnB1dHNDb250cm9sbGVyLFxuICBOZ3RPYmplY3QzZElucHV0c0NvbnRyb2xsZXJNb2R1bGUsXG4gIE5ndFJlbmRlcixcbiAgTmd0U29iYUV4dGVuZGVyLFxufSBmcm9tICdAYW5ndWxhci10aHJlZS9jb3JlJztcbmltcG9ydCB7IE5ndExvZE1vZHVsZSB9IGZyb20gJ0Bhbmd1bGFyLXRocmVlL2NvcmUvbG9kJztcbmltcG9ydCB7XG4gIEFmdGVyQ29udGVudEluaXQsXG4gIENoYW5nZURldGVjdGlvblN0cmF0ZWd5LFxuICBDb21wb25lbnQsXG4gIENvbnRlbnRDaGlsZHJlbixcbiAgSW5qZWN0LFxuICBJbmplY3RhYmxlLFxuICBJbnB1dCxcbiAgTmdNb2R1bGUsXG4gIFF1ZXJ5TGlzdCxcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBhc2FwU2NoZWR1bGVyIH0gZnJvbSAnQHJ4LWFuZ3VsYXIvY2RrL3pvbmUtbGVzcyc7XG5pbXBvcnQgeyBzZWxlY3RTbGljZSB9IGZyb20gJ0ByeC1hbmd1bGFyL3N0YXRlJztcbmltcG9ydCB7IGNvbWJpbmVMYXRlc3QsIG1hcCwgb2JzZXJ2ZU9uLCBzdGFydFdpdGggfSBmcm9tICdyeGpzJztcbmltcG9ydCAqIGFzIFRIUkVFIGZyb20gJ3RocmVlJztcblxuaW50ZXJmYWNlIE5ndFNvYmFEZXRhaWxlZFN0b3JlU3RhdGUge1xuICBsb2Q6IFRIUkVFLkxPRDtcbiAgZGlzdGFuY2VzOiBudW1iZXJbXTtcbiAgY2hpbGRyZW46IFRIUkVFLk9iamVjdDNEW107XG59XG5cbkBJbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBOZ3RTb2JhRGV0YWlsZWRTdG9yZSBleHRlbmRzIEVuaGFuY2VkUnhTdGF0ZTxOZ3RTb2JhRGV0YWlsZWRTdG9yZVN0YXRlPiB7XG4gICN1cGRhdGVMb2RDaGlsZHJlblBhcmFtcyQgPSB0aGlzLnNlbGVjdChzZWxlY3RTbGljZShbJ2xvZCcsICdjaGlsZHJlbiddKSk7XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgc3VwZXIoKTtcbiAgICB0aGlzLnNldCh7IGRpc3RhbmNlczogW10sIGNoaWxkcmVuOiBbXSB9KTtcbiAgICB0aGlzLmhvbGQodGhpcy4jdXBkYXRlTG9kQ2hpbGRyZW5QYXJhbXMkLCAoeyBsb2QsIGNoaWxkcmVuIH0pID0+IHtcbiAgICAgIGNvbnN0IGRpc3RhbmNlcyA9IHRoaXMuZ2V0KCdkaXN0YW5jZXMnKTtcbiAgICAgIGlmICghY2hpbGRyZW4ubGVuZ3RoKSBsb2QubGV2ZWxzLmxlbmd0aCA9IDA7XG4gICAgICBjaGlsZHJlbi5mb3JFYWNoKChvYmplY3QsIGluZGV4KSA9PiB7XG4gICAgICAgIGxvZC5hZGRMZXZlbChvYmplY3QsIGRpc3RhbmNlc1tpbmRleF0pO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH1cbn1cblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnbmd0LXNvYmEtZGV0YWlsZWQnLFxuICB0ZW1wbGF0ZTogYFxuICAgIDxuZ3QtbG9kXG4gICAgICAjbG9kPVwibmd0TG9kXCJcbiAgICAgIChyZWFkeSk9XCJvbkxvZFJlYWR5KCRldmVudClcIlxuICAgICAgKGFuaW1hdGVSZWFkeSk9XCJvbkxvZEFuaW1hdGVSZWFkeSgkZXZlbnQsIGxvZC5sb2QpXCJcbiAgICAgIFtvYmplY3QzZElucHV0c0NvbnRyb2xsZXJdPVwib2JqZWN0SW5wdXRzQ29udHJvbGxlclwiXG4gICAgPjwvbmd0LWxvZD5cbiAgICA8bmctY29udGVudD48L25nLWNvbnRlbnQ+XG4gIGAsXG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLFxuICBwcm92aWRlcnM6IFtcbiAgICBOR1RfT0JKRUNUX0lOUFVUU19DT05UUk9MTEVSX1BST1ZJREVSLFxuICAgIE5ndFNvYmFEZXRhaWxlZFN0b3JlLFxuICAgIHtcbiAgICAgIHByb3ZpZGU6IE5ndFNvYmFFeHRlbmRlcixcbiAgICAgIHVzZUV4aXN0aW5nOiBOZ3RTb2JhRGV0YWlsZWQsXG4gICAgfSxcbiAgXSxcbn0pXG5leHBvcnQgY2xhc3MgTmd0U29iYURldGFpbGVkXG4gIGV4dGVuZHMgTmd0U29iYUV4dGVuZGVyPFRIUkVFLkxPRD5cbiAgaW1wbGVtZW50cyBBZnRlckNvbnRlbnRJbml0XG57XG4gIEBJbnB1dCgpIHNldCBkaXN0YW5jZXModjogbnVtYmVyW10pIHtcbiAgICB0aGlzLmRldGFpbGVkU3RvcmUuc2V0KHsgZGlzdGFuY2VzOiB2IH0pO1xuICB9XG5cbiAgQENvbnRlbnRDaGlsZHJlbihOZ3RPYmplY3QzZENvbnRyb2xsZXIsIHsgZGVzY2VuZGFudHM6IHRydWUgfSlcbiAgY2hpbGRyZW4hOiBRdWVyeUxpc3Q8Tmd0T2JqZWN0M2RDb250cm9sbGVyPjtcblxuICBAQ29udGVudENoaWxkcmVuKE5ndFNvYmFFeHRlbmRlciwgeyBkZXNjZW5kYW50czogdHJ1ZSB9KVxuICBleHRlbmRlcnMhOiBRdWVyeUxpc3Q8Tmd0U29iYUV4dGVuZGVyPFRIUkVFLk9iamVjdDNEPj47XG5cbiAgY29uc3RydWN0b3IoXG4gICAgQEluamVjdChOR1RfT0JKRUNUX0lOUFVUU19XQVRDSEVEX0NPTlRST0xMRVIpXG4gICAgcHVibGljIG9iamVjdElucHV0c0NvbnRyb2xsZXI6IE5ndE9iamVjdDNkSW5wdXRzQ29udHJvbGxlcixcbiAgICBwcml2YXRlIGRldGFpbGVkU3RvcmU6IE5ndFNvYmFEZXRhaWxlZFN0b3JlXG4gICkge1xuICAgIHN1cGVyKCk7XG4gIH1cblxuICBuZ0FmdGVyQ29udGVudEluaXQoKSB7XG4gICAgY29uc3QgY2hpbGRyZW4kID0gY29tYmluZUxhdGVzdChbXG4gICAgICB0aGlzLmV4dGVuZGVycy5jaGFuZ2VzLnBpcGUoXG4gICAgICAgIHN0YXJ0V2l0aCh0aGlzLmV4dGVuZGVycyksXG4gICAgICAgIG9ic2VydmVPbihhc2FwU2NoZWR1bGVyKVxuICAgICAgKSxcbiAgICAgIHRoaXMuY2hpbGRyZW4uY2hhbmdlcy5waXBlKFxuICAgICAgICBzdGFydFdpdGgodGhpcy5jaGlsZHJlbiksXG4gICAgICAgIG9ic2VydmVPbihhc2FwU2NoZWR1bGVyKVxuICAgICAgKSxcbiAgICBdKS5waXBlKFxuICAgICAgbWFwKFxuICAgICAgICAoW2V4dGVuZGVyc0xpc3QsIGNoaWxkcmVuTGlzdF06IFtcbiAgICAgICAgICBRdWVyeUxpc3Q8Tmd0U29iYUV4dGVuZGVyPFRIUkVFLk9iamVjdDNEPj4sXG4gICAgICAgICAgUXVlcnlMaXN0PE5ndE9iamVjdDNkQ29udHJvbGxlcj5cbiAgICAgICAgXSkgPT4gW1xuICAgICAgICAgIC4uLmNoaWxkcmVuTGlzdC5tYXAoKGNoaWxkKSA9PiBjaGlsZC5vYmplY3QzZCksXG4gICAgICAgICAgLi4uZXh0ZW5kZXJzTGlzdC5tYXAoKGV4dGVuZGVyKSA9PiBleHRlbmRlci5vYmplY3QpLFxuICAgICAgICBdXG4gICAgICApXG4gICAgKTtcbiAgICB0aGlzLmRldGFpbGVkU3RvcmUuY29ubmVjdCgnY2hpbGRyZW4nLCBjaGlsZHJlbiQpO1xuICB9XG5cbiAgb25Mb2RBbmltYXRlUmVhZHkoeyBjYW1lcmEgfTogTmd0UmVuZGVyLCBsb2Q6IFRIUkVFLkxPRCkge1xuICAgIGxvZC51cGRhdGUoY2FtZXJhKTtcbiAgfVxuXG4gIG9uTG9kUmVhZHkobG9kOiBUSFJFRS5MT0QpIHtcbiAgICB0aGlzLm9iamVjdCA9IGxvZDtcbiAgICB0aGlzLmRldGFpbGVkU3RvcmUuc2V0KHsgbG9kIH0pO1xuICB9XG59XG5cbkBOZ01vZHVsZSh7XG4gIGRlY2xhcmF0aW9uczogW05ndFNvYmFEZXRhaWxlZF0sXG4gIGV4cG9ydHM6IFtOZ3RTb2JhRGV0YWlsZWQsIE5ndE9iamVjdDNkSW5wdXRzQ29udHJvbGxlck1vZHVsZV0sXG4gIGltcG9ydHM6IFtOZ3RMb2RNb2R1bGVdLFxufSlcbmV4cG9ydCBjbGFzcyBOZ3RTb2JhRGV0YWlsZWRNb2R1bGUge31cbiJdfQ==