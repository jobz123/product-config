import { EnhancedRxState, NgtSobaExtender, } from '@angular-three/core';
import { NgtBufferAttributeModule } from '@angular-three/core/attributes';
import { NgtBufferGeometryModule } from '@angular-three/core/geometries';
import { NgtPointsModule } from '@angular-three/core/points';
import { CommonModule } from '@angular/common';
import { ChangeDetectionStrategy, Component, Injectable, Input, NgModule, } from '@angular/core';
import { selectSlice } from '@rx-angular/state';
import { map } from 'rxjs';
import * as THREE from 'three';
import { NgtSobaStarFieldMaterialModule, } from './star-material.directive';
import * as i0 from "@angular/core";
import * as i1 from "@angular-three/core/points";
import * as i2 from "@angular-three/core";
import * as i3 from "@angular/common";
import * as i4 from "@angular-three/core/geometries";
import * as i5 from "@angular-three/core/attributes";
import * as i6 from "./star-material.directive";
const genStar = (r) => {
    return new THREE.Vector3().setFromSpherical(new THREE.Spherical(r, Math.acos(1 - Math.random() * 2), Math.random() * 2 * Math.PI));
};
export class NgtSobaStarsStore extends EnhancedRxState {
    constructor() {
        super();
        this.attributes$ = this.select(selectSlice(['radius', 'depth', 'count', 'factor', 'saturation']), map(({ depth, count, factor, radius, saturation }) => {
            const positions = [];
            const colors = [];
            const sizes = Array.from({ length: count }, () => (0.5 + 0.5 * Math.random()) * factor);
            const color = new THREE.Color();
            let r = radius + depth;
            const increment = depth / count;
            for (let i = 0; i < count; i++) {
                r -= increment * Math.random();
                positions.push(...genStar(r).toArray());
                color.setHSL(i / count, saturation, 0.9);
                colors.push(color.r, color.g, color.b);
            }
            return {
                positions: new Float32Array(positions),
                colors: new Float32Array(colors),
                sizes: new Float32Array(sizes),
                fade: this.get('fade'),
            };
        }));
        this.set({
            radius: 100,
            depth: 50,
            count: 5000,
            saturation: 0,
            factor: 4,
            fade: false,
        });
    }
}
NgtSobaStarsStore.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.1.1", ngImport: i0, type: NgtSobaStarsStore, deps: [], target: i0.ɵɵFactoryTarget.Injectable });
NgtSobaStarsStore.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "13.1.1", ngImport: i0, type: NgtSobaStarsStore });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.1.1", ngImport: i0, type: NgtSobaStarsStore, decorators: [{
            type: Injectable
        }], ctorParameters: function () { return []; } });
export class NgtSobaStars extends NgtSobaExtender {
    constructor(sobaStarsStore) {
        super();
        this.sobaStarsStore = sobaStarsStore;
        this.blending = THREE.AdditiveBlending;
        this.attributes$ = this.sobaStarsStore.attributes$;
    }
    set radius(radius) {
        this.sobaStarsStore.set({ radius });
    }
    set depth(depth) {
        this.sobaStarsStore.set({ depth });
    }
    set count(count) {
        this.sobaStarsStore.set({ count });
    }
    set factor(factor) {
        this.sobaStarsStore.set({ factor });
    }
    set saturation(saturation) {
        this.sobaStarsStore.set({ saturation });
    }
    set fade(fade) {
        this.sobaStarsStore.set({ fade });
    }
    onAnimate({ clock }) {
        if (this.starMaterial) {
            this.starMaterial.uniforms.time.value = clock.getElapsedTime();
        }
    }
}
NgtSobaStars.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.1.1", ngImport: i0, type: NgtSobaStars, deps: [{ token: NgtSobaStarsStore }], target: i0.ɵɵFactoryTarget.Component });
NgtSobaStars.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "13.1.1", type: NgtSobaStars, selector: "ngt-soba-stars", inputs: { radius: "radius", depth: "depth", count: "count", factor: "factor", saturation: "saturation", fade: "fade" }, providers: [
        {
            provide: NgtSobaExtender,
            useExisting: NgtSobaStars,
        },
        NgtSobaStarsStore,
    ], usesInheritance: true, ngImport: i0, template: `
    <ngt-points (ready)="object = $event" (animateReady)="onAnimate($event)">
      <ng-container *ngIf="attributes$ | async as attributes">
        <ngt-buffer-geometry>
          <ngt-buffer-attribute
            attach="position"
            [args]="[attributes.positions, 3]"
          ></ngt-buffer-attribute>
          <ngt-buffer-attribute
            attach="color"
            [args]="[attributes.colors, 3]"
          ></ngt-buffer-attribute>
          <ngt-buffer-attribute
            attach="size"
            [args]="[attributes.sizes, 1]"
          ></ngt-buffer-attribute>
        </ngt-buffer-geometry>
        <ngt-soba-star-field-material
          #sobaStarFieldMaterial="ngtSobaStarFieldMaterial"
          (ready)="starMaterial = $event"
          [parameters]="{
            vertexColors: true,
            transparent: true,
            blending: this.blending,
            uniforms: {
              fade: { value: attributes.fade },
              time: sobaStarFieldMaterial.material?.uniforms?.time || {
                value: 0
              }
            }
          }"
        ></ngt-soba-star-field-material>
      </ng-container>
    </ngt-points>
  `, isInline: true, directives: [{ type: i1.NgtPoints, selector: "ngt-points", outputs: ["ready"], exportAs: ["ngtPoints"] }, { type: i2.NgtMaterialGeometryController, selector: "    ngt-mesh,    ngt-instanced-mesh,    ngt-skinned-mesh,    ngt-line,    ngt-line-loop,    ngt-line-segments,    ngt-points  ", inputs: ["morphTargetInfluences", "morphTargetDictionary"], exportAs: ["ngtMaterialGeometryController"] }, { type: i2.NgtObject3dController, selector: "    ngt-primitive,    ngt-bone,    ngt-group,    ngt-lod,    ngt-points,    ngt-mesh,    ngt-instanced-mesh,    ngt-skinned-mesh,    ngt-audio,    ngt-positional-audio,    ngt-line,    ngt-line-loop,    ngt-line-segments,    ngt-light-probe,    ngt-ambient-light,    ngt-ambient-light-probe,    ngt-hemisphere-light,    ngt-hemisphere-light-probe,    ngt-directional-light,    ngt-point-light,    ngt-spot-light,    ngt-rect-area-light,    ngt-arrow-helper,    ngt-axes-helper,    ngt-box3-helper,    ngt-grid-helper,    ngt-plane-helper,    ngt-polar-grid-helper,    ngt-sprite,    ngt-camera,    ngt-perspective-camera,    ngt-orthographic-camera,    ngt-array-camera,    ngt-stereo-camera,    ngt-cube-camera  ", exportAs: ["ngtObject3dController"] }, { type: i2.NgtObject3dInputsController, selector: "    ngt-primitive,    ngt-bone,    ngt-group,    ngt-lod,    ngt-points,    ngt-mesh,    ngt-instanced-mesh,    ngt-skinned-mesh,    ngt-audio,    ngt-positional-audio,    ngt-line,    ngt-line-loop,    ngt-line-segments,    ngt-light-probe,    ngt-ambient-light,    ngt-ambient-light-probe,    ngt-hemisphere-light,    ngt-hemisphere-light-probe,    ngt-directional-light,    ngt-point-light,    ngt-spot-light,    ngt-rect-area-light,    ngt-arrow-helper,    ngt-axes-helper,    ngt-box3-helper,    ngt-grid-helper,    ngt-plane-helper,    ngt-polar-grid-helper,    ngt-sprite,    ngt-camera,    ngt-perspective-camera,    ngt-orthographic-camera,    ngt-array-camera,    ngt-stereo-camera,    ngt-cube-camera,    ngt-soba-plane,    ngt-soba-box,    ngt-soba-cylinder,    ngt-soba-cone,    ngt-soba-circle,    ngt-soba-sphere,    ngt-soba-tube,    ngt-soba-torus,    ngt-soba-tetrahedron,    ngt-soba-ring,    ngt-soba-polyhedron,    ngt-soba-octahedron,    ngt-soba-dodecahedron,    ngt-soba-icosahedron,    ngt-soba-extrude,    ngt-soba-lathe,    ngt-soba-torus-knot,    ngt-soba-billboard,    ngt-soba-detailed,    ngt-soba-line,    ngt-soba-quadratic-bezier-line,    ngt-soba-cubic-bezier-line,    ngt-soba-orthographic-camera,    ngt-soba-gizmo-helper,    ngt-soba-gizmo-viewport,    ngt-soba-gizmo-axis-head,    ngt-soba-text  ", inputs: ["name", "position", "rotation", "quaternion", "scale", "color", "userData", "castShadow", "receiveShadow", "visible", "matrixAutoUpdate", "dispose", "raycast", "appendMode", "appendTo", "object3dInputsController"], outputs: ["click", "contextmenu", "dblclick", "pointerup", "pointerdown", "pointerover", "pointerout", "pointerenter", "pointerleave", "pointermove", "pointermissed", "pointercancel", "wheel"], exportAs: ["ngtObject3dInputsController"] }, { type: i2.NgtContentMaterialController, selector: "    ngt-mesh,    ngt-instanced-mesh,    ngt-skinned-mesh,    ngt-line,    ngt-line-loop,    ngt-line-segments,    ngt-soba-plane,    ngt-soba-box,    ngt-soba-cylinder,    ngt-soba-cone,    ngt-soba-circle,    ngt-soba-sphere,    ngt-soba-tube,    ngt-soba-torus,    ngt-soba-tetrahedron,    ngt-soba-ring,    ngt-soba-polyhedron,    ngt-soba-octahedron,    ngt-soba-dodecahedron,    ngt-soba-icosahedron,    ngt-soba-extrude,    ngt-soba-lathe,    ngt-soba-torus-knot,    ngt-soba-text,,    ngt-points  ", inputs: ["material", "isMaterialArray", "contentMaterialController"], exportAs: ["ngtContentMaterialController"] }, { type: i2.NgtContentGeometryController, selector: "    ngt-mesh,    ngt-instanced-mesh,    ngt-skinned-mesh,    ngt-line,    ngt-line-loop,    ngt-line-segments,    ngt-points  ", inputs: ["geometry", "contentGeometryController"], exportAs: ["ngtContentGeometryController"] }, { type: i2.NgtAnimationSubscriberController, selector: "[animateReady]", inputs: ["priority"], outputs: ["animateReady"], exportAs: ["ngtAnimationSubscriberController"] }, { type: i3.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { type: i4.NgtBufferGeometry, selector: "ngt-buffer-geometry", inputs: ["args"], exportAs: ["ngtBufferGeometry"] }, { type: i5.NgtBufferAttribute, selector: "ngt-buffer-attribute", inputs: ["args"], exportAs: ["ngtBufferAttribute"] }, { type: i6.NgtSobaStarFieldMaterial, selector: "ngt-soba-star-field-material", exportAs: ["ngtSobaStarFieldMaterial"] }], pipes: { "async": i3.AsyncPipe }, changeDetection: i0.ChangeDetectionStrategy.OnPush });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.1.1", ngImport: i0, type: NgtSobaStars, decorators: [{
            type: Component,
            args: [{
                    selector: 'ngt-soba-stars',
                    template: `
    <ngt-points (ready)="object = $event" (animateReady)="onAnimate($event)">
      <ng-container *ngIf="attributes$ | async as attributes">
        <ngt-buffer-geometry>
          <ngt-buffer-attribute
            attach="position"
            [args]="[attributes.positions, 3]"
          ></ngt-buffer-attribute>
          <ngt-buffer-attribute
            attach="color"
            [args]="[attributes.colors, 3]"
          ></ngt-buffer-attribute>
          <ngt-buffer-attribute
            attach="size"
            [args]="[attributes.sizes, 1]"
          ></ngt-buffer-attribute>
        </ngt-buffer-geometry>
        <ngt-soba-star-field-material
          #sobaStarFieldMaterial="ngtSobaStarFieldMaterial"
          (ready)="starMaterial = $event"
          [parameters]="{
            vertexColors: true,
            transparent: true,
            blending: this.blending,
            uniforms: {
              fade: { value: attributes.fade },
              time: sobaStarFieldMaterial.material?.uniforms?.time || {
                value: 0
              }
            }
          }"
        ></ngt-soba-star-field-material>
      </ng-container>
    </ngt-points>
  `,
                    changeDetection: ChangeDetectionStrategy.OnPush,
                    providers: [
                        {
                            provide: NgtSobaExtender,
                            useExisting: NgtSobaStars,
                        },
                        NgtSobaStarsStore,
                    ],
                }]
        }], ctorParameters: function () { return [{ type: NgtSobaStarsStore }]; }, propDecorators: { radius: [{
                type: Input
            }], depth: [{
                type: Input
            }], count: [{
                type: Input
            }], factor: [{
                type: Input
            }], saturation: [{
                type: Input
            }], fade: [{
                type: Input
            }] } });
export class NgtSobaStarsModule {
}
NgtSobaStarsModule.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.1.1", ngImport: i0, type: NgtSobaStarsModule, deps: [], target: i0.ɵɵFactoryTarget.NgModule });
NgtSobaStarsModule.ɵmod = i0.ɵɵngDeclareNgModule({ minVersion: "12.0.0", version: "13.1.1", ngImport: i0, type: NgtSobaStarsModule, declarations: [NgtSobaStars], imports: [NgtPointsModule,
        NgtBufferGeometryModule,
        NgtBufferAttributeModule,
        NgtSobaStarFieldMaterialModule,
        CommonModule], exports: [NgtSobaStars] });
NgtSobaStarsModule.ɵinj = i0.ɵɵngDeclareInjector({ minVersion: "12.0.0", version: "13.1.1", ngImport: i0, type: NgtSobaStarsModule, imports: [[
            NgtPointsModule,
            NgtBufferGeometryModule,
            NgtBufferAttributeModule,
            NgtSobaStarFieldMaterialModule,
            CommonModule,
        ]] });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.1.1", ngImport: i0, type: NgtSobaStarsModule, decorators: [{
            type: NgModule,
            args: [{
                    declarations: [NgtSobaStars],
                    exports: [NgtSobaStars],
                    imports: [
                        NgtPointsModule,
                        NgtBufferGeometryModule,
                        NgtBufferAttributeModule,
                        NgtSobaStarFieldMaterialModule,
                        CommonModule,
                    ],
                }]
        }] });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RhcnMuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vcGFja2FnZXMvc29iYS9zdGFnaW5nL3NyYy9zdGFycy9zdGFycy5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUNMLGVBQWUsRUFFZixlQUFlLEdBQ2hCLE1BQU0scUJBQXFCLENBQUM7QUFDN0IsT0FBTyxFQUFFLHdCQUF3QixFQUFFLE1BQU0sZ0NBQWdDLENBQUM7QUFDMUUsT0FBTyxFQUFFLHVCQUF1QixFQUFFLE1BQU0sZ0NBQWdDLENBQUM7QUFDekUsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLDRCQUE0QixDQUFDO0FBQzdELE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUMvQyxPQUFPLEVBQ0wsdUJBQXVCLEVBQ3ZCLFNBQVMsRUFDVCxVQUFVLEVBQ1YsS0FBSyxFQUNMLFFBQVEsR0FDVCxNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDaEQsT0FBTyxFQUFFLEdBQUcsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUMzQixPQUFPLEtBQUssS0FBSyxNQUFNLE9BQU8sQ0FBQztBQUMvQixPQUFPLEVBQ0wsOEJBQThCLEdBRS9CLE1BQU0sMkJBQTJCLENBQUM7Ozs7Ozs7O0FBRW5DLE1BQU0sT0FBTyxHQUFHLENBQUMsQ0FBUyxFQUFFLEVBQUU7SUFDNUIsT0FBTyxJQUFJLEtBQUssQ0FBQyxPQUFPLEVBQUUsQ0FBQyxnQkFBZ0IsQ0FDekMsSUFBSSxLQUFLLENBQUMsU0FBUyxDQUNqQixDQUFDLEVBQ0QsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLE1BQU0sRUFBRSxHQUFHLENBQUMsQ0FBQyxFQUNoQyxJQUFJLENBQUMsTUFBTSxFQUFFLEdBQUcsQ0FBQyxHQUFHLElBQUksQ0FBQyxFQUFF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L0MsU0FBUyxFQUFFO3dCQUNUOzRCQUNFLE9BQU8sRUFBRSxlQUFlOzRCQUN4QixXQUFXLGNBQWM7eUJBQzFCO3dCQUNELGlCQUFpQjtxQkFDbEI7aUJBQ0Y7MERBZ0NxQyxpQkFBaUIsMEJBeEJ4QyxNQUFNO3NCQUFsQixLQUFLO2dCQUlPLEtBQUs7c0JBQWpCLEtBQUs7Z0JBSU8sS0FBSztzQkFBakIsS0FBSztnQkFJTyxNQUFNO3NCQUFsQixLQUFLO2dCQUlPLFVBQVU7c0JBQXRCLEtBQUs7Z0JBSU8sSUFBSTtzQkFBaEIsS0FBSzs7QUEwQlIsTUFBTSxPQUFPLGtCQUFrQjs7K0dBQWxCLGtCQUFrQjtnSEFBbEIsa0JBQWtCLGlCQXJEbEIsWUFBWSxhQThDckIsZUFBZTtRQUNmLHVCQUF1QjtRQUN2Qix3QkFBd0I7UUFDeEIsOEJBQThCO1FBQzlCLFlBQVksYUFsREgsWUFBWTtnSEFxRFosa0JBQWtCLFlBUnBCO1lBQ1AsZUFBZTtZQUNmLHVCQUF1QjtZQUN2Qix3QkFBd0I7WUFDeEIsOEJBQThCO1lBQzlCLFlBQVk7U0FDYjsyRkFFVSxrQkFBa0I7a0JBWDlCLFFBQVE7bUJBQUM7b0JBQ1IsWUFBWSxFQUFFLENBQUMsWUFBWSxDQUFDO29CQUM1QixPQUFPLEVBQUUsQ0FBQyxZQUFZLENBQUM7b0JBQ3ZCLE9BQU8sRUFBRTt3QkFDUCxlQUFlO3dCQUNmLHVCQUF1Qjt3QkFDdkIsd0JBQXdCO3dCQUN4Qiw4QkFBOEI7d0JBQzlCLFlBQVk7cUJBQ2I7aUJBQ0YiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBFbmhhbmNlZFJ4U3RhdGUsXG4gIE5ndFJlbmRlcixcbiAgTmd0U29iYUV4dGVuZGVyLFxufSBmcm9tICdAYW5ndWxhci10aHJlZS9jb3JlJztcbmltcG9ydCB7IE5ndEJ1ZmZlckF0dHJpYnV0ZU1vZHVsZSB9IGZyb20gJ0Bhbmd1bGFyLXRocmVlL2NvcmUvYXR0cmlidXRlcyc7XG5pbXBvcnQgeyBOZ3RCdWZmZXJHZW9tZXRyeU1vZHVsZSB9IGZyb20gJ0Bhbmd1bGFyLXRocmVlL2NvcmUvZ2VvbWV0cmllcyc7XG5pbXBvcnQgeyBOZ3RQb2ludHNNb2R1bGUgfSBmcm9tICdAYW5ndWxhci10aHJlZS9jb3JlL3BvaW50cyc7XG5pbXBvcnQgeyBDb21tb25Nb2R1bGUgfSBmcm9tICdAYW5ndWxhci9jb21tb24nO1xuaW1wb3J0IHtcbiAgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3ksXG4gIENvbXBvbmVudCxcbiAgSW5qZWN0YWJsZSxcbiAgSW5wdXQsXG4gIE5nTW9kdWxlLFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IHNlbGVjdFNsaWNlIH0gZnJvbSAnQHJ4LWFuZ3VsYXIvc3RhdGUnO1xuaW1wb3J0IHsgbWFwIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgKiBhcyBUSFJFRSBmcm9tICd0aHJlZSc7XG5pbXBvcnQge1xuICBOZ3RTb2JhU3RhckZpZWxkTWF0ZXJpYWxNb2R1bGUsXG4gIFN0YXJGaWVsZE1hdGVyaWFsLFxufSBmcm9tICcuL3N0YXItbWF0ZXJpYWwuZGlyZWN0aXZlJztcblxuY29uc3QgZ2VuU3RhciA9IChyOiBudW1iZXIpID0+IHtcbiAgcmV0dXJuIG5ldyBUSFJFRS5WZWN0b3IzKCkuc2V0RnJvbVNwaGVyaWNhbChcbiAgICBuZXcgVEhSRUUuU3BoZXJpY2FsKFxuICAgICAgcixcbiAgICAgIE1hdGguYWNvcygxIC0gTWF0aC5yYW5kb20oKSAqIDIpLFxuICAgICAgTWF0aC5yYW5kb20oKSAqIDIgKiBNYXRoLlBJXG4gICAgKVxuICApO1xufTtcblxuZXhwb3J0IGludGVyZmFjZSBOZ3RTb2JhU3RhcnNTdGF0ZSB7XG4gIHJhZGl1czogbnVtYmVyO1xuICBkZXB0aDogbnVtYmVyO1xuICBjb3VudDogbnVtYmVyO1xuICBmYWN0b3I6IG51bWJlcjtcbiAgc2F0dXJhdGlvbjogbnVtYmVyO1xuICBmYWRlOiBib29sZWFuO1xufVxuXG5ASW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgTmd0U29iYVN0YXJzU3RvcmUgZXh0ZW5kcyBFbmhhbmNlZFJ4U3RhdGU8Tmd0U29iYVN0YXJzU3RhdGU+IHtcbiAgcmVhZG9ubHkgYXR0cmlidXRlcyQgPSB0aGlzLnNlbGVjdChcbiAgICBzZWxlY3RTbGljZShbJ3JhZGl1cycsICdkZXB0aCcsICdjb3VudCcsICdmYWN0b3InLCAnc2F0dXJhdGlvbiddKSxcbiAgICBtYXAoKHsgZGVwdGgsIGNvdW50LCBmYWN0b3IsIHJhZGl1cywgc2F0dXJhdGlvbiB9KSA9PiB7XG4gICAgICBjb25zdCBwb3NpdGlvbnM6IG51bWJlcltdID0gW107XG4gICAgICBjb25zdCBjb2xvcnM6IG51bWJlcltdID0gW107XG4gICAgICBjb25zdCBzaXplcyA9IEFycmF5LmZyb20oXG4gICAgICAgIHsgbGVuZ3RoOiBjb3VudCB9LFxuICAgICAgICAoKSA9PiAoMC41ICsgMC41ICogTWF0aC5yYW5kb20oKSkgKiBmYWN0b3JcbiAgICAgICk7XG4gICAgICBjb25zdCBjb2xvciA9IG5ldyBUSFJFRS5Db2xvcigpO1xuICAgICAgbGV0IHIgPSByYWRpdXMgKyBkZXB0aDtcbiAgICAgIGNvbnN0IGluY3JlbWVudCA9IGRlcHRoIC8gY291bnQ7XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvdW50OyBpKyspIHtcbiAgICAgICAgciAtPSBpbmNyZW1lbnQgKiBNYXRoLnJhbmRvbSgpO1xuICAgICAgICBwb3NpdGlvbnMucHVzaCguLi5nZW5TdGFyKHIpLnRvQXJyYXkoKSk7XG4gICAgICAgIGNvbG9yLnNldEhTTChpIC8gY291bnQsIHNhdHVyYXRpb24sIDAuOSk7XG4gICAgICAgIGNvbG9ycy5wdXNoKGNvbG9yLnIsIGNvbG9yLmcsIGNvbG9yLmIpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgcG9zaXRpb25zOiBuZXcgRmxvYXQzMkFycmF5KHBvc2l0aW9ucyksXG4gICAgICAgIGNvbG9yczogbmV3IEZsb2F0MzJBcnJheShjb2xvcnMpLFxuICAgICAgICBzaXplczogbmV3IEZsb2F0MzJBcnJheShzaXplcyksXG4gICAgICAgIGZhZGU6IHRoaXMuZ2V0KCdmYWRlJyksXG4gICAgICB9O1xuICAgIH0pXG4gICk7XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgc3VwZXIoKTtcbiAgICB0aGlzLnNldCh7XG4gICAgICByYWRpdXM6IDEwMCxcbiAgICAgIGRlcHRoOiA1MCxcbiAgICAgIGNvdW50OiA1MDAwLFxuICAgICAgc2F0dXJhdGlvbjogMCxcbiAgICAgIGZhY3RvcjogNCxcbiAgICAgIGZhZGU6IGZhbHNlLFxuICAgIH0pO1xuICB9XG59XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ25ndC1zb2JhLXN0YXJzJyxcbiAgdGVtcGxhdGU6IGBcbiAgICA8bmd0LXBvaW50cyAocmVhZHkpPVwib2JqZWN0ID0gJGV2ZW50XCIgKGFuaW1hdGVSZWFkeSk9XCJvbkFuaW1hdGUoJGV2ZW50KVwiPlxuICAgICAgPG5nLWNvbnRhaW5lciAqbmdJZj1cImF0dHJpYnV0ZXMkIHwgYXN5bmMgYXMgYXR0cmlidXRlc1wiPlxuICAgICAgICA8bmd0LWJ1ZmZlci1nZW9tZXRyeT5cbiAgICAgICAgICA8bmd0LWJ1ZmZlci1hdHRyaWJ1dGVcbiAgICAgICAgICAgIGF0dGFjaD1cInBvc2l0aW9uXCJcbiAgICAgICAgICAgIFthcmdzXT1cIlthdHRyaWJ1dGVzLnBvc2l0aW9ucywgM11cIlxuICAgICAgICAgID48L25ndC1idWZmZXItYXR0cmlidXRlPlxuICAgICAgICAgIDxuZ3QtYnVmZmVyLWF0dHJpYnV0ZVxuICAgICAgICAgICAgYXR0YWNoPVwiY29sb3JcIlxuICAgICAgICAgICAgW2FyZ3NdPVwiW2F0dHJpYnV0ZXMuY29sb3JzLCAzXVwiXG4gICAgICAgICAgPjwvbmd0LWJ1ZmZlci1hdHRyaWJ1dGU+XG4gICAgICAgICAgPG5ndC1idWZmZXItYXR0cmlidXRlXG4gICAgICAgICAgICBhdHRhY2g9XCJzaXplXCJcbiAgICAgICAgICAgIFthcmdzXT1cIlthdHRyaWJ1dGVzLnNpemVzLCAxXVwiXG4gICAgICAgICAgPjwvbmd0LWJ1ZmZlci1hdHRyaWJ1dGU+XG4gICAgICAgIDwvbmd0LWJ1ZmZlci1nZW9tZXRyeT5cbiAgICAgICAgPG5ndC1zb2JhLXN0YXItZmllbGQtbWF0ZXJpYWxcbiAgICAgICAgICAjc29iYVN0YXJGaWVsZE1hdGVyaWFsPVwibmd0U29iYVN0YXJGaWVsZE1hdGVyaWFsXCJcbiAgICAgICAgICAocmVhZHkpPVwic3Rhck1hdGVyaWFsID0gJGV2ZW50XCJcbiAgICAgICAgICBbcGFyYW1ldGVyc109XCJ7XG4gICAgICAgICAgICB2ZXJ0ZXhDb2xvcnM6IHRydWUsXG4gICAgICAgICAgICB0cmFuc3BhcmVudDogdHJ1ZSxcbiAgICAgICAgICAgIGJsZW5kaW5nOiB0aGlzLmJsZW5kaW5nLFxuICAgICAgICAgICAgdW5pZm9ybXM6IHtcbiAgICAgICAgICAgICAgZmFkZTogeyB2YWx1ZTogYXR0cmlidXRlcy5mYWRlIH0sXG4gICAgICAgICAgICAgIHRpbWU6IHNvYmFTdGFyRmllbGRNYXRlcmlhbC5tYXRlcmlhbD8udW5pZm9ybXM/LnRpbWUgfHwge1xuICAgICAgICAgICAgICAgIHZhbHVlOiAwXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XCJcbiAgICAgICAgPjwvbmd0LXNvYmEtc3Rhci1maWVsZC1tYXRlcmlhbD5cbiAgICAgIDwvbmctY29udGFpbmVyPlxuICAgIDwvbmd0LXBvaW50cz5cbiAgYCxcbiAgY2hhbmdlRGV0ZWN0aW9uOiBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneS5PblB1c2gsXG4gIHByb3ZpZGVyczogW1xuICAgIHtcbiAgICAgIHByb3ZpZGU6IE5ndFNvYmFFeHRlbmRlcixcbiAgICAgIHVzZUV4aXN0aW5nOiBOZ3RTb2JhU3RhcnMsXG4gICAgfSxcbiAgICBOZ3RTb2JhU3RhcnNTdG9yZSxcbiAgXSxcbn0pXG5leHBvcnQgY2xhc3MgTmd0U29iYVN0YXJzIGV4dGVuZHMgTmd0U29iYUV4dGVuZGVyPFRIUkVFLlBvaW50cz4ge1xuICByZWFkb25seSBibGVuZGluZyA9IFRIUkVFLkFkZGl0aXZlQmxlbmRpbmc7XG5cbiAgcmVhZG9ubHkgYXR0cmlidXRlcyQgPSB0aGlzLnNvYmFTdGFyc1N0b3JlLmF0dHJpYnV0ZXMkO1xuXG4gIHN0YXJNYXRlcmlhbD86IFN0YXJGaWVsZE1hdGVyaWFsO1xuXG4gIEBJbnB1dCgpIHNldCByYWRpdXMocmFkaXVzOiBudW1iZXIpIHtcbiAgICB0aGlzLnNvYmFTdGFyc1N0b3JlLnNldCh7IHJhZGl1cyB9KTtcbiAgfVxuXG4gIEBJbnB1dCgpIHNldCBkZXB0aChkZXB0aDogbnVtYmVyKSB7XG4gICAgdGhpcy5zb2JhU3RhcnNTdG9yZS5zZXQoeyBkZXB0aCB9KTtcbiAgfVxuXG4gIEBJbnB1dCgpIHNldCBjb3VudChjb3VudDogbnVtYmVyKSB7XG4gICAgdGhpcy5zb2JhU3RhcnNTdG9yZS5zZXQoeyBjb3VudCB9KTtcbiAgfVxuXG4gIEBJbnB1dCgpIHNldCBmYWN0b3IoZmFjdG9yOiBudW1iZXIpIHtcbiAgICB0aGlzLnNvYmFTdGFyc1N0b3JlLnNldCh7IGZhY3RvciB9KTtcbiAgfVxuXG4gIEBJbnB1dCgpIHNldCBzYXR1cmF0aW9uKHNhdHVyYXRpb246IG51bWJlcikge1xuICAgIHRoaXMuc29iYVN0YXJzU3RvcmUuc2V0KHsgc2F0dXJhdGlvbiB9KTtcbiAgfVxuXG4gIEBJbnB1dCgpIHNldCBmYWRlKGZhZGU6IGJvb2xlYW4pIHtcbiAgICB0aGlzLnNvYmFTdGFyc1N0b3JlLnNldCh7IGZhZGUgfSk7XG4gIH1cblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHNvYmFTdGFyc1N0b3JlOiBOZ3RTb2JhU3RhcnNTdG9yZSkge1xuICAgIHN1cGVyKCk7XG4gIH1cblxuICBvbkFuaW1hdGUoeyBjbG9jayB9OiBOZ3RSZW5kZXIpIHtcbiAgICBpZiAodGhpcy5zdGFyTWF0ZXJpYWwpIHtcbiAgICAgIHRoaXMuc3Rhck1hdGVyaWFsLnVuaWZvcm1zLnRpbWUudmFsdWUgPSBjbG9jay5nZXRFbGFwc2VkVGltZSgpO1xuICAgIH1cbiAgfVxufVxuXG5ATmdNb2R1bGUoe1xuICBkZWNsYXJhdGlvbnM6IFtOZ3RTb2JhU3RhcnNdLFxuICBleHBvcnRzOiBbTmd0U29iYVN0YXJzXSxcbiAgaW1wb3J0czogW1xuICAgIE5ndFBvaW50c01vZHVsZSxcbiAgICBOZ3RCdWZmZXJHZW9tZXRyeU1vZHVsZSxcbiAgICBOZ3RCdWZmZXJBdHRyaWJ1dGVNb2R1bGUsXG4gICAgTmd0U29iYVN0YXJGaWVsZE1hdGVyaWFsTW9kdWxlLFxuICAgIENvbW1vbk1vZHVsZSxcbiAgXSxcbn0pXG5leHBvcnQgY2xhc3MgTmd0U29iYVN0YXJzTW9kdWxlIHt9XG4iXX0=