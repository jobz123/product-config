import { EnhancedRxState, NgtAnimationFrameStore, NgtStore, } from '@angular-three/core';
import { Directive, NgModule, NgZone, Output } from '@angular/core';
import { selectSlice } from '@rx-angular/state';
import { FirstPersonControls } from 'three-stdlib';
import * as i0 from "@angular/core";
import * as i1 from "@angular-three/core";
export class NgtSobaFirstPersonControls extends EnhancedRxState {
    constructor(store, animationFrameStore, ngZone) {
        super();
        this.store = store;
        this.animationFrameStore = animationFrameStore;
        this.ngZone = ngZone;
        this.ready = this.select('controls');
    }
    ngOnInit() {
        this.hold(this.store.select(selectSlice(['camera', 'renderer'])), ({ renderer, camera }) => {
            this.ngZone.runOutsideAngular(() => {
                if (camera && renderer) {
                    this.set({
                        controls: new FirstPersonControls(camera, renderer.domElement),
                    });
                }
            });
        });
        this.holdEffect(this.select('controls'), (controls) => {
            const animationUuid = this.animationFrameStore.register({
                callback: ({ delta }) => {
                    controls.update(delta);
                },
            });
            return () => {
                this.animationFrameStore.actions.unsubscriberUuid(animationUuid);
            };
        });
    }
    get controls() {
        return this.get('controls');
    }
}
NgtSobaFirstPersonControls.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.1.1", ngImport: i0, type: NgtSobaFirstPersonControls, deps: [{ token: i1.NgtStore }, { token: i1.NgtAnimationFrameStore }, { token: i0.NgZone }], target: i0.ɵɵFactoryTarget.Directive });
NgtSobaFirstPersonControls.ɵdir = i0.ɵɵngDeclareDirective({ minVersion: "12.0.0", version: "13.1.1", type: NgtSobaFirstPersonControls, selector: "ngt-soba-first-person-controls", outputs: { ready: "ready" }, exportAs: ["ngtSobaFirstPersonControls"], usesInheritance: true, ngImport: i0 });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.1.1", ngImport: i0, type: NgtSobaFirstPersonControls, decorators: [{
            type: Directive,
            args: [{
                    selector: 'ngt-soba-first-person-controls',
                    exportAs: 'ngtSobaFirstPersonControls',
                }]
        }], ctorParameters: function () { return [{ type: i1.NgtStore }, { type: i1.NgtAnimationFrameStore }, { type: i0.NgZone }]; }, propDecorators: { ready: [{
                type: Output
            }] } });
export class NgtSobaFirstPersonControlsModule {
}
NgtSobaFirstPersonControlsModule.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.1.1", ngImport: i0, type: NgtSobaFirstPersonControlsModule, deps: [], target: i0.ɵɵFactoryTarget.NgModule });
NgtSobaFirstPersonControlsModule.ɵmod = i0.ɵɵngDeclareNgModule({ minVersion: "12.0.0", version: "13.1.1", ngImport: i0, type: NgtSobaFirstPersonControlsModule, declarations: [NgtSobaFirstPersonControls], exports: [NgtSobaFirstPersonControls] });
NgtSobaFirstPersonControlsModule.ɵinj = i0.ɵɵngDeclareInjector({ minVersion: "12.0.0", version: "13.1.1", ngImport: i0, type: NgtSobaFirstPersonControlsModule });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.1.1", ngImport: i0, type: NgtSobaFirstPersonControlsModule, decorators: [{
            type: NgModule,
            args: [{
                    declarations: [NgtSobaFirstPersonControls],
                    exports: [NgtSobaFirstPersonControls],
                }]
        }] });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmlyc3QtcGVyc29uLWNvbnRyb2xzLmRpcmVjdGl2ZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uL3BhY2thZ2VzL3NvYmEvY29udHJvbHMvc3JjL2xpYi9maXJzdC1wZXJzb24tY29udHJvbHMvZmlyc3QtcGVyc29uLWNvbnRyb2xzLmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQ0wsZUFBZSxFQUNmLHNCQUFzQixFQUN0QixRQUFRLEdBQ1QsTUFBTSxxQkFBcUIsQ0FBQztBQUM3QixPQUFPLEVBQUUsU0FBUyxFQUFFLFFBQVEsRUFBRSxNQUFNLEVBQVUsTUFBTSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzVFLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUNoRCxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSxjQUFjLENBQUM7OztBQVVuRCxNQUFNLE9BQU8sMEJBQ1gsU0FBUSxlQUFnRDtJQUt4RCxZQUNVLEtBQWUsRUFDZixtQkFBMkMsRUFDM0MsTUFBYztRQUV0QixLQUFLLEVBQUUsQ0FBQztRQUpBLFVBQUssR0FBTCxLQUFLLENBQVU7UUFDZix3QkFBbUIsR0FBbkIsbUJBQW1CLENBQXdCO1FBQzNDLFdBQU0sR0FBTixNQUFNLENBQVE7UUFMZCxVQUFLLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsQ0FBQztJQVExQyxDQUFDO0lBRUQsUUFBUTtRQUNOLElBQUksQ0FBQyxJQUFJLENBQ1AsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsV0FBVyxDQUFDLENBQUMsUUFBUSxFQUFFLFVBQVUsQ0FBQyxDQUFDLENBQUMsRUFDdEQsQ0FBQyxFQUFFLFFBQVEsRUFBRSxNQUFNLEVBQUUsRUFBRSxFQUFFO1lBQ3ZCLElBQUksQ0FBQyxNQUFNLENBQUMsaUJBQWlCLENBQUMsR0FBRyxFQUFFO2dCQUNqQyxJQUFJLE1BQU0sSUFBSSxRQUFRLEVBQUU7b0JBQ3RCLElBQUksQ0FBQyxHQUFHLENBQUM7d0JBQ1AsUUFBUSxFQUFFLElBQUksbUJBQW1CLENBQUMsTUFBTSxFQUFFLFFBQVEsQ0FBQyxVQUFVLENBQUM7cUJBQy9ELENBQUMsQ0FBQztpQkFDSjtZQUNILENBQUMsQ0FBQyxDQUFDO1FBQ0wsQ0FBQyxDQUNGLENBQUM7UUFFRixJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLEVBQUUsQ0FBQyxRQUFRLEVBQUUsRUFBRTtZQUNwRCxNQUFNLGFBQWEsR0FBRyxJQUFJLENBQUMsbUJBQW1CLENBQUMsUUFBUSxDQUFDO2dCQUN0RCxRQUFRLEVBQUUsQ0FBQyxFQUFFLEtBQUssRUFBRSxFQUFFLEVBQUU7b0JBQ3RCLFFBQVEsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUM7Z0JBQ3pCLENBQUM7YUFDRixDQUFDLENBQUM7WUFFSCxPQUFPLEdBQUcsRUFBRTtnQkFDVixJQUFJLENBQUMsbUJBQW1CLENBQUMsT0FBTyxDQUFDLGdCQUFnQixDQUFDLGFBQWEsQ0FBQyxDQUFDO1lBQ25FLENBQUMsQ0FBQztRQUNKLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVELElBQUksUUFBUTtRQUNWLE9BQU8sSUFBSSxDQUFDLEdBQUcsQ0FBQyxVQUFVLENBQXdCLENBQUM7SUFDckQsQ0FBQzs7dUhBM0NVLDBCQUEwQjsyR0FBMUIsMEJBQTBCOzJGQUExQiwwQkFBMEI7a0JBSnRDLFNBQVM7bUJBQUM7b0JBQ1QsUUFBUSxFQUFFLGdDQUFnQztvQkFDMUMsUUFBUSxFQUFFLDRCQUE0QjtpQkFDdkM7eUpBS1csS0FBSztzQkFBZCxNQUFNOztBQThDVCxNQUFNLE9BQU8sZ0NBQWdDOzs2SEFBaEMsZ0NBQWdDOzhIQUFoQyxnQ0FBZ0MsaUJBbERoQywwQkFBMEIsYUFBMUIsMEJBQTBCOzhIQWtEMUIsZ0NBQWdDOzJGQUFoQyxnQ0FBZ0M7a0JBSjVDLFFBQVE7bUJBQUM7b0JBQ1IsWUFBWSxFQUFFLENBQUMsMEJBQTBCLENBQUM7b0JBQzFDLE9BQU8sRUFBRSxDQUFDLDBCQUEwQixDQUFDO2lCQUN0QyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIEVuaGFuY2VkUnhTdGF0ZSxcbiAgTmd0QW5pbWF0aW9uRnJhbWVTdG9yZSxcbiAgTmd0U3RvcmUsXG59IGZyb20gJ0Bhbmd1bGFyLXRocmVlL2NvcmUnO1xuaW1wb3J0IHsgRGlyZWN0aXZlLCBOZ01vZHVsZSwgTmdab25lLCBPbkluaXQsIE91dHB1dCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgc2VsZWN0U2xpY2UgfSBmcm9tICdAcngtYW5ndWxhci9zdGF0ZSc7XG5pbXBvcnQgeyBGaXJzdFBlcnNvbkNvbnRyb2xzIH0gZnJvbSAndGhyZWUtc3RkbGliJztcblxuaW50ZXJmYWNlIE5ndFNvYmFGaXJzdFBlcnNvbkNvbnRyb2xzU3RhdGUge1xuICBjb250cm9sczogRmlyc3RQZXJzb25Db250cm9scztcbn1cblxuQERpcmVjdGl2ZSh7XG4gIHNlbGVjdG9yOiAnbmd0LXNvYmEtZmlyc3QtcGVyc29uLWNvbnRyb2xzJyxcbiAgZXhwb3J0QXM6ICduZ3RTb2JhRmlyc3RQZXJzb25Db250cm9scycsXG59KVxuZXhwb3J0IGNsYXNzIE5ndFNvYmFGaXJzdFBlcnNvbkNvbnRyb2xzXG4gIGV4dGVuZHMgRW5oYW5jZWRSeFN0YXRlPE5ndFNvYmFGaXJzdFBlcnNvbkNvbnRyb2xzU3RhdGU+XG4gIGltcGxlbWVudHMgT25Jbml0XG57XG4gIEBPdXRwdXQoKSByZWFkeSA9IHRoaXMuc2VsZWN0KCdjb250cm9scycpO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgc3RvcmU6IE5ndFN0b3JlLFxuICAgIHByaXZhdGUgYW5pbWF0aW9uRnJhbWVTdG9yZTogTmd0QW5pbWF0aW9uRnJhbWVTdG9yZSxcbiAgICBwcml2YXRlIG5nWm9uZTogTmdab25lXG4gICkge1xuICAgIHN1cGVyKCk7XG4gIH1cblxuICBuZ09uSW5pdCgpIHtcbiAgICB0aGlzLmhvbGQoXG4gICAgICB0aGlzLnN0b3JlLnNlbGVjdChzZWxlY3RTbGljZShbJ2NhbWVyYScsICdyZW5kZXJlciddKSksXG4gICAgICAoeyByZW5kZXJlciwgY2FtZXJhIH0pID0+IHtcbiAgICAgICAgdGhpcy5uZ1pvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4ge1xuICAgICAgICAgIGlmIChjYW1lcmEgJiYgcmVuZGVyZXIpIHtcbiAgICAgICAgICAgIHRoaXMuc2V0KHtcbiAgICAgICAgICAgICAgY29udHJvbHM6IG5ldyBGaXJzdFBlcnNvbkNvbnRyb2xzKGNhbWVyYSwgcmVuZGVyZXIuZG9tRWxlbWVudCksXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICk7XG5cbiAgICB0aGlzLmhvbGRFZmZlY3QodGhpcy5zZWxlY3QoJ2NvbnRyb2xzJyksIChjb250cm9scykgPT4ge1xuICAgICAgY29uc3QgYW5pbWF0aW9uVXVpZCA9IHRoaXMuYW5pbWF0aW9uRnJhbWVTdG9yZS5yZWdpc3Rlcih7XG4gICAgICAgIGNhbGxiYWNrOiAoeyBkZWx0YSB9KSA9PiB7XG4gICAgICAgICAgY29udHJvbHMudXBkYXRlKGRlbHRhKTtcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuXG4gICAgICByZXR1cm4gKCkgPT4ge1xuICAgICAgICB0aGlzLmFuaW1hdGlvbkZyYW1lU3RvcmUuYWN0aW9ucy51bnN1YnNjcmliZXJVdWlkKGFuaW1hdGlvblV1aWQpO1xuICAgICAgfTtcbiAgICB9KTtcbiAgfVxuXG4gIGdldCBjb250cm9scygpIHtcbiAgICByZXR1cm4gdGhpcy5nZXQoJ2NvbnRyb2xzJykgYXMgRmlyc3RQZXJzb25Db250cm9scztcbiAgfVxufVxuXG5ATmdNb2R1bGUoe1xuICBkZWNsYXJhdGlvbnM6IFtOZ3RTb2JhRmlyc3RQZXJzb25Db250cm9sc10sXG4gIGV4cG9ydHM6IFtOZ3RTb2JhRmlyc3RQZXJzb25Db250cm9sc10sXG59KVxuZXhwb3J0IGNsYXNzIE5ndFNvYmFGaXJzdFBlcnNvbkNvbnRyb2xzTW9kdWxlIHt9XG4iXX0=