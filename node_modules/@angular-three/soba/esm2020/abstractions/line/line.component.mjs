var _NgtSobaLine_resolution, _NgtSobaLine_sobaLineInputsController;
import { __classPrivateFieldGet, __classPrivateFieldSet } from "tslib";
import { Controller, createControllerProviderFactory, EnhancedRxState, NGT_OBJECT_INPUTS_CONTROLLER_PROVIDER, NGT_OBJECT_INPUTS_WATCHED_CONTROLLER, NgtObject3dInputsController, NgtObject3dInputsControllerModule, } from '@angular-three/core';
import { NgtPrimitiveModule } from '@angular-three/core/primitive';
import { ChangeDetectionStrategy, Component, Directive, Inject, Input, NgModule, NgZone, Output, } from '@angular/core';
import { selectSlice } from '@rx-angular/state';
import { combineLatest, distinctUntilChanged, map, startWith } from 'rxjs';
import * as THREE from 'three';
import { Line2, LineGeometry, LineMaterial, } from 'three-stdlib';
import * as i0 from "@angular/core";
import * as i1 from "@angular-three/core";
import * as i2 from "@angular-three/core/primitive";
export class NgtSobaLineInputsController extends Controller {
    constructor() {
        super(...arguments);
        this.color = 'black';
        this.parameters = {};
    }
    get controller() {
        return this.sobaLineInputsController;
    }
    get props() {
        return ['color', 'vertexColors', 'lineWidth', 'dashed', 'parameters'];
    }
}
NgtSobaLineInputsController.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.1.1", ngImport: i0, type: NgtSobaLineInputsController, deps: null, target: i0.ɵɵFactoryTarget.Directive });
NgtSobaLineInputsController.ɵdir = i0.ɵɵngDeclareDirective({ minVersion: "12.0.0", version: "13.1.1", type: NgtSobaLineInputsController, selector: "ngt-soba-line,ngt-soba-quadratic-bezier-line,ngt-soba-cubic-bezier-line", inputs: { color: "color", vertexColors: "vertexColors", lineWidth: "lineWidth", dashed: "dashed", parameters: "parameters", sobaLineInputsController: "sobaLineInputsController" }, exportAs: ["ngtSobaLineInputsController"], usesInheritance: true, ngImport: i0 });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.1.1", ngImport: i0, type: NgtSobaLineInputsController, decorators: [{
            type: Directive,
            args: [{
                    selector: 'ngt-soba-line,ngt-soba-quadratic-bezier-line,ngt-soba-cubic-bezier-line',
                    exportAs: 'ngtSobaLineInputsController',
                }]
        }], propDecorators: { color: [{
                type: Input
            }], vertexColors: [{
                type: Input
            }], lineWidth: [{
                type: Input
            }], dashed: [{
                type: Input
            }], parameters: [{
                type: Input
            }], sobaLineInputsController: [{
                type: Input
            }] } });
export const [NGT_SOBA_LINE_INPUTS_WATCHED_CONTROLLER, NGT_SOBA_LINE_INPUTS_CONTROLLER_PROVIDER,] = createControllerProviderFactory({
    watchedControllerTokenName: 'Watched SobaLine Inputs Controller',
    controller: NgtSobaLineInputsController,
});
export class NgtSobaLine extends EnhancedRxState {
    constructor(sobaLineInputsController, objectInputsController, ngZone) {
        super();
        this.sobaLineInputsController = sobaLineInputsController;
        this.objectInputsController = objectInputsController;
        this.ngZone = ngZone;
        _NgtSobaLine_resolution.set(this, new THREE.Vector2(512, 512));
        _NgtSobaLine_sobaLineInputsController.set(this, void 0);
        this.ready = this.select('line');
    }
    set points(points) {
        this.set({ points });
    }
    ngOnInit() {
        __classPrivateFieldSet(this, _NgtSobaLine_sobaLineInputsController, this.sobaLineInputsController.sobaLineInputsController ||
            this.sobaLineInputsController, "f");
        this.set({
            lineMaterial: new LineMaterial(),
        });
        const geometryChanges$ = combineLatest([
            this.select('points'),
            __classPrivateFieldGet(this, _NgtSobaLine_sobaLineInputsController, "f").change$.pipe(map(() => __classPrivateFieldGet(this, _NgtSobaLine_sobaLineInputsController, "f").vertexColors), distinctUntilChanged(), startWith(undefined)),
        ]);
        const materialChanges$ = combineLatest([
            this.select('lineMaterial'),
            __classPrivateFieldGet(this, _NgtSobaLine_sobaLineInputsController, "f").change$.pipe(map((changes) => {
                return {
                    color: (changes.sobaLineInputsController
                        ? changes.sobaLineInputsController.currentValue
                        : __classPrivateFieldGet(this, _NgtSobaLine_sobaLineInputsController, "f")).color,
                    vertexColors: Boolean((changes.sobaLineInputsController
                        ? changes.sobaLineInputsController.currentValue
                        : __classPrivateFieldGet(this, _NgtSobaLine_sobaLineInputsController, "f")).vertexColors),
                    linewidth: (changes.sobaLineInputsController
                        ? changes.sobaLineInputsController.currentValue
                        : __classPrivateFieldGet(this, _NgtSobaLine_sobaLineInputsController, "f")).lineWidth,
                    dashed: (changes.sobaLineInputsController
                        ? changes.sobaLineInputsController.currentValue
                        : __classPrivateFieldGet(this, _NgtSobaLine_sobaLineInputsController, "f")).dashed,
                    parameters: (changes.sobaLineInputsController
                        ? changes.sobaLineInputsController.currentValue
                        : __classPrivateFieldGet(this, _NgtSobaLine_sobaLineInputsController, "f")).parameters,
                };
            }), startWith({
                color: __classPrivateFieldGet(this, _NgtSobaLine_sobaLineInputsController, "f").color,
                vertexColors: Boolean(__classPrivateFieldGet(this, _NgtSobaLine_sobaLineInputsController, "f").vertexColors),
                linewidth: __classPrivateFieldGet(this, _NgtSobaLine_sobaLineInputsController, "f").lineWidth,
                dashed: __classPrivateFieldGet(this, _NgtSobaLine_sobaLineInputsController, "f").dashed,
                parameters: __classPrivateFieldGet(this, _NgtSobaLine_sobaLineInputsController, "f").parameters,
            })),
        ]);
        this.hold(this.select(selectSlice(['line', 'points'])), ({ line }) => {
            line.computeLineDistances();
        });
        this.hold(materialChanges$, ([lineMaterial, { dashed, parameters, vertexColors, color, linewidth },]) => {
            const lineParameters = {
                vertexColors,
                color,
                resolution: __classPrivateFieldGet(this, _NgtSobaLine_resolution, "f"),
                ...parameters,
            };
            if (dashed !== undefined) {
                lineParameters.dashed = dashed;
            }
            if (linewidth !== undefined) {
                lineParameters.linewidth = linewidth;
            }
            lineMaterial.setValues(lineParameters);
            if (dashed) {
                lineMaterial.defines.USE_DASH = '';
            }
            else {
                // Setting lineMaterial.defines.USE_DASH to undefined is apparently not sufficient.
                delete lineMaterial.defines.USE_DASH;
            }
            lineMaterial.needsUpdate = true;
        });
        this.connect('lineGeometry', geometryChanges$, (_, [points, vertexColors]) => {
            return this.ngZone.runOutsideAngular(() => {
                const lineGeometry = new LineGeometry();
                const pValues = points.map((p) => p instanceof THREE.Vector3 ? p.toArray() : p);
                lineGeometry.setPositions(pValues.flat());
                if (vertexColors) {
                    const cValues = vertexColors.map((c) => c instanceof THREE.Color ? c.toArray() : c);
                    lineGeometry.setColors(cValues.flat());
                }
                return lineGeometry;
            });
        });
        this.holdEffect(this.select('lineGeometry'), (lineGeometry) => {
            return () => {
                lineGeometry.dispose();
            };
        });
        this.holdEffect(this.select('lineMaterial'), (lineMaterial) => {
            return () => {
                lineMaterial.dispose();
            };
        });
        this.hold(this.select(selectSlice(['lineGeometry', 'lineMaterial'])), ({ lineMaterial, lineGeometry }) => {
            const line = this.get('line');
            if (!line) {
                this.set({ line: new Line2(lineGeometry, lineMaterial) });
            }
            else {
                line.geometry = lineGeometry;
                line.computeLineDistances();
            }
        });
    }
    get line() {
        return this.get('line');
    }
}
_NgtSobaLine_resolution = new WeakMap(), _NgtSobaLine_sobaLineInputsController = new WeakMap();
NgtSobaLine.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.1.1", ngImport: i0, type: NgtSobaLine, deps: [{ token: NGT_SOBA_LINE_INPUTS_WATCHED_CONTROLLER }, { token: NGT_OBJECT_INPUTS_WATCHED_CONTROLLER }, { token: i0.NgZone }], target: i0.ɵɵFactoryTarget.Component });
NgtSobaLine.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "13.1.1", type: NgtSobaLine, selector: "ngt-soba-line[points]", inputs: { points: "points" }, outputs: { ready: "ready" }, providers: [
        NGT_SOBA_LINE_INPUTS_CONTROLLER_PROVIDER,
        NGT_OBJECT_INPUTS_CONTROLLER_PROVIDER,
    ], usesInheritance: true, ngImport: i0, template: `
    <ngt-primitive
      [object]="line"
      [object3dInputsController]="objectInputsController"
    ></ngt-primitive>
  `, isInline: true, directives: [{ type: i1.NgtObject3dController, selector: "    ngt-primitive,    ngt-bone,    ngt-group,    ngt-lod,    ngt-points,    ngt-mesh,    ngt-instanced-mesh,    ngt-skinned-mesh,    ngt-audio,    ngt-positional-audio,    ngt-line,    ngt-line-loop,    ngt-line-segments,    ngt-light-probe,    ngt-ambient-light,    ngt-ambient-light-probe,    ngt-hemisphere-light,    ngt-hemisphere-light-probe,    ngt-directional-light,    ngt-point-light,    ngt-spot-light,    ngt-rect-area-light,    ngt-arrow-helper,    ngt-axes-helper,    ngt-box3-helper,    ngt-grid-helper,    ngt-plane-helper,    ngt-polar-grid-helper,    ngt-sprite,    ngt-camera,    ngt-perspective-camera,    ngt-orthographic-camera,    ngt-array-camera,    ngt-stereo-camera,    ngt-cube-camera  ", exportAs: ["ngtObject3dController"] }, { type: i1.NgtObject3dInputsController, selector: "    ngt-primitive,    ngt-bone,    ngt-group,    ngt-lod,    ngt-points,    ngt-mesh,    ngt-instanced-mesh,    ngt-skinned-mesh,    ngt-audio,    ngt-positional-audio,    ngt-line,    ngt-line-loop,    ngt-line-segments,    ngt-light-probe,    ngt-ambient-light,    ngt-ambient-light-probe,    ngt-hemisphere-light,    ngt-hemisphere-light-probe,    ngt-directional-light,    ngt-point-light,    ngt-spot-light,    ngt-rect-area-light,    ngt-arrow-helper,    ngt-axes-helper,    ngt-box3-helper,    ngt-grid-helper,    ngt-plane-helper,    ngt-polar-grid-helper,    ngt-sprite,    ngt-camera,    ngt-perspective-camera,    ngt-orthographic-camera,    ngt-array-camera,    ngt-stereo-camera,    ngt-cube-camera,    ngt-soba-plane,    ngt-soba-box,    ngt-soba-cylinder,    ngt-soba-cone,    ngt-soba-circle,    ngt-soba-sphere,    ngt-soba-tube,    ngt-soba-torus,    ngt-soba-tetrahedron,    ngt-soba-ring,    ngt-soba-polyhedron,    ngt-soba-octahedron,    ngt-soba-dodecahedron,    ngt-soba-icosahedron,    ngt-soba-extrude,    ngt-soba-lathe,    ngt-soba-torus-knot,    ngt-soba-billboard,    ngt-soba-detailed,    ngt-soba-line,    ngt-soba-quadratic-bezier-line,    ngt-soba-cubic-bezier-line,    ngt-soba-orthographic-camera,    ngt-soba-gizmo-helper,    ngt-soba-gizmo-viewport,    ngt-soba-gizmo-axis-head,    ngt-soba-text  ", inputs: ["name", "position", "rotation", "quaternion", "scale", "color", "userData", "castShadow", "receiveShadow", "visible", "matrixAutoUpdate", "dispose", "raycast", "appendMode", "appendTo", "object3dInputsController"], outputs: ["click", "contextmenu", "dblclick", "pointerup", "pointerdown", "pointerover", "pointerout", "pointerenter", "pointerleave", "pointermove", "pointermissed", "pointercancel", "wheel"], exportAs: ["ngtObject3dInputsController"] }, { type: i2.NgtPrimitive, selector: "ngt-primitive[object]", inputs: ["object"], outputs: ["ready"], exportAs: ["ngtPrimitive"] }], changeDetection: i0.ChangeDetectionStrategy.OnPush });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.1.1", ngImport: i0, type: NgtSobaLine, decorators: [{
            type: Component,
            args: [{
                    selector: 'ngt-soba-line[points]',
                    template: `
    <ngt-primitive
      [object]="line"
      [object3dInputsController]="objectInputsController"
    ></ngt-primitive>
  `,
                    changeDetection: ChangeDetectionStrategy.OnPush,
                    providers: [
                        NGT_SOBA_LINE_INPUTS_CONTROLLER_PROVIDER,
                        NGT_OBJECT_INPUTS_CONTROLLER_PROVIDER,
                    ],
                }]
        }], ctorParameters: function () { return [{ type: NgtSobaLineInputsController, decorators: [{
                    type: Inject,
                    args: [NGT_SOBA_LINE_INPUTS_WATCHED_CONTROLLER]
                }] }, { type: i1.NgtObject3dInputsController, decorators: [{
                    type: Inject,
                    args: [NGT_OBJECT_INPUTS_WATCHED_CONTROLLER]
                }] }, { type: i0.NgZone }]; }, propDecorators: { points: [{
                type: Input
            }], ready: [{
                type: Output
            }] } });
export class NgtSobaLineModule {
}
NgtSobaLineModule.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.1.1", ngImport: i0, type: NgtSobaLineModule, deps: [], target: i0.ɵɵFactoryTarget.NgModule });
NgtSobaLineModule.ɵmod = i0.ɵɵngDeclareNgModule({ minVersion: "12.0.0", version: "13.1.1", ngImport: i0, type: NgtSobaLineModule, declarations: [NgtSobaLine, NgtSobaLineInputsController], imports: [NgtPrimitiveModule], exports: [NgtSobaLine, NgtSobaLineInputsController, NgtObject3dInputsControllerModule] });
NgtSobaLineModule.ɵinj = i0.ɵɵngDeclareInjector({ minVersion: "12.0.0", version: "13.1.1", ngImport: i0, type: NgtSobaLineModule, imports: [[NgtPrimitiveModule], NgtObject3dInputsControllerModule] });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.1.1", ngImport: i0, type: NgtSobaLineModule, decorators: [{
            type: NgModule,
            args: [{
                    declarations: [NgtSobaLine, NgtSobaLineInputsController],
                    exports: [
                        NgtSobaLine,
                        NgtSobaLineInputsController,
                        NgtObject3dInputsControllerModule,
                    ],
                    imports: [NgtPrimitiveModule],
                }]
        }] });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGluZS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9wYWNrYWdlcy9zb2JhL2Fic3RyYWN0aW9ucy9zcmMvbGluZS9saW5lLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLE9BQU8sRUFDTCxVQUFVLEVBQ1YsK0JBQStCLEVBQy9CLGVBQWUsRUFDZixxQ0FBcUMsRUFDckMsb0NBQW9DLEVBRXBDLDJCQUEyQixFQUMzQixpQ0FBaUMsR0FFbEMsTUFBTSxxQkFBcUIsQ0FBQztBQUM3QixPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSwrQkFBK0IsQ0FBQztBQUNuRSxPQUFPLEVBQ0wsdUJBQXVCLEVBQ3ZCLFNBQVMsRUFDVCxTQUFTLEVBQ1QsTUFBTSxFQUNOLEtBQUssRUFDTCxRQUFRLEVBQ1IsTUFBTSxFQUVOLE1BQU0sR0FDUCxNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDaEQsT0FBTyxFQUFFLGFBQWEsRUFBRSxvQkFBb0IsRUFBRSxHQUFHLEVBQUUsU0FBUyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQzNFLE9BQU8sS0FBSyxLQUFLLE1BQU0sT0FBTyxDQUFDO0FBQy9CLE9BQU8sRUFDTCxLQUFLLEVBQ0wsWUFBWSxFQUNaLFlBQVksR0FFYixNQUFNLGNBQWMsQ0FBQzs7OztBQU90QixNQUFNLE9BQU8sMkJBQTRCLFNBQVEsVUFBVTtJQUwzRDs7UUFNVyxVQUFLLEdBQWEsT0FBTyxDQUFDO1FBSTFCLGVBQVUsR0FHZixFQUFFLENBQUM7S0FXUjtJQVBDLElBQUksVUFBVTtRQUNaLE9BQU8sSUFBSSxDQUFDLHdCQUF3QixDQUFDO0lBQ3ZDLENBQUM7SUFFRCxJQUFJLEtBQUs7UUFDUCxPQUFPLENBQUMsT0FBTyxFQUFFLGNBQWMsRUFBRSxXQUFXLEVBQUUsUUFBUSxFQUFFLFlBQVksQ0FBQyxDQUFDO0lB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QWlDO3FCQUNsQztvQkFDRCxPQUFPLEVBQUUsQ0FBQyxrQkFBa0IsQ0FBQztpQkFDOUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBDb250cm9sbGVyLFxuICBjcmVhdGVDb250cm9sbGVyUHJvdmlkZXJGYWN0b3J5LFxuICBFbmhhbmNlZFJ4U3RhdGUsXG4gIE5HVF9PQkpFQ1RfSU5QVVRTX0NPTlRST0xMRVJfUFJPVklERVIsXG4gIE5HVF9PQkpFQ1RfSU5QVVRTX1dBVENIRURfQ09OVFJPTExFUixcbiAgTmd0Q29sb3IsXG4gIE5ndE9iamVjdDNkSW5wdXRzQ29udHJvbGxlcixcbiAgTmd0T2JqZWN0M2RJbnB1dHNDb250cm9sbGVyTW9kdWxlLFxuICBOZ3RWZWN0b3IzLFxufSBmcm9tICdAYW5ndWxhci10aHJlZS9jb3JlJztcbmltcG9ydCB7IE5ndFByaW1pdGl2ZU1vZHVsZSB9IGZyb20gJ0Bhbmd1bGFyLXRocmVlL2NvcmUvcHJpbWl0aXZlJztcbmltcG9ydCB7XG4gIENoYW5nZURldGVjdGlvblN0cmF0ZWd5LFxuICBDb21wb25lbnQsXG4gIERpcmVjdGl2ZSxcbiAgSW5qZWN0LFxuICBJbnB1dCxcbiAgTmdNb2R1bGUsXG4gIE5nWm9uZSxcbiAgT25Jbml0LFxuICBPdXRwdXQsXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgc2VsZWN0U2xpY2UgfSBmcm9tICdAcngtYW5ndWxhci9zdGF0ZSc7XG5pbXBvcnQgeyBjb21iaW5lTGF0ZXN0LCBkaXN0aW5jdFVudGlsQ2hhbmdlZCwgbWFwLCBzdGFydFdpdGggfSBmcm9tICdyeGpzJztcbmltcG9ydCAqIGFzIFRIUkVFIGZyb20gJ3RocmVlJztcbmltcG9ydCB7XG4gIExpbmUyLFxuICBMaW5lR2VvbWV0cnksXG4gIExpbmVNYXRlcmlhbCxcbiAgTGluZU1hdGVyaWFsUGFyYW1ldGVycyxcbn0gZnJvbSAndGhyZWUtc3RkbGliJztcblxuQERpcmVjdGl2ZSh7XG4gIHNlbGVjdG9yOlxuICAgICduZ3Qtc29iYS1saW5lLG5ndC1zb2JhLXF1YWRyYXRpYy1iZXppZXItbGluZSxuZ3Qtc29iYS1jdWJpYy1iZXppZXItbGluZScsXG4gIGV4cG9ydEFzOiAnbmd0U29iYUxpbmVJbnB1dHNDb250cm9sbGVyJyxcbn0pXG5leHBvcnQgY2xhc3MgTmd0U29iYUxpbmVJbnB1dHNDb250cm9sbGVyIGV4dGVuZHMgQ29udHJvbGxlciB7XG4gIEBJbnB1dCgpIGNvbG9yOiBOZ3RDb2xvciA9ICdibGFjayc7XG4gIEBJbnB1dCgpIHZlcnRleENvbG9ycz86IEFycmF5PE5ndENvbG9yPjtcbiAgQElucHV0KCkgbGluZVdpZHRoPzogTGluZU1hdGVyaWFsUGFyYW1ldGVyc1snbGluZXdpZHRoJ107XG4gIEBJbnB1dCgpIGRhc2hlZD86IExpbmVNYXRlcmlhbFBhcmFtZXRlcnNbJ2Rhc2hlZCddO1xuICBASW5wdXQoKSBwYXJhbWV0ZXJzPzogT21pdDxcbiAgICBMaW5lTWF0ZXJpYWxQYXJhbWV0ZXJzLFxuICAgICd2ZXJ0ZXhDb2xvcnMnIHwgJ2NvbG9yJyB8ICdsaW5ld2lkdGgnIHwgJ2Rhc2hlZCcgfCAncmVzb2x1dGlvbidcbiAgPiA9IHt9O1xuXG4gIEBJbnB1dCgpIHNvYmFMaW5lSW5wdXRzQ29udHJvbGxlcj86IE5ndFNvYmFMaW5lSW5wdXRzQ29udHJvbGxlcjtcblxuICBnZXQgY29udHJvbGxlcigpOiBDb250cm9sbGVyIHwgdW5kZWZpbmVkIHtcbiAgICByZXR1cm4gdGhpcy5zb2JhTGluZUlucHV0c0NvbnRyb2xsZXI7XG4gIH1cblxuICBnZXQgcHJvcHMoKTogc3RyaW5nW10ge1xuICAgIHJldHVybiBbJ2NvbG9yJywgJ3ZlcnRleENvbG9ycycsICdsaW5lV2lkdGgnLCAnZGFzaGVkJywgJ3BhcmFtZXRlcnMnXTtcbiAgfVxufVxuXG5leHBvcnQgY29uc3QgW1xuICBOR1RfU09CQV9MSU5FX0lOUFVUU19XQVRDSEVEX0NPTlRST0xMRVIsXG4gIE5HVF9TT0JBX0xJTkVfSU5QVVRTX0NPTlRST0xMRVJfUFJPVklERVIsXG5dID0gY3JlYXRlQ29udHJvbGxlclByb3ZpZGVyRmFjdG9yeSh7XG4gIHdhdGNoZWRDb250cm9sbGVyVG9rZW5OYW1lOiAnV2F0Y2hlZCBTb2JhTGluZSBJbnB1dHMgQ29udHJvbGxlcicsXG4gIGNvbnRyb2xsZXI6IE5ndFNvYmFMaW5lSW5wdXRzQ29udHJvbGxlcixcbn0pO1xuXG5leHBvcnQgaW50ZXJmYWNlIE5ndFNvYmFMaW5lU3RhdGUge1xuICBwb2ludHM6IE5ndFZlY3RvcjNbXTtcbiAgbGluZTogTGluZTI7XG4gIGxpbmVNYXRlcmlhbDogTGluZU1hdGVyaWFsO1xuICBsaW5lR2VvbWV0cnk6IExpbmVHZW9tZXRyeTtcbn1cblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnbmd0LXNvYmEtbGluZVtwb2ludHNdJyxcbiAgdGVtcGxhdGU6IGBcbiAgICA8bmd0LXByaW1pdGl2ZVxuICAgICAgW29iamVjdF09XCJsaW5lXCJcbiAgICAgIFtvYmplY3QzZElucHV0c0NvbnRyb2xsZXJdPVwib2JqZWN0SW5wdXRzQ29udHJvbGxlclwiXG4gICAgPjwvbmd0LXByaW1pdGl2ZT5cbiAgYCxcbiAgY2hhbmdlRGV0ZWN0aW9uOiBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneS5PblB1c2gsXG4gIHByb3ZpZGVyczogW1xuICAgIE5HVF9TT0JBX0xJTkVfSU5QVVRTX0NPTlRST0xMRVJfUFJPVklERVIsXG4gICAgTkdUX09CSkVDVF9JTlBVVFNfQ09OVFJPTExFUl9QUk9WSURFUixcbiAgXSxcbn0pXG5leHBvcnQgY2xhc3MgTmd0U29iYUxpbmVcbiAgZXh0ZW5kcyBFbmhhbmNlZFJ4U3RhdGU8Tmd0U29iYUxpbmVTdGF0ZT5cbiAgaW1wbGVtZW50cyBPbkluaXRcbntcbiAgQElucHV0KCkgc2V0IHBvaW50cyhwb2ludHM6IE5ndFZlY3RvcjNbXSkge1xuICAgIHRoaXMuc2V0KHsgcG9pbnRzIH0pO1xuICB9XG5cbiAgI3Jlc29sdXRpb24gPSBuZXcgVEhSRUUuVmVjdG9yMig1MTIsIDUxMik7XG4gICNzb2JhTGluZUlucHV0c0NvbnRyb2xsZXIhOiBOZ3RTb2JhTGluZUlucHV0c0NvbnRyb2xsZXI7XG5cbiAgQE91dHB1dCgpIHJlYWR5ID0gdGhpcy5zZWxlY3QoJ2xpbmUnKTtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBASW5qZWN0KE5HVF9TT0JBX0xJTkVfSU5QVVRTX1dBVENIRURfQ09OVFJPTExFUilcbiAgICBwcml2YXRlIHNvYmFMaW5lSW5wdXRzQ29udHJvbGxlcjogTmd0U29iYUxpbmVJbnB1dHNDb250cm9sbGVyLFxuICAgIEBJbmplY3QoTkdUX09CSkVDVF9JTlBVVFNfV0FUQ0hFRF9DT05UUk9MTEVSKVxuICAgIHB1YmxpYyBvYmplY3RJbnB1dHNDb250cm9sbGVyOiBOZ3RPYmplY3QzZElucHV0c0NvbnRyb2xsZXIsXG4gICAgcHJpdmF0ZSBuZ1pvbmU6IE5nWm9uZVxuICApIHtcbiAgICBzdXBlcigpO1xuICB9XG5cbiAgbmdPbkluaXQoKSB7XG4gICAgdGhpcy4jc29iYUxpbmVJbnB1dHNDb250cm9sbGVyID1cbiAgICAgIHRoaXMuc29iYUxpbmVJbnB1dHNDb250cm9sbGVyLnNvYmFMaW5lSW5wdXRzQ29udHJvbGxlciB8fFxuICAgICAgdGhpcy5zb2JhTGluZUlucHV0c0NvbnRyb2xsZXI7XG5cbiAgICB0aGlzLnNldCh7XG4gICAgICBsaW5lTWF0ZXJpYWw6IG5ldyBMaW5lTWF0ZXJpYWwoKSxcbiAgICB9KTtcblxuICAgIGNvbnN0IGdlb21ldHJ5Q2hhbmdlcyQgPSBjb21iaW5lTGF0ZXN0KFtcbiAgICAgIHRoaXMuc2VsZWN0KCdwb2ludHMnKSxcbiAgICAgIHRoaXMuI3NvYmFMaW5lSW5wdXRzQ29udHJvbGxlci5jaGFuZ2UkLnBpcGUoXG4gICAgICAgIG1hcCgoKSA9PiB0aGlzLiNzb2JhTGluZUlucHV0c0NvbnRyb2xsZXIudmVydGV4Q29sb3JzKSxcbiAgICAgICAgZGlzdGluY3RVbnRpbENoYW5nZWQoKSxcbiAgICAgICAgc3RhcnRXaXRoKHVuZGVmaW5lZClcbiAgICAgICksXG4gICAgXSk7XG5cbiAgICBjb25zdCBtYXRlcmlhbENoYW5nZXMkID0gY29tYmluZUxhdGVzdChbXG4gICAgICB0aGlzLnNlbGVjdCgnbGluZU1hdGVyaWFsJyksXG4gICAgICB0aGlzLiNzb2JhTGluZUlucHV0c0NvbnRyb2xsZXIuY2hhbmdlJC5waXBlKFxuICAgICAgICBtYXAoKGNoYW5nZXMpID0+IHtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgY29sb3I6IChjaGFuZ2VzLnNvYmFMaW5lSW5wdXRzQ29udHJvbGxlclxuICAgICAgICAgICAgICA/IGNoYW5nZXMuc29iYUxpbmVJbnB1dHNDb250cm9sbGVyLmN1cnJlbnRWYWx1ZVxuICAgICAgICAgICAgICA6IHRoaXMuI3NvYmFMaW5lSW5wdXRzQ29udHJvbGxlclxuICAgICAgICAgICAgKS5jb2xvcixcbiAgICAgICAgICAgIHZlcnRleENvbG9yczogQm9vbGVhbihcbiAgICAgICAgICAgICAgKGNoYW5nZXMuc29iYUxpbmVJbnB1dHNDb250cm9sbGVyXG4gICAgICAgICAgICAgICAgPyBjaGFuZ2VzLnNvYmFMaW5lSW5wdXRzQ29udHJvbGxlci5jdXJyZW50VmFsdWVcbiAgICAgICAgICAgICAgICA6IHRoaXMuI3NvYmFMaW5lSW5wdXRzQ29udHJvbGxlclxuICAgICAgICAgICAgICApLnZlcnRleENvbG9yc1xuICAgICAgICAgICAgKSxcbiAgICAgICAgICAgIGxpbmV3aWR0aDogKGNoYW5nZXMuc29iYUxpbmVJbnB1dHNDb250cm9sbGVyXG4gICAgICAgICAgICAgID8gY2hhbmdlcy5zb2JhTGluZUlucHV0c0NvbnRyb2xsZXIuY3VycmVudFZhbHVlXG4gICAgICAgICAgICAgIDogdGhpcy4jc29iYUxpbmVJbnB1dHNDb250cm9sbGVyXG4gICAgICAgICAgICApLmxpbmVXaWR0aCxcbiAgICAgICAgICAgIGRhc2hlZDogKGNoYW5nZXMuc29iYUxpbmVJbnB1dHNDb250cm9sbGVyXG4gICAgICAgICAgICAgID8gY2hhbmdlcy5zb2JhTGluZUlucHV0c0NvbnRyb2xsZXIuY3VycmVudFZhbHVlXG4gICAgICAgICAgICAgIDogdGhpcy4jc29iYUxpbmVJbnB1dHNDb250cm9sbGVyXG4gICAgICAgICAgICApLmRhc2hlZCxcbiAgICAgICAgICAgIHBhcmFtZXRlcnM6IChjaGFuZ2VzLnNvYmFMaW5lSW5wdXRzQ29udHJvbGxlclxuICAgICAgICAgICAgICA/IGNoYW5nZXMuc29iYUxpbmVJbnB1dHNDb250cm9sbGVyLmN1cnJlbnRWYWx1ZVxuICAgICAgICAgICAgICA6IHRoaXMuI3NvYmFMaW5lSW5wdXRzQ29udHJvbGxlclxuICAgICAgICAgICAgKS5wYXJhbWV0ZXJzLFxuICAgICAgICAgIH07XG4gICAgICAgIH0pLFxuICAgICAgICBzdGFydFdpdGgoe1xuICAgICAgICAgIGNvbG9yOiB0aGlzLiNzb2JhTGluZUlucHV0c0NvbnRyb2xsZXIuY29sb3IsXG4gICAgICAgICAgdmVydGV4Q29sb3JzOiBCb29sZWFuKHRoaXMuI3NvYmFMaW5lSW5wdXRzQ29udHJvbGxlci52ZXJ0ZXhDb2xvcnMpLFxuICAgICAgICAgIGxpbmV3aWR0aDogdGhpcy4jc29iYUxpbmVJbnB1dHNDb250cm9sbGVyLmxpbmVXaWR0aCxcbiAgICAgICAgICBkYXNoZWQ6IHRoaXMuI3NvYmFMaW5lSW5wdXRzQ29udHJvbGxlci5kYXNoZWQsXG4gICAgICAgICAgcGFyYW1ldGVyczogdGhpcy4jc29iYUxpbmVJbnB1dHNDb250cm9sbGVyLnBhcmFtZXRlcnMsXG4gICAgICAgIH0pXG4gICAgICApLFxuICAgIF0pO1xuXG4gICAgdGhpcy5ob2xkKHRoaXMuc2VsZWN0KHNlbGVjdFNsaWNlKFsnbGluZScsICdwb2ludHMnXSkpLCAoeyBsaW5lIH0pID0+IHtcbiAgICAgIGxpbmUuY29tcHV0ZUxpbmVEaXN0YW5jZXMoKTtcbiAgICB9KTtcblxuICAgIHRoaXMuaG9sZChcbiAgICAgIG1hdGVyaWFsQ2hhbmdlcyQsXG4gICAgICAoW1xuICAgICAgICBsaW5lTWF0ZXJpYWwsXG4gICAgICAgIHsgZGFzaGVkLCBwYXJhbWV0ZXJzLCB2ZXJ0ZXhDb2xvcnMsIGNvbG9yLCBsaW5ld2lkdGggfSxcbiAgICAgIF0pID0+IHtcbiAgICAgICAgY29uc3QgbGluZVBhcmFtZXRlcnMgPSB7XG4gICAgICAgICAgdmVydGV4Q29sb3JzLFxuICAgICAgICAgIGNvbG9yLFxuICAgICAgICAgIHJlc29sdXRpb246IHRoaXMuI3Jlc29sdXRpb24sXG4gICAgICAgICAgLi4ucGFyYW1ldGVycyxcbiAgICAgICAgfSBhcyBMaW5lTWF0ZXJpYWxQYXJhbWV0ZXJzO1xuXG4gICAgICAgIGlmIChkYXNoZWQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgIGxpbmVQYXJhbWV0ZXJzLmRhc2hlZCA9IGRhc2hlZDtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChsaW5ld2lkdGggIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgIGxpbmVQYXJhbWV0ZXJzLmxpbmV3aWR0aCA9IGxpbmV3aWR0aDtcbiAgICAgICAgfVxuXG4gICAgICAgIGxpbmVNYXRlcmlhbC5zZXRWYWx1ZXMobGluZVBhcmFtZXRlcnMpO1xuXG4gICAgICAgIGlmIChkYXNoZWQpIHtcbiAgICAgICAgICBsaW5lTWF0ZXJpYWwuZGVmaW5lcy5VU0VfREFTSCA9ICcnO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIFNldHRpbmcgbGluZU1hdGVyaWFsLmRlZmluZXMuVVNFX0RBU0ggdG8gdW5kZWZpbmVkIGlzIGFwcGFyZW50bHkgbm90IHN1ZmZpY2llbnQuXG4gICAgICAgICAgZGVsZXRlIGxpbmVNYXRlcmlhbC5kZWZpbmVzLlVTRV9EQVNIO1xuICAgICAgICB9XG5cbiAgICAgICAgbGluZU1hdGVyaWFsLm5lZWRzVXBkYXRlID0gdHJ1ZTtcbiAgICAgIH1cbiAgICApO1xuXG4gICAgdGhpcy5jb25uZWN0KFxuICAgICAgJ2xpbmVHZW9tZXRyeScsXG4gICAgICBnZW9tZXRyeUNoYW5nZXMkLFxuICAgICAgKF8sIFtwb2ludHMsIHZlcnRleENvbG9yc10pID0+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMubmdab25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IHtcbiAgICAgICAgICBjb25zdCBsaW5lR2VvbWV0cnkgPSBuZXcgTGluZUdlb21ldHJ5KCk7XG4gICAgICAgICAgY29uc3QgcFZhbHVlcyA9IHBvaW50cy5tYXAoKHApID0+XG4gICAgICAgICAgICBwIGluc3RhbmNlb2YgVEhSRUUuVmVjdG9yMyA/IHAudG9BcnJheSgpIDogcFxuICAgICAgICAgICk7XG4gICAgICAgICAgbGluZUdlb21ldHJ5LnNldFBvc2l0aW9ucygocFZhbHVlcyBhcyBhbnkpLmZsYXQoKSk7XG5cbiAgICAgICAgICBpZiAodmVydGV4Q29sb3JzKSB7XG4gICAgICAgICAgICBjb25zdCBjVmFsdWVzID0gKHZlcnRleENvbG9ycyBhcyBOZ3RDb2xvcltdKS5tYXAoKGMpID0+XG4gICAgICAgICAgICAgIGMgaW5zdGFuY2VvZiBUSFJFRS5Db2xvciA/IGMudG9BcnJheSgpIDogY1xuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIGxpbmVHZW9tZXRyeS5zZXRDb2xvcnMoKGNWYWx1ZXMgYXMgYW55KS5mbGF0KCkpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHJldHVybiBsaW5lR2VvbWV0cnk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICk7XG5cbiAgICB0aGlzLmhvbGRFZmZlY3QodGhpcy5zZWxlY3QoJ2xpbmVHZW9tZXRyeScpLCAobGluZUdlb21ldHJ5KSA9PiB7XG4gICAgICByZXR1cm4gKCkgPT4ge1xuICAgICAgICBsaW5lR2VvbWV0cnkuZGlzcG9zZSgpO1xuICAgICAgfTtcbiAgICB9KTtcblxuICAgIHRoaXMuaG9sZEVmZmVjdCh0aGlzLnNlbGVjdCgnbGluZU1hdGVyaWFsJyksIChsaW5lTWF0ZXJpYWwpID0+IHtcbiAgICAgIHJldHVybiAoKSA9PiB7XG4gICAgICAgIGxpbmVNYXRlcmlhbC5kaXNwb3NlKCk7XG4gICAgICB9O1xuICAgIH0pO1xuXG4gICAgdGhpcy5ob2xkKFxuICAgICAgdGhpcy5zZWxlY3Qoc2VsZWN0U2xpY2UoWydsaW5lR2VvbWV0cnknLCAnbGluZU1hdGVyaWFsJ10pKSxcbiAgICAgICh7IGxpbmVNYXRlcmlhbCwgbGluZUdlb21ldHJ5IH0pID0+IHtcbiAgICAgICAgY29uc3QgbGluZSA9IHRoaXMuZ2V0KCdsaW5lJyk7XG4gICAgICAgIGlmICghbGluZSkge1xuICAgICAgICAgIHRoaXMuc2V0KHsgbGluZTogbmV3IExpbmUyKGxpbmVHZW9tZXRyeSwgbGluZU1hdGVyaWFsKSB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBsaW5lLmdlb21ldHJ5ID0gbGluZUdlb21ldHJ5O1xuICAgICAgICAgIGxpbmUuY29tcHV0ZUxpbmVEaXN0YW5jZXMoKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICk7XG4gIH1cblxuICBnZXQgbGluZSgpIHtcbiAgICByZXR1cm4gdGhpcy5nZXQoJ2xpbmUnKTtcbiAgfVxufVxuXG5ATmdNb2R1bGUoe1xuICBkZWNsYXJhdGlvbnM6IFtOZ3RTb2JhTGluZSwgTmd0U29iYUxpbmVJbnB1dHNDb250cm9sbGVyXSxcbiAgZXhwb3J0czogW1xuICAgIE5ndFNvYmFMaW5lLFxuICAgIE5ndFNvYmFMaW5lSW5wdXRzQ29udHJvbGxlcixcbiAgICBOZ3RPYmplY3QzZElucHV0c0NvbnRyb2xsZXJNb2R1bGUsXG4gIF0sXG4gIGltcG9ydHM6IFtOZ3RQcmltaXRpdmVNb2R1bGVdLFxufSlcbmV4cG9ydCBjbGFzcyBOZ3RTb2JhTGluZU1vZHVsZSB7fVxuIl19