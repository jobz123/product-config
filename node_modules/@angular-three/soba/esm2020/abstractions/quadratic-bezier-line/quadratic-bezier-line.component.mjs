var _NgtSobaQuadraticBezierLine_instances, _NgtSobaQuadraticBezierLine_getPoints;
import { __classPrivateFieldGet } from "tslib";
import { EnhancedRxState, NGT_OBJECT_INPUTS_CONTROLLER_PROVIDER, NGT_OBJECT_INPUTS_WATCHED_CONTROLLER, NgtObject3dInputsController, NgtObject3dInputsControllerModule, } from '@angular-three/core';
import { CommonModule } from '@angular/common';
import { ChangeDetectionStrategy, Component, Inject, Input, NgModule, } from '@angular/core';
import { selectSlice } from '@rx-angular/state';
import * as THREE from 'three';
import { NGT_SOBA_LINE_INPUTS_CONTROLLER_PROVIDER, NGT_SOBA_LINE_INPUTS_WATCHED_CONTROLLER, NgtSobaLineInputsController, NgtSobaLineModule, } from '../line/line.component';
import * as i0 from "@angular/core";
import * as i1 from "../line/line.component";
import * as i2 from "@angular/common";
import * as i3 from "@angular-three/core";
export class NgtSobaQuadraticBezierLine extends EnhancedRxState {
    constructor(sobaLineInputsController, objectInputsController) {
        super();
        this.sobaLineInputsController = sobaLineInputsController;
        this.objectInputsController = objectInputsController;
        _NgtSobaQuadraticBezierLine_instances.add(this);
        this.v = new THREE.Vector3();
        this.set({
            start: [0, 0, 0],
            end: [0, 0, 0],
            segments: 20,
            mid: null,
            curve: new THREE.QuadraticBezierCurve3(undefined, undefined, undefined),
        });
        this.connect('points', this.select(selectSlice(['start', 'end', 'mid', 'segments'])), (_, { segments, mid, end, start }) => __classPrivateFieldGet(this, _NgtSobaQuadraticBezierLine_instances, "m", _NgtSobaQuadraticBezierLine_getPoints).call(this, start, end, mid, segments));
    }
    set start(start) {
        this.set({ start });
    }
    set end(end) {
        this.set({ end });
    }
    set mid(mid) {
        this.set({ mid });
    }
    set segments(segments) {
        this.set({ segments });
    }
    get points() {
        return this.get('points');
    }
    onLineReady(line) {
        line.setPoints = (start, end, mid) => {
            const points = __classPrivateFieldGet(this, _NgtSobaQuadraticBezierLine_instances, "m", _NgtSobaQuadraticBezierLine_getPoints).call(this, start, end, mid);
            if (line.geometry) {
                // @ts-ignore
                line.geometry.setPositions(points.map((p) => p.toArray()).flat());
            }
        };
    }
}
_NgtSobaQuadraticBezierLine_instances = new WeakSet(), _NgtSobaQuadraticBezierLine_getPoints = function _NgtSobaQuadraticBezierLine_getPoints(start, end, mid, segments = 20) {
    const curve = this.get('curve');
    if (start instanceof THREE.Vector3)
        curve.v0.copy(start);
    else
        curve.v0.set(...start);
    if (end instanceof THREE.Vector3)
        curve.v2.copy(end);
    else
        curve.v2.set(...end);
    if (mid instanceof THREE.Vector3) {
        curve.v1.copy(mid);
    }
    else {
        curve.v1.copy(curve.v0
            .clone()
            .add(curve.v2.clone().sub(curve.v0))
            .add(this.v.set(0, curve.v0.y - curve.v2.y, 0)));
    }
    return curve.getPoints(segments);
};
NgtSobaQuadraticBezierLine.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.1.1", ngImport: i0, type: NgtSobaQuadraticBezierLine, deps: [{ token: NGT_SOBA_LINE_INPUTS_WATCHED_CONTROLLER }, { token: NGT_OBJECT_INPUTS_WATCHED_CONTROLLER }], target: i0.ɵɵFactoryTarget.Component });
NgtSobaQuadraticBezierLine.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "13.1.1", type: NgtSobaQuadraticBezierLine, selector: "ngt-soba-quadratic-bezier-line[start][end]", inputs: { start: "start", end: "end", mid: "mid", segments: "segments" }, providers: [
        NGT_SOBA_LINE_INPUTS_CONTROLLER_PROVIDER,
        NGT_OBJECT_INPUTS_CONTROLLER_PROVIDER,
    ], usesInheritance: true, ngImport: i0, template: `
    <ngt-soba-line
      *ngIf="points"
      (ready)="onLineReady($any($event))"
      [points]="points"
      [sobaLineInputsController]="sobaLineInputsController"
      [object3dInputsController]="objectInputsController"
    ></ngt-soba-line>
  `, isInline: true, components: [{ type: i1.NgtSobaLine, selector: "ngt-soba-line[points]", inputs: ["points"], outputs: ["ready"] }], directives: [{ type: i2.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { type: i1.NgtSobaLineInputsController, selector: "ngt-soba-line,ngt-soba-quadratic-bezier-line,ngt-soba-cubic-bezier-line", inputs: ["color", "vertexColors", "lineWidth", "dashed", "parameters", "sobaLineInputsController"], exportAs: ["ngtSobaLineInputsController"] }, { type: i3.NgtObject3dInputsController, selector: "    ngt-primitive,    ngt-bone,    ngt-group,    ngt-lod,    ngt-points,    ngt-mesh,    ngt-instanced-mesh,    ngt-skinned-mesh,    ngt-audio,    ngt-positional-audio,    ngt-line,    ngt-line-loop,    ngt-line-segments,    ngt-light-probe,    ngt-ambient-light,    ngt-ambient-light-probe,    ngt-hemisphere-light,    ngt-hemisphere-light-probe,    ngt-directional-light,    ngt-point-light,    ngt-spot-light,    ngt-rect-area-light,    ngt-arrow-helper,    ngt-axes-helper,    ngt-box3-helper,    ngt-grid-helper,    ngt-plane-helper,    ngt-polar-grid-helper,    ngt-sprite,    ngt-camera,    ngt-perspective-camera,    ngt-orthographic-camera,    ngt-array-camera,    ngt-stereo-camera,    ngt-cube-camera,    ngt-soba-plane,    ngt-soba-box,    ngt-soba-cylinder,    ngt-soba-cone,    ngt-soba-circle,    ngt-soba-sphere,    ngt-soba-tube,    ngt-soba-torus,    ngt-soba-tetrahedron,    ngt-soba-ring,    ngt-soba-polyhedron,    ngt-soba-octahedron,    ngt-soba-dodecahedron,    ngt-soba-icosahedron,    ngt-soba-extrude,    ngt-soba-lathe,    ngt-soba-torus-knot,    ngt-soba-billboard,    ngt-soba-detailed,    ngt-soba-line,    ngt-soba-quadratic-bezier-line,    ngt-soba-cubic-bezier-line,    ngt-soba-orthographic-camera,    ngt-soba-gizmo-helper,    ngt-soba-gizmo-viewport,    ngt-soba-gizmo-axis-head,    ngt-soba-text  ", inputs: ["name", "position", "rotation", "quaternion", "scale", "color", "userData", "castShadow", "receiveShadow", "visible", "matrixAutoUpdate", "dispose", "raycast", "appendMode", "appendTo", "object3dInputsController"], outputs: ["click", "contextmenu", "dblclick", "pointerup", "pointerdown", "pointerover", "pointerout", "pointerenter", "pointerleave", "pointermove", "pointermissed", "pointercancel", "wheel"], exportAs: ["ngtObject3dInputsController"] }], changeDetection: i0.ChangeDetectionStrategy.OnPush });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.1.1", ngImport: i0, type: NgtSobaQuadraticBezierLine, decorators: [{
            type: Component,
            args: [{
                    selector: 'ngt-soba-quadratic-bezier-line[start][end]',
                    template: `
    <ngt-soba-line
      *ngIf="points"
      (ready)="onLineReady($any($event))"
      [points]="points"
      [sobaLineInputsController]="sobaLineInputsController"
      [object3dInputsController]="objectInputsController"
    ></ngt-soba-line>
  `,
                    changeDetection: ChangeDetectionStrategy.OnPush,
                    providers: [
                        NGT_SOBA_LINE_INPUTS_CONTROLLER_PROVIDER,
                        NGT_OBJECT_INPUTS_CONTROLLER_PROVIDER,
                    ],
                }]
        }], ctorParameters: function () { return [{ type: i1.NgtSobaLineInputsController, decorators: [{
                    type: Inject,
                    args: [NGT_SOBA_LINE_INPUTS_WATCHED_CONTROLLER]
                }] }, { type: i3.NgtObject3dInputsController, decorators: [{
                    type: Inject,
                    args: [NGT_OBJECT_INPUTS_WATCHED_CONTROLLER]
                }] }]; }, propDecorators: { start: [{
                type: Input
            }], end: [{
                type: Input
            }], mid: [{
                type: Input
            }], segments: [{
                type: Input
            }] } });
export class NgtSobaQuadraticBezierLineModule {
}
NgtSobaQuadraticBezierLineModule.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.1.1", ngImport: i0, type: NgtSobaQuadraticBezierLineModule, deps: [], target: i0.ɵɵFactoryTarget.NgModule });
NgtSobaQuadraticBezierLineModule.ɵmod = i0.ɵɵngDeclareNgModule({ minVersion: "12.0.0", version: "13.1.1", ngImport: i0, type: NgtSobaQuadraticBezierLineModule, declarations: [NgtSobaQuadraticBezierLine], imports: [NgtSobaLineModule, CommonModule], exports: [NgtSobaQuadraticBezierLine, NgtSobaLineModule,
        NgtObject3dInputsControllerModule] });
NgtSobaQuadraticBezierLineModule.ɵinj = i0.ɵɵngDeclareInjector({ minVersion: "12.0.0", version: "13.1.1", ngImport: i0, type: NgtSobaQuadraticBezierLineModule, imports: [[NgtSobaLineModule, CommonModule], NgtSobaLineModule,
        NgtObject3dInputsControllerModule] });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.1.1", ngImport: i0, type: NgtSobaQuadraticBezierLineModule, decorators: [{
            type: NgModule,
            args: [{
                    declarations: [NgtSobaQuadraticBezierLine],
                    exports: [
                        NgtSobaQuadraticBezierLine,
                        NgtSobaLineModule,
                        NgtObject3dInputsControllerModule,
                    ],
                    imports: [NgtSobaLineModule, CommonModule],
                }]
        }] });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicXVhZHJhdGljLWJlemllci1saW5lLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3BhY2thZ2VzL3NvYmEvYWJzdHJhY3Rpb25zL3NyYy9xdWFkcmF0aWMtYmV6aWVyLWxpbmUvcXVhZHJhdGljLWJlemllci1saW5lLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLE9BQU8sRUFDTCxlQUFlLEVBQ2YscUNBQXFDLEVBQ3JDLG9DQUFvQyxFQUNwQywyQkFBMkIsRUFDM0IsaUNBQWlDLEdBRWxDLE1BQU0scUJBQXFCLENBQUM7QUFDN0IsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQy9DLE9BQU8sRUFDTCx1QkFBdUIsRUFDdkIsU0FBUyxFQUNULE1BQU0sRUFDTixLQUFLLEVBQ0wsUUFBUSxHQUNULE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUNoRCxPQUFPLEtBQUssS0FBSyxNQUFNLE9BQU8sQ0FBQztBQUUvQixPQUFPLEVBQ0wsd0NBQXdDLEVBQ3hDLHVDQUF1QyxFQUN2QywyQkFBMkIsRUFDM0IsaUJBQWlCLEdBQ2xCLE1BQU0sd0JBQXdCLENBQUM7Ozs7O0FBNEJoQyxNQUFNLE9BQU8sMEJBQTJCLFNBQVEsZUFBZ0Q7SUF1QjlGLFlBRVMsd0JBQXFELEVBRXJELHNCQUFtRDtRQUUxRCxLQUFLLEVBQUUsQ0FBQztRQUpELDZCQUF3QixHQUF4Qix3QkFBd0IsQ0FBNkI7UUFFckQsMkJBQXNCLEdBQXRCLHNCQUFzQixDQUE2Qjs7UUFWNUQsTUFBQyxHQUFHLElBQUksS0FBSyxDQUFDLE9BQU8sRUFBRSxDQUFDO1FBYXRCLElBQUksQ0FBQyxHQUFHLENBQUM7WUFDUCxLQUFLLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUNoQixHQUFHLEVBQUUsQ0FB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QyxDQUFDLGlCQUFpQixFQUFFLFlBQVksQ0FBQyxFQUh4QyxpQkFBaUI7UUFDakIsaUNBQWlDOzJGQUl4QixnQ0FBZ0M7a0JBVDVDLFFBQVE7bUJBQUM7b0JBQ1IsWUFBWSxFQUFFLENBQUMsMEJBQTBCLENBQUM7b0JBQzFDLE9BQU8sRUFBRTt3QkFDUCwwQkFBMEI7d0JBQzFCLGlCQUFpQjt3QkFDakIsaUNBQWlDO3FCQUNsQztvQkFDRCxPQUFPLEVBQUUsQ0FBQyxpQkFBaUIsRUFBRSxZQUFZLENBQUM7aUJBQzNDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgRW5oYW5jZWRSeFN0YXRlLFxuICBOR1RfT0JKRUNUX0lOUFVUU19DT05UUk9MTEVSX1BST1ZJREVSLFxuICBOR1RfT0JKRUNUX0lOUFVUU19XQVRDSEVEX0NPTlRST0xMRVIsXG4gIE5ndE9iamVjdDNkSW5wdXRzQ29udHJvbGxlcixcbiAgTmd0T2JqZWN0M2RJbnB1dHNDb250cm9sbGVyTW9kdWxlLFxuICBOZ3RWZWN0b3IzLFxufSBmcm9tICdAYW5ndWxhci10aHJlZS9jb3JlJztcbmltcG9ydCB7IENvbW1vbk1vZHVsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbic7XG5pbXBvcnQge1xuICBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSxcbiAgQ29tcG9uZW50LFxuICBJbmplY3QsXG4gIElucHV0LFxuICBOZ01vZHVsZSxcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBzZWxlY3RTbGljZSB9IGZyb20gJ0ByeC1hbmd1bGFyL3N0YXRlJztcbmltcG9ydCAqIGFzIFRIUkVFIGZyb20gJ3RocmVlJztcbmltcG9ydCB7IExpbmUyIH0gZnJvbSAndGhyZWUtc3RkbGliJztcbmltcG9ydCB7XG4gIE5HVF9TT0JBX0xJTkVfSU5QVVRTX0NPTlRST0xMRVJfUFJPVklERVIsXG4gIE5HVF9TT0JBX0xJTkVfSU5QVVRTX1dBVENIRURfQ09OVFJPTExFUixcbiAgTmd0U29iYUxpbmVJbnB1dHNDb250cm9sbGVyLFxuICBOZ3RTb2JhTGluZU1vZHVsZSxcbn0gZnJvbSAnLi4vbGluZS9saW5lLmNvbXBvbmVudCc7XG5cbmV4cG9ydCBpbnRlcmZhY2UgTmd0U29iYVF1YWRyYXRpY0JlemllckxpbmVTdGF0ZSB7XG4gIHN0YXJ0OiBOZ3RWZWN0b3IzO1xuICBlbmQ6IE5ndFZlY3RvcjM7XG4gIHNlZ21lbnRzOiBudW1iZXI7XG4gIHBvaW50czogTmd0VmVjdG9yM1tdO1xuICBjdXJ2ZTogVEhSRUUuUXVhZHJhdGljQmV6aWVyQ3VydmUzO1xuICBtaWQ6IE5ndFZlY3RvcjMgfCBudWxsO1xufVxuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICduZ3Qtc29iYS1xdWFkcmF0aWMtYmV6aWVyLWxpbmVbc3RhcnRdW2VuZF0nLFxuICB0ZW1wbGF0ZTogYFxuICAgIDxuZ3Qtc29iYS1saW5lXG4gICAgICAqbmdJZj1cInBvaW50c1wiXG4gICAgICAocmVhZHkpPVwib25MaW5lUmVhZHkoJGFueSgkZXZlbnQpKVwiXG4gICAgICBbcG9pbnRzXT1cInBvaW50c1wiXG4gICAgICBbc29iYUxpbmVJbnB1dHNDb250cm9sbGVyXT1cInNvYmFMaW5lSW5wdXRzQ29udHJvbGxlclwiXG4gICAgICBbb2JqZWN0M2RJbnB1dHNDb250cm9sbGVyXT1cIm9iamVjdElucHV0c0NvbnRyb2xsZXJcIlxuICAgID48L25ndC1zb2JhLWxpbmU+XG4gIGAsXG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLFxuICBwcm92aWRlcnM6IFtcbiAgICBOR1RfU09CQV9MSU5FX0lOUFVUU19DT05UUk9MTEVSX1BST1ZJREVSLFxuICAgIE5HVF9PQkpFQ1RfSU5QVVRTX0NPTlRST0xMRVJfUFJPVklERVIsXG4gIF0sXG59KVxuZXhwb3J0IGNsYXNzIE5ndFNvYmFRdWFkcmF0aWNCZXppZXJMaW5lIGV4dGVuZHMgRW5oYW5jZWRSeFN0YXRlPE5ndFNvYmFRdWFkcmF0aWNCZXppZXJMaW5lU3RhdGU+IHtcbiAgQElucHV0KCkgc2V0IHN0YXJ0KHN0YXJ0OiBOZ3RWZWN0b3IzKSB7XG4gICAgdGhpcy5zZXQoeyBzdGFydCB9KTtcbiAgfVxuXG4gIEBJbnB1dCgpIHNldCBlbmQoZW5kOiBOZ3RWZWN0b3IzKSB7XG4gICAgdGhpcy5zZXQoeyBlbmQgfSk7XG4gIH1cblxuICBASW5wdXQoKSBzZXQgbWlkKG1pZDogTmd0VmVjdG9yMykge1xuICAgIHRoaXMuc2V0KHsgbWlkIH0pO1xuICB9XG5cbiAgQElucHV0KCkgc2V0IHNlZ21lbnRzKHNlZ21lbnRzOiBudW1iZXIpIHtcbiAgICB0aGlzLnNldCh7IHNlZ21lbnRzIH0pO1xuICB9XG5cbiAgdiA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7XG5cbiAgZ2V0IHBvaW50cygpIHtcbiAgICByZXR1cm4gdGhpcy5nZXQoJ3BvaW50cycpO1xuICB9XG5cbiAgY29uc3RydWN0b3IoXG4gICAgQEluamVjdChOR1RfU09CQV9MSU5FX0lOUFVUU19XQVRDSEVEX0NPTlRST0xMRVIpXG4gICAgcHVibGljIHNvYmFMaW5lSW5wdXRzQ29udHJvbGxlcjogTmd0U29iYUxpbmVJbnB1dHNDb250cm9sbGVyLFxuICAgIEBJbmplY3QoTkdUX09CSkVDVF9JTlBVVFNfV0FUQ0hFRF9DT05UUk9MTEVSKVxuICAgIHB1YmxpYyBvYmplY3RJbnB1dHNDb250cm9sbGVyOiBOZ3RPYmplY3QzZElucHV0c0NvbnRyb2xsZXJcbiAgKSB7XG4gICAgc3VwZXIoKTtcbiAgICB0aGlzLnNldCh7XG4gICAgICBzdGFydDogWzAsIDAsIDBdLFxuICAgICAgZW5kOiBbMCwgMCwgMF0sXG4gICAgICBzZWdtZW50czogMjAsXG4gICAgICBtaWQ6IG51bGwsXG4gICAgICBjdXJ2ZTogbmV3IFRIUkVFLlF1YWRyYXRpY0JlemllckN1cnZlMyhcbiAgICAgICAgdW5kZWZpbmVkIGFzIGFueSxcbiAgICAgICAgdW5kZWZpbmVkIGFzIGFueSxcbiAgICAgICAgdW5kZWZpbmVkIGFzIGFueVxuICAgICAgKSxcbiAgICB9KTtcblxuICAgIHRoaXMuY29ubmVjdChcbiAgICAgICdwb2ludHMnLFxuICAgICAgdGhpcy5zZWxlY3Qoc2VsZWN0U2xpY2UoWydzdGFydCcsICdlbmQnLCAnbWlkJywgJ3NlZ21lbnRzJ10pKSxcbiAgICAgIChfLCB7IHNlZ21lbnRzLCBtaWQsIGVuZCwgc3RhcnQgfSkgPT5cbiAgICAgICAgdGhpcy4jZ2V0UG9pbnRzKHN0YXJ0LCBlbmQsIG1pZCwgc2VnbWVudHMpXG4gICAgKTtcbiAgfVxuXG4gICNnZXRQb2ludHMoXG4gICAgc3RhcnQ6IE5ndFZlY3RvcjMsXG4gICAgZW5kOiBOZ3RWZWN0b3IzLFxuICAgIG1pZDogTmd0VmVjdG9yMyB8IG51bGwsXG4gICAgc2VnbWVudHMgPSAyMFxuICApIHtcbiAgICBjb25zdCBjdXJ2ZSA9IHRoaXMuZ2V0KCdjdXJ2ZScpO1xuICAgIGlmIChzdGFydCBpbnN0YW5jZW9mIFRIUkVFLlZlY3RvcjMpIGN1cnZlLnYwLmNvcHkoc3RhcnQpO1xuICAgIGVsc2UgY3VydmUudjAuc2V0KC4uLihzdGFydCBhcyBbbnVtYmVyLCBudW1iZXIsIG51bWJlcl0pKTtcbiAgICBpZiAoZW5kIGluc3RhbmNlb2YgVEhSRUUuVmVjdG9yMykgY3VydmUudjIuY29weShlbmQpO1xuICAgIGVsc2UgY3VydmUudjIuc2V0KC4uLihlbmQgYXMgW251bWJlciwgbnVtYmVyLCBudW1iZXJdKSk7XG4gICAgaWYgKG1pZCBpbnN0YW5jZW9mIFRIUkVFLlZlY3RvcjMpIHtcbiAgICAgIGN1cnZlLnYxLmNvcHkobWlkKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY3VydmUudjEuY29weShcbiAgICAgICAgY3VydmUudjBcbiAgICAgICAgICAuY2xvbmUoKVxuICAgICAgICAgIC5hZGQoY3VydmUudjIuY2xvbmUoKS5zdWIoY3VydmUudjApKVxuICAgICAgICAgIC5hZGQodGhpcy52LnNldCgwLCBjdXJ2ZS52MC55IC0gY3VydmUudjIueSwgMCkpXG4gICAgICApO1xuICAgIH1cbiAgICByZXR1cm4gY3VydmUuZ2V0UG9pbnRzKHNlZ21lbnRzKTtcbiAgfVxuXG4gIG9uTGluZVJlYWR5KFxuICAgIGxpbmU6IExpbmUyICYge1xuICAgICAgc2V0UG9pbnRzOiAoc3RhcnQ6IE5ndFZlY3RvcjMsIGVuZDogTmd0VmVjdG9yMywgbWlkOiBOZ3RWZWN0b3IzKSA9PiB2b2lkO1xuICAgIH1cbiAgKSB7XG4gICAgbGluZS5zZXRQb2ludHMgPSAoc3RhcnQsIGVuZCwgbWlkKSA9PiB7XG4gICAgICBjb25zdCBwb2ludHMgPSB0aGlzLiNnZXRQb2ludHMoc3RhcnQsIGVuZCwgbWlkKTtcbiAgICAgIGlmIChsaW5lLmdlb21ldHJ5KSB7XG4gICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgbGluZS5nZW9tZXRyeS5zZXRQb3NpdGlvbnMocG9pbnRzLm1hcCgocCkgPT4gcC50b0FycmF5KCkpLmZsYXQoKSk7XG4gICAgICB9XG4gICAgfTtcbiAgfVxufVxuXG5ATmdNb2R1bGUoe1xuICBkZWNsYXJhdGlvbnM6IFtOZ3RTb2JhUXVhZHJhdGljQmV6aWVyTGluZV0sXG4gIGV4cG9ydHM6IFtcbiAgICBOZ3RTb2JhUXVhZHJhdGljQmV6aWVyTGluZSxcbiAgICBOZ3RTb2JhTGluZU1vZHVsZSxcbiAgICBOZ3RPYmplY3QzZElucHV0c0NvbnRyb2xsZXJNb2R1bGUsXG4gIF0sXG4gIGltcG9ydHM6IFtOZ3RTb2JhTGluZU1vZHVsZSwgQ29tbW9uTW9kdWxlXSxcbn0pXG5leHBvcnQgY2xhc3MgTmd0U29iYVF1YWRyYXRpY0JlemllckxpbmVNb2R1bGUge31cbiJdfQ==