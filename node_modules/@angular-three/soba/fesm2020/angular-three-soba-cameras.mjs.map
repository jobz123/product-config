{"version":3,"file":"angular-three-soba-cameras.mjs","sources":["../../../../packages/soba/cameras/src/orthographic-camera/orthographic-camera.component.ts","../../../../packages/soba/cameras/src/angular-three-soba-cameras.ts"],"sourcesContent":["import {\n  EnhancedRxState,\n  NGT_OBJECT_INPUTS_CONTROLLER_PROVIDER,\n  NGT_OBJECT_INPUTS_WATCHED_CONTROLLER,\n  NgtObject3dInputsController,\n  NgtObject3dInputsControllerModule,\n  NgtSobaExtender,\n  NgtStore,\n} from '@angular-three/core';\nimport { NgtOrthographicCameraModule } from '@angular-three/core/cameras';\nimport { CommonModule } from '@angular/common';\nimport {\n  ChangeDetectionStrategy,\n  Component,\n  Inject,\n  Injectable,\n  Input,\n  NgModule,\n} from '@angular/core';\nimport { selectSlice } from '@rx-angular/state';\nimport { combineLatest, map, Observable, of, startWith } from 'rxjs';\nimport * as THREE from 'three';\n\nexport interface NgtSobaOrthographicCameraState {\n  makeDefault?: boolean;\n  manual?: boolean;\n  near?: number;\n  far?: number;\n  orthographicCamera?: THREE.OrthographicCamera;\n}\n\n@Injectable()\nexport class NgtSobaOrthographicCameraStore extends EnhancedRxState<NgtSobaOrthographicCameraState> {\n  readonly #projectMatrixParams$ = combineLatest([\n    this.store.select('size'),\n    this.select(selectSlice(['near', 'far'])),\n    this.objectInputsController.change$.pipe(startWith({})),\n  ]).pipe(map(([size, { near, far }]) => ({ size, near, far })));\n\n  readonly #cameraParams$ = combineLatest([\n    this.store.select('camera'),\n    this.select(selectSlice(['orthographicCamera', 'makeDefault'])),\n  ]).pipe(\n    map(([camera, { orthographicCamera, makeDefault }]) => ({\n      camera,\n      orthographicCamera,\n      makeDefault,\n    }))\n  );\n\n  readonly vm$: Observable<{\n    left: number;\n    right: number;\n    top: number;\n    bottom: number;\n    near?: number;\n    far?: number;\n    objectInputsController: NgtObject3dInputsController;\n  }> = combineLatest([\n    of(this.objectInputsController),\n    this.store.select('size'),\n    this.select(\n      selectSlice(['near', 'far']),\n      startWith({ near: undefined, far: undefined })\n    ),\n  ]).pipe(\n    map(([objectInputsController, size, { near, far }]) => ({\n      left: size.width / -2,\n      right: size.width / 2,\n      top: size.height / 2,\n      bottom: size.height / -2,\n      objectInputsController,\n      near,\n      far,\n    }))\n  );\n\n  constructor(\n    private store: NgtStore,\n    @Inject(NGT_OBJECT_INPUTS_WATCHED_CONTROLLER)\n    private objectInputsController: NgtObject3dInputsController\n  ) {\n    super();\n\n    this.hold(this.#projectMatrixParams$, () => {\n      const { manual, orthographicCamera } = this.get();\n      if (orthographicCamera && !manual) {\n        orthographicCamera.updateProjectionMatrix();\n      }\n    });\n\n    this.holdEffect(\n      this.#cameraParams$,\n      ({ camera, orthographicCamera, makeDefault }) => {\n        if (makeDefault && orthographicCamera) {\n          this.store.set({ camera: orthographicCamera });\n        }\n\n        return () => {\n          this.store.set({ camera });\n        };\n      }\n    );\n  }\n}\n\n@Component({\n  selector: 'ngt-soba-orthographic-camera',\n  template: `\n    <ngt-orthographic-camera\n      *ngIf=\"vm$ | async as vm\"\n      [args]=\"[vm.left, vm.right, vm.top, vm.bottom, vm.near, vm.far]\"\n      [object3dInputsController]=\"vm.objectInputsController\"\n      (ready)=\"object = $event\"\n    >\n      <ng-content></ng-content>\n    </ngt-orthographic-camera>\n  `,\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  providers: [\n    NGT_OBJECT_INPUTS_CONTROLLER_PROVIDER,\n    NgtSobaOrthographicCameraStore,\n    { provide: NgtSobaExtender, useExisting: NgtSobaOrthographicCamera },\n  ],\n})\nexport class NgtSobaOrthographicCamera extends NgtSobaExtender<THREE.OrthographicCamera> {\n  @Input() set makeDefault(makeDefault: boolean) {\n    this.sobaOrthographicCameraStore.set({ makeDefault });\n  }\n\n  @Input() set manual(manual: boolean) {\n    this.sobaOrthographicCameraStore.set({ manual });\n  }\n\n  @Input() set near(near: number) {\n    this.sobaOrthographicCameraStore.set({ near });\n  }\n\n  @Input() set far(far: number) {\n    this.sobaOrthographicCameraStore.set({ far });\n  }\n\n  readonly vm$ = this.sobaOrthographicCameraStore.vm$;\n\n  constructor(\n    private sobaOrthographicCameraStore: NgtSobaOrthographicCameraStore\n  ) {\n    super();\n  }\n}\n\n@NgModule({\n  declarations: [NgtSobaOrthographicCamera],\n  exports: [NgtSobaOrthographicCamera, NgtObject3dInputsControllerModule],\n  imports: [CommonModule, NgtOrthographicCameraModule],\n})\nexport class NgtSobaOrthographicCameraModule {}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n"],"names":[],"mappings":"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"}