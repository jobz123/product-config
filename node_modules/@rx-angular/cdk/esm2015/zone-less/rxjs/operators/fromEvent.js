// tslint:disable
import { Observable } from 'rxjs';
import { map } from 'rxjs/operators';
import { getZoneUnPatchedApi } from '../../get-zone-unpatched-api';
// @ts-ignore
const isFunction = (fn) => typeof fn === 'function';
const ɵ0 = isFunction;
const isArray = Array.isArray;
const ɵ1 = () => Object.prototype.toString;
const toString = (ɵ1)();
/* tslint:enable:max-line-length */
export function fromEvent(target, eventName, options, resultSelector) {
    if (isFunction(options)) {
        // DEPRECATED PATH
        // @ts-ignore
        resultSelector = options;
        options = undefined;
    }
    if (resultSelector) {
        // DEPRECATED PATH
        return fromEvent(target, eventName, options).pipe(map((args) => isArray(args) ? resultSelector(...args) : resultSelector(args)));
    }
    return new Observable((subscriber) => {
        function handler(e) {
            if (arguments.length > 1) {
                subscriber.next(Array.prototype.slice.call(arguments));
            }
            else {
                subscriber.next(e);
            }
        }
        setupSubscription(target, eventName, handler, subscriber, options);
    });
}
function setupSubscription(sourceObj, eventName, handler, subscriber, options) {
    let unsubscribe;
    if (isEventTarget(sourceObj)) {
        const source = sourceObj;
        getZoneUnPatchedApi(sourceObj, 'addEventListener').call(sourceObj, eventName, handler, options);
        unsubscribe = () => getZoneUnPatchedApi(source, 'removeEventListener').call(source, eventName, handler, options);
    }
    else if (isJQueryStyleEventEmitter(sourceObj)) {
        const source = sourceObj;
        sourceObj.on(eventName, handler);
        unsubscribe = () => source.off(eventName, handler);
    }
    else if (isNodeStyleEventEmitter(sourceObj)) {
        const source = sourceObj;
        sourceObj.addListener(eventName, handler);
        unsubscribe = () => source.removeListener(eventName, handler);
    }
    else if (sourceObj && sourceObj.length) {
        for (let i = 0, len = sourceObj.length; i < len; i++) {
            setupSubscription(sourceObj[i], eventName, handler, subscriber, options);
        }
    }
    else {
        throw new TypeError('Invalid event target');
    }
    subscriber.add(unsubscribe);
}
function isNodeStyleEventEmitter(sourceObj) {
    return (sourceObj &&
        typeof sourceObj.addListener === 'function' &&
        typeof sourceObj.removeListener === 'function');
}
function isJQueryStyleEventEmitter(sourceObj) {
    return (sourceObj &&
        typeof sourceObj.on === 'function' &&
        typeof sourceObj.off === 'function');
}
function isEventTarget(sourceObj) {
    return (sourceObj &&
        typeof sourceObj.addEventListener === 'function' &&
        typeof sourceObj.removeEventListener === 'function');
}
export { ɵ0, ɵ1 };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZnJvbUV2ZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vbGlicy9jZGsvem9uZS1sZXNzL3NyYy9yeGpzL29wZXJhdG9ycy9mcm9tRXZlbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsaUJBQWlCO0FBQ2pCLE9BQU8sRUFBRSxVQUFVLEVBQWMsTUFBTSxNQUFNLENBQUM7QUFDOUMsT0FBTyxFQUFFLEdBQUcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3JDLE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxNQUFNLDhCQUE4QixDQUFDO0FBRW5FLGFBQWE7QUFDYixNQUFNLFVBQVUsR0FBRyxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUMsT0FBTyxFQUFFLEtBQUssVUFBVSxDQUFDOztBQUNwRCxNQUFNLE9BQU8sR0FBRyxLQUFLLENBQUMsT0FBTyxDQUFDO1dBQ0YsR0FBRyxFQUFFLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxRQUFRO0FBQTNELE1BQU0sUUFBUSxHQUFhLElBQWlDLEVBQUUsQ0FBQztBQXFGL0QsbUNBQW1DO0FBRW5DLE1BQU0sVUFBVSxTQUFTLENBQ3ZCLE1BQTBCLEVBQzFCLFNBQWlCLEVBQ2pCLE9BQXdELEVBQ3hELGNBQXNDO0lBRXRDLElBQUksVUFBVSxDQUFDLE9BQU8sQ0FBQyxFQUFFO1FBQ3ZCLGtCQUFrQjtRQUNsQixhQUFhO1FBQ2IsY0FBYyxHQUFHLE9BQU8sQ0FBQztRQUN6QixPQUFPLEdBQUcsU0FBUyxDQUFDO0tBQ3JCO0lBQ0QsSUFBSSxjQUFjLEVBQUU7UUFDbEIsa0JBQWtCO1FBQ2xCLE9BQU8sU0FBUyxDQUNkLE1BQU0sRUFDTixTQUFTLEVBQ3lCLE9BQU8sQ0FDMUMsQ0FBQyxJQUFJLENBQ0osR0FBRyxDQUFDLENBQUMsSUFBSSxFQUFFLEVBQUUsQ0FDWCxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLGNBQWMsQ0FBQyxHQUFHLElBQUksQ0FB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VTtRQUNsQyxPQUFPLFNBQVMsQ0FBQyxHQUFHLEtBQUssVUFBVSxDQUNwQyxDQUFDO0FBQ0osQ0FBQztBQUVELFNBQVMsYUFBYSxDQUNwQixTQUFjO0lBRWQsT0FBTyxDQUNMLFNBQVM7UUFDVCxPQUFPLFNBQVMsQ0FBQyxnQkFBZ0IsS0FBSyxVQUFVO1FBQ2hELE9BQU8sU0FBUyxDQUFDLG1CQUFtQixLQUFLLFVBQVUsQ0FDcEQsQ0FBQztBQUNKLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyB0c2xpbnQ6ZGlzYWJsZVxyXG5pbXBvcnQgeyBPYnNlcnZhYmxlLCBTdWJzY3JpYmVyIH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IG1hcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcclxuaW1wb3J0IHsgZ2V0Wm9uZVVuUGF0Y2hlZEFwaSB9IGZyb20gJy4uLy4uL2dldC16b25lLXVucGF0Y2hlZC1hcGknO1xyXG5cclxuLy8gQHRzLWlnbm9yZVxyXG5jb25zdCBpc0Z1bmN0aW9uID0gKGZuKSA9PiB0eXBlb2YgZm4gPT09ICdmdW5jdGlvbic7XHJcbmNvbnN0IGlzQXJyYXkgPSBBcnJheS5pc0FycmF5O1xyXG5jb25zdCB0b1N0cmluZzogRnVuY3Rpb24gPSAoKCkgPT4gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZykoKTtcclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgTm9kZVN0eWxlRXZlbnRFbWl0dGVyIHtcclxuICBhZGRMaXN0ZW5lcjogKGV2ZW50TmFtZTogc3RyaW5nIHwgc3ltYm9sLCBoYW5kbGVyOiBOb2RlRXZlbnRIYW5kbGVyKSA9PiB0aGlzO1xyXG4gIHJlbW92ZUxpc3RlbmVyOiAoXHJcbiAgICBldmVudE5hbWU6IHN0cmluZyB8IHN5bWJvbCxcclxuICAgIGhhbmRsZXI6IE5vZGVFdmVudEhhbmRsZXJcclxuICApID0+IHRoaXM7XHJcbn1cclxuXHJcbmV4cG9ydCB0eXBlIE5vZGVFdmVudEhhbmRsZXIgPSAoLi4uYXJnczogYW55W10pID0+IHZvaWQ7XHJcblxyXG4vLyBGb3IgQVBJcyB0aGF0IGltcGxlbWVudCBgYWRkTGlzdGVuZXJgIGFuZCBgcmVtb3ZlTGlzdGVuZXJgIG1ldGhvZHMgdGhhdCBtYXlcclxuLy8gbm90IHVzZSB0aGUgc2FtZSBhcmd1bWVudHMgb3IgcmV0dXJuIEV2ZW50RW1pdHRlciB2YWx1ZXNcclxuLy8gc3VjaCBhcyBSZWFjdCBOYXRpdmVcclxuZXhwb3J0IGludGVyZmFjZSBOb2RlQ29tcGF0aWJsZUV2ZW50RW1pdHRlciB7XHJcbiAgYWRkTGlzdGVuZXI6IChldmVudE5hbWU6IHN0cmluZywgaGFuZGxlcjogTm9kZUV2ZW50SGFuZGxlcikgPT4gdm9pZCB8IHt9O1xyXG4gIHJlbW92ZUxpc3RlbmVyOiAoZXZlbnROYW1lOiBzdHJpbmcsIGhhbmRsZXI6IE5vZGVFdmVudEhhbmRsZXIpID0+IHZvaWQgfCB7fTtcclxufVxyXG5cclxuZXhwb3J0IGludGVyZmFjZSBKUXVlcnlTdHlsZUV2ZW50RW1pdHRlciB7XHJcbiAgb246IChldmVudE5hbWU6IHN0cmluZywgaGFuZGxlcjogRnVuY3Rpb24pID0+IHZvaWQ7XHJcbiAgb2ZmOiAoZXZlbnROYW1lOiBzdHJpbmcsIGhhbmRsZXI6IEZ1bmN0aW9uKSA9PiB2b2lkO1xyXG59XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIEhhc0V2ZW50VGFyZ2V0QWRkUmVtb3ZlPEU+IHtcclxuICBhZGRFdmVudExpc3RlbmVyKFxyXG4gICAgdHlwZTogc3RyaW5nLFxyXG4gICAgbGlzdGVuZXI6ICgoZXZ0OiBFKSA9PiB2b2lkKSB8IG51bGwsXHJcbiAgICBvcHRpb25zPzogYm9vbGVhbiB8IEFkZEV2ZW50TGlzdGVuZXJPcHRpb25zXHJcbiAgKTogdm9pZDtcclxuICByZW1vdmVFdmVudExpc3RlbmVyKFxyXG4gICAgdHlwZTogc3RyaW5nLFxyXG4gICAgbGlzdGVuZXI/OiAoKGV2dDogRSkgPT4gdm9pZCkgfCBudWxsLFxyXG4gICAgb3B0aW9ucz86IEV2ZW50TGlzdGVuZXJPcHRpb25zIHwgYm9vbGVhblxyXG4gICk6IHZvaWQ7XHJcbn1cclxuXHJcbmV4cG9ydCB0eXBlIEV2ZW50VGFyZ2V0TGlrZTxUPiA9XHJcbiAgfCBIYXNFdmVudFRhcmdldEFkZFJlbW92ZTxUPlxyXG4gIHwgTm9kZVN0eWxlRXZlbnRFbWl0dGVyXHJcbiAgfCBOb2RlQ29tcGF0aWJsZUV2ZW50RW1pdHRlclxyXG4gIHwgSlF1ZXJ5U3R5bGVFdmVudEVtaXR0ZXI7XHJcblxyXG5leHBvcnQgdHlwZSBGcm9tRXZlbnRUYXJnZXQ8VD4gPVxyXG4gIHwgRXZlbnRUYXJnZXRMaWtlPFQ+XHJcbiAgfCBBcnJheUxpa2U8RXZlbnRUYXJnZXRMaWtlPFQ+PjtcclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgRXZlbnRMaXN0ZW5lck9wdGlvbnMge1xyXG4gIGNhcHR1cmU/OiBib29sZWFuO1xyXG4gIHBhc3NpdmU/OiBib29sZWFuO1xyXG4gIG9uY2U/OiBib29sZWFuO1xyXG59XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIEFkZEV2ZW50TGlzdGVuZXJPcHRpb25zIGV4dGVuZHMgRXZlbnRMaXN0ZW5lck9wdGlvbnMge1xyXG4gIG9uY2U/OiBib29sZWFuO1xyXG4gIHBhc3NpdmU/OiBib29sZWFuO1xyXG59XHJcblxyXG4vKiB0c2xpbnQ6ZGlzYWJsZTptYXgtbGluZS1sZW5ndGggKi9cclxuZXhwb3J0IGZ1bmN0aW9uIGZyb21FdmVudDxUPihcclxuICB0YXJnZXQ6IEZyb21FdmVudFRhcmdldDxUPixcclxuICBldmVudE5hbWU6IHN0cmluZ1xyXG4pOiBPYnNlcnZhYmxlPFQ+O1xyXG4vKiogQGRlcHJlY2F0ZWQgcmVzdWx0U2VsZWN0b3Igbm8gbG9uZ2VyIHN1cHBvcnRlZCwgcGlwZSB0byBtYXAgaW5zdGVhZCAqL1xyXG4vLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6dW5pZmllZC1zaWduYXR1cmVzXHJcbmV4cG9ydCBmdW5jdGlvbiBmcm9tRXZlbnQ8VD4oXHJcbiAgdGFyZ2V0OiBGcm9tRXZlbnRUYXJnZXQ8VD4sXHJcbiAgZXZlbnROYW1lOiBzdHJpbmcsXHJcbiAgcmVzdWx0U2VsZWN0b3I6ICguLi5hcmdzOiBhbnlbXSkgPT4gVFxyXG4pOiBPYnNlcnZhYmxlPFQ+O1xyXG4vLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6dW5pZmllZC1zaWduYXR1cmVzXHJcbmV4cG9ydCBmdW5jdGlvbiBmcm9tRXZlbnQ8VD4oXHJcbiAgdGFyZ2V0OiBGcm9tRXZlbnRUYXJnZXQ8VD4sXHJcbiAgZXZlbnROYW1lOiBzdHJpbmcsXHJcbiAgb3B0aW9uczogRXZlbnRMaXN0ZW5lck9wdGlvbnNcclxuKTogT2JzZXJ2YWJsZTxUPjtcclxuLyoqIEBkZXByZWNhdGVkIHJlc3VsdFNlbGVjdG9yIG5vIGxvbmdlciBzdXBwb3J0ZWQsIHBpcGUgdG8gbWFwIGluc3RlYWQgKi9cclxuLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOnVuaWZpZWQtc2lnbmF0dXJlc1xyXG5leHBvcnQgZnVuY3Rpb24gZnJvbUV2ZW50PFQ+KFxyXG4gIHRhcmdldDogRnJvbUV2ZW50VGFyZ2V0PFQ+LFxyXG4gIGV2ZW50TmFtZTogc3RyaW5nLFxyXG4gIG9wdGlvbnM6IEV2ZW50TGlzdGVuZXJPcHRpb25zLFxyXG4gIHJlc3VsdFNlbGVjdG9yOiAoLi4uYXJnczogYW55W10pID0+IFRcclxuKTogT2JzZXJ2YWJsZTxUPjtcclxuLyogdHNsaW50OmVuYWJsZTptYXgtbGluZS1sZW5ndGggKi9cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBmcm9tRXZlbnQ8VD4oXHJcbiAgdGFyZ2V0OiBGcm9tRXZlbnRUYXJnZXQ8VD4sXHJcbiAgZXZlbnROYW1lOiBzdHJpbmcsXHJcbiAgb3B0aW9ucz86IEV2ZW50TGlzdGVuZXJPcHRpb25zIHwgKCguLi5hcmdzOiBhbnlbXSkgPT4gVCksXHJcbiAgcmVzdWx0U2VsZWN0b3I/OiAoLi4uYXJnczogYW55W10pID0+IFRcclxuKTogT2JzZXJ2YWJsZTxUPiB7XHJcbiAgaWYgKGlzRnVuY3Rpb24ob3B0aW9ucykpIHtcclxuICAgIC8vIERFUFJFQ0FURUQgUEFUSFxyXG4gICAgLy8gQHRzLWlnbm9yZVxyXG4gICAgcmVzdWx0U2VsZWN0b3IgPSBvcHRpb25zO1xyXG4gICAgb3B0aW9ucyA9IHVuZGVmaW5lZDtcclxuICB9XHJcbiAgaWYgKHJlc3VsdFNlbGVjdG9yKSB7XHJcbiAgICAvLyBERVBSRUNBVEVEIFBBVEhcclxuICAgIHJldHVybiBmcm9tRXZlbnQ8VD4oXHJcbiAgICAgIHRhcmdldCxcclxuICAgICAgZXZlbnROYW1lLFxyXG4gICAgICA8RXZlbnRMaXN0ZW5lck9wdGlvbnMgfCB1bmRlZmluZWQ+b3B0aW9uc1xyXG4gICAgKS5waXBlKFxyXG4gICAgICBtYXAoKGFyZ3MpID0+XHJcbiAgICAgICAgaXNBcnJheShhcmdzKSA/IHJlc3VsdFNlbGVjdG9yKC4uLmFyZ3MpIDogcmVzdWx0U2VsZWN0b3IoYXJncylcclxuICAgICAgKVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIHJldHVybiBuZXcgT2JzZXJ2YWJsZTxUPigoc3Vic2NyaWJlcikgPT4ge1xyXG4gICAgZnVuY3Rpb24gaGFuZGxlcihlOiBUKSB7XHJcbiAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID4gMSkge1xyXG4gICAgICAgIHN1YnNjcmliZXIubmV4dChBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMpKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBzdWJzY3JpYmVyLm5leHQoZSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIHNldHVwU3Vic2NyaXB0aW9uKFxyXG4gICAgICB0YXJnZXQsXHJcbiAgICAgIGV2ZW50TmFtZSxcclxuICAgICAgaGFuZGxlcixcclxuICAgICAgc3Vic2NyaWJlcixcclxuICAgICAgb3B0aW9ucyBhcyBFdmVudExpc3RlbmVyT3B0aW9uc1xyXG4gICAgKTtcclxuICB9KTtcclxufVxyXG5cclxuZnVuY3Rpb24gc2V0dXBTdWJzY3JpcHRpb248VD4oXHJcbiAgc291cmNlT2JqOiBGcm9tRXZlbnRUYXJnZXQ8VD4sXHJcbiAgZXZlbnROYW1lOiBzdHJpbmcsXHJcbiAgaGFuZGxlcjogKC4uLmFyZ3M6IGFueVtdKSA9PiB2b2lkLFxyXG4gIHN1YnNjcmliZXI6IFN1YnNjcmliZXI8VD4sXHJcbiAgb3B0aW9ucz86IEV2ZW50TGlzdGVuZXJPcHRpb25zXHJcbikge1xyXG4gIGxldCB1bnN1YnNjcmliZTogKCkgPT4gdm9pZDtcclxuICBpZiAoaXNFdmVudFRhcmdldChzb3VyY2VPYmopKSB7XHJcbiAgICBjb25zdCBzb3VyY2UgPSBzb3VyY2VPYmo7XHJcbiAgICBnZXRab25lVW5QYXRjaGVkQXBpKHNvdXJjZU9iaiwgJ2FkZEV2ZW50TGlzdGVuZXInKS5jYWxsKFxyXG4gICAgICBzb3VyY2VPYmosXHJcbiAgICAgIGV2ZW50TmFtZSxcclxuICAgICAgaGFuZGxlcixcclxuICAgICAgb3B0aW9uc1xyXG4gICAgKTtcclxuICAgIHVuc3Vic2NyaWJlID0gKCkgPT5cclxuICAgICAgZ2V0Wm9uZVVuUGF0Y2hlZEFwaShzb3VyY2UsICdyZW1vdmVFdmVudExpc3RlbmVyJykuY2FsbChcclxuICAgICAgICBzb3VyY2UsXHJcbiAgICAgICAgZXZlbnROYW1lLFxyXG4gICAgICAgIGhhbmRsZXIsXHJcbiAgICAgICAgb3B0aW9uc1xyXG4gICAgICApO1xyXG4gIH0gZWxzZSBpZiAoaXNKUXVlcnlTdHlsZUV2ZW50RW1pdHRlcihzb3VyY2VPYmopKSB7XHJcbiAgICBjb25zdCBzb3VyY2UgPSBzb3VyY2VPYmo7XHJcbiAgICBzb3VyY2VPYmoub24oZXZlbnROYW1lLCBoYW5kbGVyKTtcclxuICAgIHVuc3Vic2NyaWJlID0gKCkgPT4gc291cmNlLm9mZihldmVudE5hbWUsIGhhbmRsZXIpO1xyXG4gIH0gZWxzZSBpZiAoaXNOb2RlU3R5bGVFdmVudEVtaXR0ZXIoc291cmNlT2JqKSkge1xyXG4gICAgY29uc3Qgc291cmNlID0gc291cmNlT2JqO1xyXG4gICAgc291cmNlT2JqLmFkZExpc3RlbmVyKGV2ZW50TmFtZSwgaGFuZGxlciBhcyBOb2RlRXZlbnRIYW5kbGVyKTtcclxuICAgIHVuc3Vic2NyaWJlID0gKCkgPT5cclxuICAgICAgc291cmNlLnJlbW92ZUxpc3RlbmVyKGV2ZW50TmFtZSwgaGFuZGxlciBhcyBOb2RlRXZlbnRIYW5kbGVyKTtcclxuICB9IGVsc2UgaWYgKHNvdXJjZU9iaiAmJiAoc291cmNlT2JqIGFzIGFueSkubGVuZ3RoKSB7XHJcbiAgICBmb3IgKGxldCBpID0gMCwgbGVuID0gKHNvdXJjZU9iaiBhcyBhbnkpLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XHJcbiAgICAgIHNldHVwU3Vic2NyaXB0aW9uKHNvdXJjZU9ialtpXSwgZXZlbnROYW1lLCBoYW5kbGVyLCBzdWJzY3JpYmVyLCBvcHRpb25zKTtcclxuICAgIH1cclxuICB9IGVsc2Uge1xyXG4gICAgdGhyb3cgbmV3IFR5cGVFcnJvcignSW52YWxpZCBldmVudCB0YXJnZXQnKTtcclxuICB9XHJcblxyXG4gIHN1YnNjcmliZXIuYWRkKHVuc3Vic2NyaWJlKTtcclxufVxyXG5cclxuZnVuY3Rpb24gaXNOb2RlU3R5bGVFdmVudEVtaXR0ZXIoXHJcbiAgc291cmNlT2JqOiBhbnlcclxuKTogc291cmNlT2JqIGlzIE5vZGVTdHlsZUV2ZW50RW1pdHRlciB7XHJcbiAgcmV0dXJuIChcclxuICAgIHNvdXJjZU9iaiAmJlxyXG4gICAgdHlwZW9mIHNvdXJjZU9iai5hZGRMaXN0ZW5lciA9PT0gJ2Z1bmN0aW9uJyAmJlxyXG4gICAgdHlwZW9mIHNvdXJjZU9iai5yZW1vdmVMaXN0ZW5lciA9PT0gJ2Z1bmN0aW9uJ1xyXG4gICk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGlzSlF1ZXJ5U3R5bGVFdmVudEVtaXR0ZXIoXHJcbiAgc291cmNlT2JqOiBhbnlcclxuKTogc291cmNlT2JqIGlzIEpRdWVyeVN0eWxlRXZlbnRFbWl0dGVyIHtcclxuICByZXR1cm4gKFxyXG4gICAgc291cmNlT2JqICYmXHJcbiAgICB0eXBlb2Ygc291cmNlT2JqLm9uID09PSAnZnVuY3Rpb24nICYmXHJcbiAgICB0eXBlb2Ygc291cmNlT2JqLm9mZiA9PT0gJ2Z1bmN0aW9uJ1xyXG4gICk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGlzRXZlbnRUYXJnZXQoXHJcbiAgc291cmNlT2JqOiBhbnlcclxuKTogc291cmNlT2JqIGlzIEhhc0V2ZW50VGFyZ2V0QWRkUmVtb3ZlPGFueT4ge1xyXG4gIHJldHVybiAoXHJcbiAgICBzb3VyY2VPYmogJiZcclxuICAgIHR5cGVvZiBzb3VyY2VPYmouYWRkRXZlbnRMaXN0ZW5lciA9PT0gJ2Z1bmN0aW9uJyAmJlxyXG4gICAgdHlwZW9mIHNvdXJjZU9iai5yZW1vdmVFdmVudExpc3RlbmVyID09PSAnZnVuY3Rpb24nXHJcbiAgKTtcclxufVxyXG4iXX0=